!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ULTRON=t()}}(function(){var t;return function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n?n:e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){var o;!function(){"use strict";function t(t){var e,n,o,i,r,s,a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<l&&(l=t[e][1]),t[e][1]>u&&(u=t[e][1]);return n=h-a,o=u-l,i=Math.max(n,o),r=a+.5*n,s=l+.5*o,[[r-20*i,s-i],[r,s+20*i],[r+20*i,s-i]]}function n(t,e,n,o){var i,s,a,l,h,u,p,y,c,d,f=t[e][0],g=t[e][1],m=t[n][0],v=t[n][1],x=t[o][0],_=t[o][1],b=Math.abs(g-v),P=Math.abs(v-_);if(r>b&&r>P)throw new Error("Eek! Coincident points!");return r>b?(l=-((x-m)/(_-v)),u=(m+x)/2,y=(v+_)/2,i=(m+f)/2,s=l*(i-u)+y):r>P?(a=-((m-f)/(v-g)),h=(f+m)/2,p=(g+v)/2,i=(x+m)/2,s=a*(i-h)+p):(a=-((m-f)/(v-g)),l=-((x-m)/(_-v)),h=(f+m)/2,u=(m+x)/2,p=(g+v)/2,y=(v+_)/2,i=(a*h-l*u+y-p)/(a-l),s=b>P?a*(i-h)+p:l*(i-u)+y),c=m-i,d=v-s,{i:e,j:n,k:o,x:i,y:s,r:c*c+d*d}}function i(t){var e,n,o,i,r,s;for(n=t.length;n;)for(i=t[--n],o=t[--n],e=n;e;)if(s=t[--e],r=t[--e],o===r&&i===s||o===s&&i===r){t.splice(n,2),t.splice(e,2);break}}var r=1/1048576;o={triangulate:function(e,o){var s,a,l,h,u,p,y,c,d,f,g,m,v=e.length;if(3>v)return[];if(e=e.slice(0),o)for(s=v;s--;)e[s]=e[s][o];for(l=new Array(v),s=v;s--;)l[s]=s;for(l.sort(function(t,n){return e[n][0]-e[t][0]}),h=t(e),e.push(h[0],h[1],h[2]),u=[n(e,v+0,v+1,v+2)],p=[],y=[],s=l.length;s--;y.length=0){for(m=l[s],a=u.length;a--;)c=e[m][0]-u[a].x,c>0&&c*c>u[a].r?(p.push(u[a]),u.splice(a,1)):(d=e[m][1]-u[a].y,c*c+d*d-u[a].r>r||(y.push(u[a].i,u[a].j,u[a].j,u[a].k,u[a].k,u[a].i),u.splice(a,1)));for(i(y),a=y.length;a;)g=y[--a],f=y[--a],u.push(n(e,f,g,m))}for(s=u.length;s--;)p.push(u[s]);for(u.length=0,s=p.length;s--;)p[s].i<v&&p[s].j<v&&p[s].k<v&&u.push(p[s].i,p[s].j,p[s].k);return u},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var n=t[1][0]-t[0][0],o=t[2][0]-t[0][0],i=t[1][1]-t[0][1],r=t[2][1]-t[0][1],s=n*r-o*i;if(0===s)return null;var a=(r*(e[0]-t[0][0])-o*(e[1]-t[0][1]))/s,l=(n*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/s;return 0>a||0>l||a+l>1?null:[a,l]}},"undefined"!=typeof e&&(e.exports=o)}()},{}],2:[function(t,e,n){"use strict";function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}var r="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(t,e){var n=r?r+t:t,o=this._events&&this._events[n];if(e)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var i=0,s=o.length,a=new Array(s);s>i;i++)a[i]=o[i].fn;return a},i.prototype.emit=function(t,e,n,o,i,s){var a=r?r+t:t;if(!this._events||!this._events[a])return!1;var l,h,u=this._events[a],p=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,o),!0;case 5:return u.fn.call(u.context,e,n,o,i),!0;case 6:return u.fn.call(u.context,e,n,o,i,s),!0}for(h=1,l=new Array(p-1);p>h;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var y,c=u.length;for(h=0;c>h;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),p){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,n);break;default:if(!l)for(y=1,l=new Array(p-1);p>y;y++)l[y-1]=arguments[y];u[h].fn.apply(u[h].context,l)}}return!0},i.prototype.on=function(t,e,n){var i=new o(e,n||this),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(t,e,n){var i=new o(e,n||this,!0),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events||!this._events[i])return this;var s=this._events[i],a=[];if(e)if(s.fn)(s.fn!==e||o&&!s.once||n&&s.context!==n)&&a.push(s);else for(var l=0,h=s.length;h>l;l++)(s[l].fn!==e||o&&!s[l].once||n&&s[l].context!==n)&&a.push(s[l]);return a.length?this._events[i]=1===a.length?a[0]:a:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[r?r+t:t]:this._events=r?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=r,"undefined"!=typeof e&&(e.exports=i)},{}],3:[function(e,n,o){!function(e){function i(t){function n(){function t(t,e,n){return t||e?(console.warn(n),!0):!1}function n(){return h?t(o,i,l):!1}var o=e.webkitRequestAnimationFrame,i=e.requestAnimationFrame,r=screen.width<=768?!0:!1,s=!(o&&i),a=e.performance?!1:!0,l="setTimeout is being used as a substitiue forrequestAnimationFrame due to a bug within iOS 6 builds",h=s&&r&&a;return n()}function o(t){clearTimeout(t)}function i(t){var e=Date.now(),n=Math.max(g+16,e);return setTimeout(function(){t(g=n)},n-e)}function r(){return Array.prototype.filter?(u=e["request"+d]||e[c.filter(function(t){return void 0!==e[t+f]?t:void 0})+f]||i,n()?i:u):i}function s(){function t(t,n){for(var o;n<t.length;n++)if(e[t[n]]){o=e[t[n]];break}return o}var i=[];return Array.prototype.map?(c.map(function(t){return["Cancel","CancelRequest"].map(function(e){i.push(t+e+d)})}),p=e["cancel"+d]||t(i,0)||o,n()?o:p):o}function a(){return x?i:r()}function l(){return s()}function h(){x?(e.requestAnimationFrame=i,e.cancelAnimationFrame=o):(e.requestAnimationFrame=r(),e.cancelAnimationFrame=s())}var u,p,y,c=["moz","webkit"],d="AnimationFrame",f="Request"+d,g=0,m=e.mozRequestAnimationFrame,v=e.mozCancelAnimationFrame,x=m&&!v;switch(Date.now||(Date.now=function(){return(new Date).getTime()}),t){case"request":case"":y=a();break;case"cancel":y=l();break;case"native":h();break;default:throw new Error("RequestFrame parameter is not a type.")}return y}"object"==typeof n&&"object"==typeof n.exports?n.exports=o=i:"function"==typeof t&&t.amd?t(function(){return i}):"object"==typeof e&&(e.requestFrame=i)}("undefined"==typeof window?{}:window)},{}],4:[function(t,e,n){var o,i="undefined"!=typeof window?window.navigator.userAgent:"",r=/OS X/.test(i),s=/Opera/.test(i),a=!/like Gecko/.test(i)&&!s,l=e.exports={0:r?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:r?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num-->",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:r&&a?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:s?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(o=58;65>o;++o)l[o]=String.fromCharCode(o);for(o=48;58>o;++o)l[o]=o-48+"";for(o=65;91>o;++o)l[o]=String.fromCharCode(o);for(o=96;106>o;++o)l[o]="<num-"+(o-96)+">";for(o=112;136>o;++o)l[o]="F"+(o-111)},{}],5:[function(t,e,n){function o(t,e){return t.clone().subtract(e).normalize()}function i(t,e,n,o,i){var r=t.clone().subtract(e),s=r.length();return r=r.normalize(),r=i>=s?r.multipyScalar(o*(s/i)):r.multipyScalar(o),r.subtract(n)}function r(t,e,n,o){return e.clone().subtract(t).normalize().multiplyScalar(o).subtract(n)}function s(t,e,n,o){var i=t.clone().normalize().multiplyScalar(e),r=u(0,-1).multiplyScaler(n).setAngle(o);return i=i.add(r),r.free(),i}function a(t,e,n,o,i){var s=t.clone().subtract(e),a=s.length()/n;s.free();var l=i.clone().multiplyScalar(a),h=i.clone().add(l);l.free();var u=r(h,e,o,n);return h.free(),u}function l(t,e,n,o,r){var s=t.clone().subtract(e),a=s.length()/n;s.free();var l=r.clone().multiplyScaler(a),h=r.clone().add(l);l.free();var u=i(h,e,o,n,0);return h.free(),u}function h(t,e,n,o,i,r){var s=n.clone().normalize().multiplyScalar(o*n.length()/i),a=e.clone().add(s).subtract(t).normalize().multiplyScalar(r);return s.free(),a}var u=t("../geometry/vector2");n=e.exports={straight:o,evade:a,seek:i,flee:r,wander:s,pursuit:l,avoidance:h}},{"../geometry/vector2":25}],6:[function(t,e,n){"use strict";function o(){this.states={},this.statestack=new i,this.gameloop=new r;var t=this;this.gameloop.setBegin(function(e,n){t.begin(e,n),t.statestack.begin(e,n)}),this.gameloop.setUpdate(function(e){t.update(e),t.statestack.update(e)}),this.gameloop.setRender(function(e){t.statestack.render(e),t.render(e)}),this.gameloop.setEnd(function(e,n){t.end(e.panic),t.statestack.end(e,n)})}var i=t("./statestack"),r=t("../timer/gameloop"),s=function(){};e.exports=o,o.prototype.start=function(){return this.gameloop.start()},o.prototype.stop=function(){return this.gameloop.stop()},o.prototype.begin=s,o.prototype.end=s,o.prototype.update=s,o.prototype.render=s,o.prototype.addState=function(t){return t.game=this,this.states[t.name]=t,t.create(),this},o.prototype.startState=function(t){var e=this.states[t];if(e)return this.statestack.push(this.states[t])},o.prototype.stopState=function(t){var e=this.states[t];if(e)return this.statestack.pop(e)}},{"../timer/gameloop":37,"./statestack":10}],7:[function(t,e,n){e.exports={Game:t("./game"),State:t("./state"),StateList:t("./statelist"),StateStack:t("./statestack")}},{"./game":6,"./state":8,"./statelist":9,"./statestack":10}],8:[function(t,e,n){"use strict";function o(t){this.name=t}e.exports=o;var i=function(){};o.prototype.create=i,o.prototype.begin=i,o.prototype.update=i,o.prototype.render=i,o.prototype.end=i,o.prototype.onEnter=i,o.prototype.onExit=i},{}],9:[function(t,e,n){"use strict";function o(){this.states=[]}e.exports=o,o.prototype.pop=function(){return this.states.pop()},o.prototype.push=function(t){return this.states.push(t)},o.prototype.top=function(t){return t=t||0,this.states[this.states.length-(t+1)]}},{}],10:[function(t,e,n){"use strict";function o(){this.states=new i}var i=t("./statelist");e.exports=o,o.prototype.begin=function(t,e){for(var n=0,o=this.states.top(n);o;)o=o.begin(t,e)?!1:this.states.top(++n)},o.prototype.update=function(t){for(var e=0,n=this.states.top(e);n;)n=n.update(t)?!1:this.states.top(++e)},o.prototype.render=function(t){for(var e=0,n=this.states.top(e);n;)n=n.render(t)?!1:this.states.top(++e)},o.prototype.end=function(t,e){for(var n=0,o=this.states.top(n);o;)o=o.end(t,e)?!1:this.states.top(++n)},o.prototype.pop=function(){var t=this.states.pop();return t.onExit(),t},o.prototype.push=function(t){return this.states.push(t),t.onEnter()}},{"./statelist":9}],11:[function(t,e,n){"use strict";function o(t,e){var n;for(n in t)if("undefined"==typeof e[n])return!1;for(n in t)if(t[n])switch(typeof t[n]){case"object":if(!o(t[n],e[n]))return!1;break;case"function":if("undefined"==typeof e[n]||"equals"!==n&&t[n].toString()!==e[n].toString())return!1;break;default:if(t[n]!==e[n])return!1}else if(e[n])return!1;for(n in e)if("undefined"==typeof t[n])return!1;return!0}var i=i||{};i.util={},i.geometry={},e.exports=i;var r,s,a,l,u,p,c,d,f,g,m=function(t,e){this.x=t,this.y=e};i.geometry.Point=m,i.util.ArrayHelper=function(){};var v=i.util.ArrayHelper;v.create2DArray=function(t,e){for(var n=[],o=0;t>o;o++)n[o]=[];return n},v.valueEqual=function(t,e){return t===e?!0:o(t,e)?!0:!1},v.sortPointsClockwise=function(t){var e=!1;t instanceof i.util.ArrayList&&(t=t.toArray(),e=!0);for(var n,r=null,s=null,a=null,l=null,h=t,u=0;u<t.length;u++){var p=t[u];(null===r||r.y>p.y||r.y===p.y&&p.x<r.x)&&(r=p),(null===s||s.y<p.y||s.y===p.y&&p.x>s.x)&&(s=p),(null===a||a.x>p.x||a.x===p.x&&p.y>a.y)&&(a=p,n=u),(null===l||l.x<p.x||l.x===p.x&&p.y<l.y)&&(l=p)}if(n>0){h=[];for(var y=0,u=n;u<t.length;u++)h[y++]=t[u];for(var u=0;n>u;u++)h[y++]=t[u];t=h}for(var c=!1,u=0;u<t.length;u++){var p=t[u];if(o(p,s)){c=!0;break}if(o(p,r))break}if(c){h=[],h[0]=t[0];for(var y=1,u=t.length-1;u>0;u--)h[y++]=t[u];t=h}return e?new i.util.ArrayList(t):t};var _=i.util.ArrayHelper;i.util.ArrayList=function(t){this._array=[],null!=t&&(this._array=t)};var b=i.util.ArrayList.prototype;b.add=function(t){this._array.push(t)},b.get=function(t){return this._array[t]},b.size=function(){return this._array.length},b.clear=function(){this._array=[]},b.equals=function(t){if(this._array.length!=t.size())return!1;for(var e=0;e<this._array.length;e++){var n=this._array[e],o=t.get(e);if(!_.valueEqual(n,o))return!1}return!0},b.hashCode=function(){return 0},b.isEmpty=function(){return 0==this._array.length},b.toArray=function(){return this._array},i.geometry.Clip=function(){},i.geometry.Clip.DEBUG=!1,i.geometry.Clip.GPC_EPSILON=2.220446049250313e-16,i.geometry.Clip.GPC_VERSION="2.31",i.geometry.Clip.LEFT=0,i.geometry.Clip.RIGHT=1,i.geometry.Clip.ABOVE=0,i.geometry.Clip.BELOW=1,i.geometry.Clip.CLIP=0,i.geometry.Clip.SUBJ=1,r=i.geometry.Clip;var b=i.geometry.Clip.prototype,v=i.geometry.Clip;v.intersection=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),i.geometry.Clip.clip(i.geometry.OperationType.GPC_INT,t,e,n)},v.union=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),i.geometry.Clip.clip(i.geometry.OperationType.GPC_UNION,t,e,n)},v.xor=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),i.geometry.Clip.clip(i.geometry.OperationType.GPC_XOR,t,e,n)},v.difference=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),i.geometry.Clip.clip(i.geometry.OperationType.GPC_DIFF,e,t,n)},v.intersection=function(t,e){return i.geometry.Clip.clip(i.geometry.OperationType.GPC_INT,t,e,"PolyDefault.class")},v.createNewPoly=function(t){return"PolySimple"==t?new i.geometry.PolySimple:"PolyDefault"==t?new i.geometry.PolyDefault:"PolyDefault.class"==t?new i.geometry.PolyDefault:null},v.clip=function(t,e,n,o){var a=i.geometry.Clip.createNewPoly(o);if(e.isEmpty()&&n.isEmpty()||e.isEmpty()&&(t==i.geometry.OperationType.GPC_INT||t==i.geometry.OperationType.GPC_DIFF)||n.isEmpty()&&t==i.geometry.OperationType.GPC_INT)return a;t!=i.geometry.OperationType.GPC_INT&&t!=i.geometry.OperationType.GPC_DIFF||e.isEmpty()||n.isEmpty()||i.geometry.Clip.minimax_test(e,n,t);var h=new i.geometry.LmtTable,y=new i.geometry.ScanBeamTreeEntries,d=null,g=null;if(e.isEmpty()||(d=i.geometry.Clip.build_lmt(h,y,e,i.geometry.Clip.SUBJ,t)),i.geometry.Clip.DEBUG&&h.print(),n.isEmpty()||(g=i.geometry.Clip.build_lmt(h,y,n,i.geometry.Clip.CLIP,t)),i.geometry.Clip.DEBUG&&h.print(),null==h.top_node)return a;var m=y.build_sbt(),v=[];v[0]=i.geometry.Clip.LEFT,v[1]=i.geometry.Clip.LEFT,t==i.geometry.OperationType.GPC_DIFF&&(v[r.CLIP]=i.geometry.Clip.RIGHT),i.geometry.Clip.DEBUG;for(var x=h.top_node,_=new l,b=new u,P=0;P<m.length;){var E=m[P++],B=0,L=0;if(P<m.length&&(B=m[P],L=B-E),null!=x&&x.y==E){for(var C=x.first_bound;null!=C;C=C.next_bound)i.geometry.Clip.add_edge_to_aet(b,C);x=x.next}i.geometry.Clip.DEBUG&&b.print();var I=-Number.MAX_VALUE,O=b.top_node,S=b.top_node;b.top_node.bundle[r.ABOVE][b.top_node.type]=b.top_node.top.y!=E?1:0,b.top_node.bundle[r.ABOVE][0==b.top_node.type?1:0]=0,b.top_node.bstate[r.ABOVE]=s.UNBUNDLED;for(var T=b.top_node.next;null!=T;T=T.next){var w=T.type,A=0==T.type?1:0;T.bundle[r.ABOVE][w]=T.top.y!=E?1:0,T.bundle[r.ABOVE][A]=0,T.bstate[r.ABOVE]=s.UNBUNDLED,1==T.bundle[r.ABOVE][w]&&(r.EQ(O.xb,T.xb)&&i.geometry.Clip.EQ(O.dx,T.dx)&&O.top.y!=E&&(T.bundle[r.ABOVE][w]^=O.bundle[r.ABOVE][w],T.bundle[r.ABOVE][A]=O.bundle[r.ABOVE][A],T.bstate[r.ABOVE]=s.BUNDLE_HEAD,O.bundle[r.ABOVE][r.CLIP]=0,O.bundle[r.ABOVE][r.SUBJ]=0,O.bstate[r.ABOVE]=s.BUNDLE_TAIL),O=T)}var N=[];N[r.CLIP]=p.NH,N[r.SUBJ]=p.NH;var D=[];D[r.CLIP]=0,D[r.SUBJ]=0;for(var V=null,C=b.top_node;null!=C;C=C.next){if(D[r.CLIP]=C.bundle[r.ABOVE][r.CLIP]+(C.bundle[r.BELOW][r.CLIP]<<1),D[r.SUBJ]=C.bundle[r.ABOVE][r.SUBJ]+(C.bundle[r.BELOW][r.SUBJ]<<1),0!=D[r.CLIP]||0!=D[r.SUBJ]){C.bside[r.CLIP]=v[r.CLIP],C.bside[r.SUBJ]=v[r.SUBJ];var U=!1,M=0,k=0,H=0,X=0;if(t==i.geometry.OperationType.GPC_DIFF||t==i.geometry.OperationType.GPC_INT?(U=0!=D[r.CLIP]&&(0!=v[r.SUBJ]||0!=N[r.SUBJ])||0!=D[r.SUBJ]&&(0!=v[r.CLIP]||0!=N[r.CLIP])||0!=D[r.CLIP]&&0!=D[r.SUBJ]&&v[r.CLIP]==v[r.SUBJ],M=0!=v[r.CLIP]&&0!=v[r.SUBJ]?1:0,k=0!=(v[r.CLIP]^C.bundle[r.ABOVE][r.CLIP])&&0!=(v[r.SUBJ]^C.bundle[r.ABOVE][r.SUBJ])?1:0,H=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0))&&0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0))?1:0,X=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^C.bundle[r.BELOW][r.CLIP])&&0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^C.bundle[r.BELOW][r.SUBJ])?1:0):t==i.geometry.OperationType.GPC_XOR?(U=0!=D[r.CLIP]||0!=D[r.SUBJ],M=v[r.CLIP]^v[r.SUBJ],k=v[r.CLIP]^C.bundle[r.ABOVE][r.CLIP]^(v[r.SUBJ]^C.bundle[r.ABOVE][r.SUBJ]),H=v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)),X=v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^C.bundle[r.BELOW][r.CLIP]^(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^C.bundle[r.BELOW][r.SUBJ])):t==i.geometry.OperationType.GPC_UNION&&(U=!((0==D[r.CLIP]||0!=v[r.SUBJ]&&0==N[r.SUBJ])&&(0==D[r.SUBJ]||0!=v[r.CLIP]&&0==N[r.CLIP])&&(0==D[r.CLIP]||0==D[r.SUBJ]||v[r.CLIP]!=v[r.SUBJ])),M=0!=v[r.CLIP]||0!=v[r.SUBJ]?1:0,k=0!=(v[r.CLIP]^C.bundle[r.ABOVE][r.CLIP])||0!=(v[r.SUBJ]^C.bundle[r.ABOVE][r.SUBJ])?1:0,H=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0))||0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0))?1:0,X=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^C.bundle[r.BELOW][r.CLIP])||0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^C.bundle[r.BELOW][r.SUBJ])?1:0),v[r.CLIP]^=C.bundle[r.ABOVE][r.CLIP],v[r.SUBJ]^=C.bundle[r.ABOVE][r.SUBJ],0!=D[r.CLIP]&&(N[r.CLIP]=p.next_h_state[N[r.CLIP]][(D[r.CLIP]-1<<1)+v[r.CLIP]]),0!=D[r.SUBJ]&&(N[r.SUBJ]=p.next_h_state[N[r.SUBJ]][(D[r.SUBJ]-1<<1)+v[r.SUBJ]]),U){var R=C.xb,J=c.getType(H,X,M,k);switch(J){case c.EMN:case c.IMN:C.outp[r.ABOVE]=_.add_local_min(R,E),I=R,V=C.outp[r.ABOVE];break;case c.ERI:R!=I&&(V.add_right(R,E),I=R),C.outp[r.ABOVE]=V,V=null;break;case c.ELI:C.outp[r.BELOW].add_left(R,E),I=R,V=C.outp[r.BELOW];break;case c.EMX:R!=I&&(V.add_left(R,E),I=R),_.merge_right(V,C.outp[r.BELOW]),V=null;break;case c.ILI:R!=I&&(V.add_left(R,E),I=R),C.outp[r.ABOVE]=V,V=null;break;case c.IRI:C.outp[r.BELOW].add_right(R,E),I=R,V=C.outp[r.BELOW],C.outp[r.BELOW]=null;break;case c.IMX:R!=I&&(V.add_right(R,E),I=R),_.merge_left(V,C.outp[r.BELOW]),V=null,C.outp[r.BELOW]=null;break;case c.IMM:R!=I&&(V.add_right(R,E),I=R),_.merge_left(V,C.outp[r.BELOW]),C.outp[r.BELOW]=null,C.outp[r.ABOVE]=_.add_local_min(R,E),V=C.outp[r.ABOVE];break;case c.EMM:R!=I&&(V.add_left(R,E),I=R),_.merge_right(V,C.outp[r.BELOW]),C.outp[r.BELOW]=null,C.outp[r.ABOVE]=_.add_local_min(R,E),V=C.outp[r.ABOVE];break;case c.LED:C.bot.y==E&&C.outp[r.BELOW].add_left(R,E),C.outp[r.ABOVE]=C.outp[r.BELOW],I=R;break;case c.RED:C.bot.y==E&&C.outp[r.BELOW].add_right(R,E),C.outp[r.ABOVE]=C.outp[r.BELOW],I=R}}}i.geometry.Clip.DEBUG&&_.print(),_.print()}for(var C=b.top_node;null!=C;C=C.next)if(C.top.y==E){var F=C.prev,T=C.next;null!=F?F.next=T:b.top_node=T,null!=T&&(T.prev=F),C.bstate[r.BELOW]==s.BUNDLE_HEAD&&null!=F&&F.bstate[r.BELOW]==s.BUNDLE_TAIL&&(F.outp[r.BELOW]=C.outp[r.BELOW],F.bstate[r.BELOW]=s.UNBUNDLED,null!=F.prev&&F.prev.bstate[r.BELOW]==s.BUNDLE_TAIL&&(F.bstate[r.BELOW]=s.BUNDLE_HEAD))}else C.top.y==B?C.xt=C.top.x:C.xt=C.bot.x+C.dx*(B-C.bot.y);if(P<y.sbt_entries){var G=new f;G.build_intersection_table(b,L);for(var q=G.top_node;null!=q;q=q.next){if(O=q.ie[0],S=q.ie[1],!(0==O.bundle[r.ABOVE][r.CLIP]&&0==O.bundle[r.ABOVE][r.SUBJ]||0==S.bundle[r.ABOVE][r.CLIP]&&0==S.bundle[r.ABOVE][r.SUBJ])){var z=O.outp[r.ABOVE],Y=S.outp[r.ABOVE],W=q.point.x,j=q.point.y+E,Q=0!=O.bundle[r.ABOVE][r.CLIP]&&0==O.bside[r.CLIP]||0!=S.bundle[r.ABOVE][r.CLIP]&&0!=S.bside[r.CLIP]||0==O.bundle[r.ABOVE][r.CLIP]&&0==S.bundle[r.ABOVE][r.CLIP]&&0!=O.bside[r.CLIP]&&0!=S.bside[r.CLIP]?1:0,Z=0!=O.bundle[r.ABOVE][r.SUBJ]&&0==O.bside[r.SUBJ]||0!=S.bundle[r.ABOVE][r.SUBJ]&&0!=S.bside[r.SUBJ]||0==O.bundle[r.ABOVE][r.SUBJ]&&0==S.bundle[r.ABOVE][r.SUBJ]&&0!=O.bside[r.SUBJ]&&0!=S.bside[r.SUBJ]?1:0,H=0,X=0,M=0,k=0;t==i.geometry.OperationType.GPC_DIFF||t==i.geometry.OperationType.GPC_INT?(H=0!=Q&&0!=Z?1:0,X=0!=(Q^S.bundle[r.ABOVE][r.CLIP])&&0!=(Z^S.bundle[r.ABOVE][r.SUBJ])?1:0,M=0!=(Q^O.bundle[r.ABOVE][r.CLIP])&&0!=(Z^O.bundle[r.ABOVE][r.SUBJ])?1:0,k=0!=(Q^S.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP])&&0!=(Z^S.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])?1:0):t==i.geometry.OperationType.GPC_XOR?(H=Q^Z,X=Q^S.bundle[r.ABOVE][r.CLIP]^(Z^S.bundle[r.ABOVE][r.SUBJ]),M=Q^O.bundle[r.ABOVE][r.CLIP]^(Z^O.bundle[r.ABOVE][r.SUBJ]),k=Q^S.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP]^(Z^S.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])):t==i.geometry.OperationType.GPC_UNION&&(H=0!=Q||0!=Z?1:0,X=0!=(Q^S.bundle[r.ABOVE][r.CLIP])||0!=(Z^S.bundle[r.ABOVE][r.SUBJ])?1:0,M=0!=(Q^O.bundle[r.ABOVE][r.CLIP])||0!=(Z^O.bundle[r.ABOVE][r.SUBJ])?1:0,k=0!=(Q^S.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP])||0!=(Z^S.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])?1:0);var J=c.getType(H,X,M,k);switch(J){case c.EMN:O.outp[r.ABOVE]=_.add_local_min(W,j),S.outp[r.ABOVE]=O.outp[r.ABOVE];break;case c.ERI:null!=z&&(z.add_right(W,j),S.outp[r.ABOVE]=z,O.outp[r.ABOVE]=null);break;case c.ELI:null!=Y&&(Y.add_left(W,j),O.outp[r.ABOVE]=Y,S.outp[r.ABOVE]=null);break;case c.EMX:null!=z&&null!=Y&&(z.add_left(W,j),_.merge_right(z,Y),O.outp[r.ABOVE]=null,S.outp[r.ABOVE]=null);break;case c.IMN:O.outp[r.ABOVE]=_.add_local_min(W,j),S.outp[r.ABOVE]=O.outp[r.ABOVE];break;case c.ILI:null!=z&&(z.add_left(W,j),S.outp[r.ABOVE]=z,O.outp[r.ABOVE]=null);break;case c.IRI:null!=Y&&(Y.add_right(W,j),O.outp[r.ABOVE]=Y,S.outp[r.ABOVE]=null);break;case c.IMX:null!=z&&null!=Y&&(z.add_right(W,j),_.merge_left(z,Y),O.outp[r.ABOVE]=null,S.outp[r.ABOVE]=null);break;case c.IMM:null!=z&&null!=Y&&(z.add_right(W,j),_.merge_left(z,Y),O.outp[r.ABOVE]=_.add_local_min(W,j),S.outp[r.ABOVE]=O.outp[r.ABOVE]);break;case c.EMM:null!=z&&null!=Y&&(z.add_left(W,j),_.merge_right(z,Y),O.outp[r.ABOVE]=_.add_local_min(W,j),S.outp[r.ABOVE]=O.outp[r.ABOVE])}}0!=O.bundle[r.ABOVE][r.CLIP]&&(S.bside[r.CLIP]=0==S.bside[r.CLIP]?1:0),0!=S.bundle[r.ABOVE][r.CLIP]&&(O.bside[r.CLIP]=0==O.bside[r.CLIP]?1:0),0!=O.bundle[r.ABOVE][r.SUBJ]&&(S.bside[r.SUBJ]=0==S.bside[r.SUBJ]?1:0),0!=S.bundle[r.ABOVE][r.SUBJ]&&(O.bside[r.SUBJ]=0==O.bside[r.SUBJ]?1:0);var F=O.prev,T=S.next;if(null!=T&&(T.prev=O),O.bstate[r.ABOVE]==s.BUNDLE_HEAD)for(var K=!0;K;)F=F.prev,null!=F?F.bstate[r.ABOVE]!=s.BUNDLE_TAIL&&(K=!1):K=!1;null==F?(b.top_node.prev=S,S.next=b.top_node,b.top_node=O.next):(F.next.prev=S,S.next=F.next,F.next=O.next),O.next.prev=F,S.next.prev=S,O.next=T,i.geometry.Clip.DEBUG&&_.print()}for(var C=b.top_node;null!=C;C=C.next){var T=C.next,$=C.succ;if(C.top.y==B&&null!=$){$.outp[r.BELOW]=C.outp[r.ABOVE],$.bstate[r.BELOW]=C.bstate[r.ABOVE],$.bundle[r.BELOW][r.CLIP]=C.bundle[r.ABOVE][r.CLIP],$.bundle[r.BELOW][r.SUBJ]=C.bundle[r.ABOVE][r.SUBJ];var F=C.prev;null!=F?F.next=$:b.top_node=$,null!=T&&(T.prev=$),$.prev=F,$.next=T}else C.outp[r.BELOW]=C.outp[r.ABOVE],C.bstate[r.BELOW]=C.bstate[r.ABOVE],C.bundle[r.BELOW][r.CLIP]=C.bundle[r.ABOVE][r.CLIP],C.bundle[r.BELOW][r.SUBJ]=C.bundle[r.ABOVE][r.SUBJ],C.xb=C.xt;C.outp[r.ABOVE]=null}}}return a=_.getResult(o)},v.EQ=function(t,e){return Math.abs(t-e)<=i.geometry.Clip.GPC_EPSILON},v.PREV_INDEX=function(t,e){return(t-1+e)%e},v.NEXT_INDEX=function(t,e){return(t+1)%e},v.OPTIMAL=function(t,e){return t.getY(i.geometry.Clip.PREV_INDEX(e,t.getNumPoints()))!=t.getY(e)||t.getY(i.geometry.Clip.NEXT_INDEX(e,t.getNumPoints()))!=t.getY(e)},v.create_contour_bboxes=function(t){for(var e=[],n=0;n<t.getNumInnerPoly();n++){var o=t.getInnerPoly(n);e[n]=o.getBounds()}return e},v.minimax_test=function(t,e,n){for(var o=i.geometry.Clip.create_contour_bboxes(t),r=i.geometry.Clip.create_contour_bboxes(e),s=t.getNumInnerPoly(),a=e.getNumInnerPoly(),l=_.create2DArray(s,a),h=0;s>h;h++)for(var u=0;a>u;u++)l[h][u]=!(o[h].getMaxX()<r[u].getMinX()||o[h].getMinX()>r[u].getMaxX()||o[h].getMaxY()<r[u].getMinY()||o[h].getMinY()>r[u].getMaxY());for(var u=0;a>u;u++){for(var p=!1,h=0;!p&&s>h;h++)p=l[h][u];p||e.setContributing(u,!1)}if(n==i.geometry.OperationType.GPC_INT)for(var h=0;s>h;h++){for(var p=!1,u=0;!p&&a>u;u++)p=l[h][u];p||t.setContributing(h,!1)}},v.bound_list=function(t,e){if(null==t.top_node)return t.top_node=new a(e),t.top_node;for(var n=null,o=t.top_node,i=!1;!i;)if(e<o.y){var r=o;o=new a(e),o.next=r,null==n?t.top_node=o:n.next=o,i=!0}else e>o.y?null==o.next?(o.next=new a(e),o=o.next,i=!0):(n=o,o=o.next):i=!0;return o},v.insert_bound=function(t,e){if(null==t.first_bound)t.first_bound=e;else for(var n=!1,o=null,i=t.first_bound;!n;)e.bot.x<i.bot.x?(null==o?t.first_bound=e:o.next_bound=e,e.next_bound=i,n=!0):e.bot.x==i.bot.x&&e.dx<i.dx?(null==o?t.first_bound=e:o.next_bound=e,e.next_bound=i,n=!0):null==i.next_bound?(i.next_bound=e,n=!0):(o=i,i=i.next_bound)},v.add_edge_to_aet=function(t,e){if(null==t.top_node)t.top_node=e,e.prev=null,e.next=null;else for(var n=t.top_node,o=null,i=!1;!i;)e.xb<n.xb?(e.prev=o,e.next=n,n.prev=e,null==o?t.top_node=e:o.next=e,i=!0):e.xb==n.xb&&e.dx<n.dx?(e.prev=o,e.next=n,n.prev=e,null==o?t.top_node=e:o.next=e,i=!0):(o=n,null==n.next?(n.next=e,e.prev=n,e.next=null,i=!0):n=n.next)},v.add_to_sbtree=function(t,e){if(null==t.sb_tree)return t.sb_tree=new i.geometry.ScanBeamTree(e),void t.sbt_entries++;for(var n=t.sb_tree,o=!1;!o;)n.y>e?null==n.less?(n.less=new i.geometry.ScanBeamTree(e),t.sbt_entries++,o=!0):n=n.less:n.y<e?null==n.more?(n.more=new i.geometry.ScanBeamTree(e),t.sbt_entries++,o=!0):n=n.more:o=!0},v.build_lmt=function(t,e,n,o,a){for(var l=new i.geometry.EdgeTable,h=0;h<n.getNumInnerPoly();h++){var u=n.getInnerPoly(h);if(u.isContributing(0)){var p=0,y=0;l=new i.geometry.EdgeTable;for(var c=0;c<u.getNumPoints();c++)if(i.geometry.Clip.OPTIMAL(u,c)){var d=u.getX(c),f=u.getY(c);l.addNode(d,f),i.geometry.Clip.add_to_sbtree(e,u.getY(c)),p++}for(var g=0;p>g;g++)if(l.FWD_MIN(g)){for(var m=1,v=i.geometry.Clip.NEXT_INDEX(g,p);l.NOT_FMAX(v);)m++,v=i.geometry.Clip.NEXT_INDEX(v,p);var x=g,_=l.getNode(y);_.bstate[i.geometry.Clip.BELOW]=i.geometry.BundleState.UNBUNDLED,_.bundle[i.geometry.Clip.BELOW][r.CLIP]=0,_.bundle[i.geometry.Clip.BELOW][r.SUBJ]=0;for(var c=0;m>c;c++){var b=l.getNode(y+c),P=l.getNode(x);b.xb=P.vertex.x,b.bot.x=P.vertex.x,b.bot.y=P.vertex.y,x=i.geometry.Clip.NEXT_INDEX(x,p),P=l.getNode(x),b.top.x=P.vertex.x,b.top.y=P.vertex.y,b.dx=(P.vertex.x-b.bot.x)/(b.top.y-b.bot.y),b.type=o,b.outp[i.geometry.Clip.ABOVE]=null,b.outp[i.geometry.Clip.BELOW]=null,b.next=null,b.prev=null,b.succ=m>1&&m-1>c?l.getNode(y+c+1):null,b.pred=m>1&&c>0?l.getNode(y+c-1):null,b.next_bound=null,b.bside[i.geometry.Clip.CLIP]=a==i.geometry.OperationType.GPC_DIFF?i.geometry.Clip.RIGHT:i.geometry.Clip.LEFT,b.bside[i.geometry.Clip.SUBJ]=i.geometry.Clip.LEFT}r.insert_bound(i.geometry.Clip.bound_list(t,l.getNode(g).vertex.y),_),i.geometry.Clip.DEBUG&&t.print(),y+=m}for(var g=0;p>g;g++)if(l.REV_MIN(g)){for(var m=1,v=i.geometry.Clip.PREV_INDEX(g,p);l.NOT_RMAX(v);)m++,v=i.geometry.Clip.PREV_INDEX(v,p);var x=g,_=l.getNode(y);_.bstate[i.geometry.Clip.BELOW]=s.UNBUNDLED,_.bundle[i.geometry.Clip.BELOW][i.geometry.Clip.CLIP]=0,_.bundle[i.geometry.Clip.BELOW][i.geometry.Clip.SUBJ]=0;for(var c=0;m>c;c++){var b=l.getNode(y+c),P=l.getNode(x);b.xb=P.vertex.x,b.bot.x=P.vertex.x,b.bot.y=P.vertex.y,x=i.geometry.Clip.PREV_INDEX(x,p),P=l.getNode(x),b.top.x=P.vertex.x,b.top.y=P.vertex.y,b.dx=(P.vertex.x-b.bot.x)/(b.top.y-b.bot.y),b.type=o,b.outp[i.geometry.Clip.ABOVE]=null,b.outp[i.geometry.Clip.BELOW]=null,b.next=null,b.prev=null,b.succ=m>1&&m-1>c?l.getNode(y+c+1):null,b.pred=m>1&&c>0?l.getNode(y+c-1):null,b.next_bound=null,b.bside[i.geometry.Clip.CLIP]=a==i.geometry.OperationType.GPC_DIFF?i.geometry.Clip.RIGHT:i.geometry.Clip.LEFT,b.bside[i.geometry.Clip.SUBJ]=i.geometry.Clip.LEFT}r.insert_bound(i.geometry.Clip.bound_list(t,l.getNode(g).vertex.y),_),i.geometry.Clip.DEBUG&&t.print(),y+=m}}else u.setContributing(0,!0)}return l},v.add_st_edge=function(t,e,n,o){if(null==t)t=new i.geometry.StNode(n,null);else{var r=t.xt-t.xb-(n.xt-n.xb);if(n.xt>=t.xt||n.dx==t.dx||Math.abs(r)<=i.geometry.Clip.GPC_EPSILON){var s=t;t=new g(n,s)}else{var a=(n.xb-t.xb)/r,l=t.xb+a*(t.xt-t.xb),h=a*o;e.top_node=i.geometry.Clip.add_intersection(e.top_node,t.edge,n,l,h),t.prev=i.geometry.Clip.add_st_edge(t.prev,e,n,o)}}return t},v.add_intersection=function(t,e,n,o,r){if(null==t)t=new i.geometry.ItNode(e,n,o,r,null);else if(t.point.y>r){var s=t;t=new i.geometry.ItNode(e,n,o,r,s)}else t.next=i.geometry.Clip.add_intersection(t.next,e,n,o,r);return t},i.geometry.AetTree=function(){this.top_node=null},u=i.geometry.AetTree,i.geometry.AetTree.prototype.print=function(){for(var t=this.top_node;null!=t;t=t.next);},i.geometry.BundleState=function(t){this.m_State=t},i.geometry.BundleState.UNBUNDLED=new i.geometry.BundleState("UNBUNDLED"),i.geometry.BundleState.BUNDLE_HEAD=new i.geometry.BundleState("BUNDLE_HEAD"),i.geometry.BundleState.BUNDLE_TAIL=new i.geometry.BundleState("BUNDLE_TAIL"),i.geometry.BundleState.prototype.toString=function(){return this.m_State},s=i.geometry.BundleState,i.geometry.EdgeNode=function(){this.vertex=new m,this.bot=new m,this.top=new m,this.xb,this.xt,this.dx,this.type,this.bundle=_.create2DArray(2,2),this.bside=[],this.bstate=[],this.outp=[],this.prev,this.next,this.pred,this.succ,this.next_bound},i.geometry.EdgeTable=function(){this.m_List=new i.util.ArrayList},i.geometry.EdgeTable.prototype.addNode=function(t,e){var n=new i.geometry.EdgeNode;n.vertex.x=t,n.vertex.y=e,this.m_List.add(n)},i.geometry.EdgeTable.prototype.getNode=function(t){return this.m_List.get(t)},i.geometry.EdgeTable.prototype.FWD_MIN=function(t){var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),o=e.get(r.NEXT_INDEX(t,e.size())),i=e.get(t);return n.vertex.y>=i.vertex.y&&o.vertex.y>i.vertex.y},i.geometry.EdgeTable.prototype.NOT_FMAX=function(t){var e=this.m_List,n=e.get(r.NEXT_INDEX(t,e.size())),o=e.get(t);return n.vertex.y>o.vertex.y},i.geometry.EdgeTable.prototype.REV_MIN=function(t){var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),o=e.get(r.NEXT_INDEX(t,e.size())),i=e.get(t);return n.vertex.y>i.vertex.y&&o.vertex.y>=i.vertex.y},i.geometry.EdgeTable.prototype.NOT_RMAX=function(t){
var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),o=e.get(t);return n.vertex.y>o.vertex.y},i.geometry.HState=function(){},i.geometry.HState.NH=0,i.geometry.HState.BH=1,i.geometry.HState.TH=2,p=i.geometry.HState;var P=i.geometry.HState.NH,E=i.geometry.HState.BH,B=i.geometry.HState.TH;i.geometry.HState.next_h_state=[[E,B,B,E,P,P],[P,P,P,P,B,B],[P,P,P,P,E,E]],i.geometry.IntersectionPoint=function(t,e,n){this.polygonPoint1=t,this.polygonPoint2=e,this.intersectionPoint=n},i.geometry.IntersectionPoint.prototype.toString=function(){return"P1 :"+polygonPoint1.toString()+" P2:"+polygonPoint2.toString()+" IP:"+intersectionPoint.toString()},i.geometry.ItNode=function(t,e,n,o,i){this.ie=[],this.point=new m(n,o),this.next=i,this.ie[0]=t,this.ie[1]=e},i.geometry.ItNodeTable=function(){this.top_node},f=i.geometry.ItNodeTable,i.geometry.ItNodeTable.prototype.build_intersection_table=function(t,e){for(var n=null,o=t.top_node;null!=o;o=o.next)(o.bstate[r.ABOVE]==s.BUNDLE_HEAD||0!=o.bundle[r.ABOVE][r.CLIP]||0!=o.bundle[r.ABOVE][r.SUBJ])&&(n=i.geometry.Clip.add_st_edge(n,this,o,e))},i.geometry.Line=function(){this.start,this.end},i.geometry.LineHelper=function(){},i.geometry.LineHelper.equalPoint=function(t,e){return t[0]==e[0]&&t[1]==e[1]},i.geometry.LineHelper.equalVertex=function(t,e,n,o){return i.geometry.LineHelper.equalPoint(t,n)&&i.geometry.LineHelper.equalPoint(e,o)||i.geometry.LineHelper.equalPoint(t,o)&&i.geometry.LineHelper.equalPoint(e,n)},i.geometry.LineHelper.distancePoints=function(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},i.geometry.LineHelper.clonePoint=function(t){return[t[0],t[1]]},i.geometry.LineHelper.cloneLine=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=[t[n][0],t[n][1]];return e},i.geometry.LineHelper.addLineToLine=function(t,e){for(var n=0;n<e.length;n++)t.push(clonePoint(e[n]))},i.geometry.LineHelper.roundPoint=function(t){t[0]=Math.round(t[0]),t[1]=Math.round(t[1])},i.geometry.LineHelper.lineIntersectLine=function(t,e,n,o,i){null==i&&(i=!0);var r,s,a,l,h,u,p;s=e.y-t.y,l=t.x-e.x,u=e.x*t.y-t.x*e.y,a=o.y-n.y,h=n.x-o.x,p=o.x*n.y-n.x*o.y;var y=s*h-a*l;if(0==y)return null;if(r=new m,r.x=(l*p-h*u)/y,r.y=(a*u-s*p)/y,i){if(Math.pow(r.x-e.x+(r.y-e.y),2)>Math.pow(t.x-e.x+(t.y-e.y),2))return null;if(Math.pow(r.x-t.x+(r.y-t.y),2)>Math.pow(t.x-e.x+(t.y-e.y),2))return null;if(Math.pow(r.x-o.x+(r.y-o.y),2)>Math.pow(n.x-o.x+(n.y-o.y),2))return null;if(Math.pow(r.x-n.x+(r.y-n.y),2)>Math.pow(n.x-o.x+(n.y-o.y),2))return null}return new m(Math.round(r.x),Math.round(r.y))},i.geometry.LineIntersection=function(){},i.geometry.LineIntersection.iteratePoints=function(t,e,n,i,r){var s=!0,a=t.length,l=t.indexOf(e),h=t.indexOf(n),u=l;h>l&&(s=!1);var p,y=[];if(s)for(var c=0;a>c&&(p=a>c+u?t[c+u]:t[c+u-a],y.push(p),!o(p,i)&&!o(p,r));c++);else for(var c=a;c>=0&&(p=a>c+u?t[c+u]:t[c+u-a],y.push(p),!o(p,i)&&!o(p,r));c--);return y},i.geometry.LineIntersection.intersectPoly=function(t,e){for(var n,r,s,a,l,h=t.getNumPoints(),u=null,p=null,y=-1,c=-1,d=!1,f=1;f<e.length;f++){r=e[f-1],s=e[f];for(var g=0,v=Number.MAX_VALUE,x=-1,_=0;h>_;_++)a=t.getPoint(0==_?h-1:_-1),l=t.getPoint(_),null!=(n=LineHelper.lineIntersectLine(r,s,a,l))&&(x=m.distance(n,s),x>g&&!d&&(g=x,u=new IntersectionPoint(a,l,n),y=f),v>x&&(v=x,p=new IntersectionPoint(a,l,n),c=f-1));d=null!=u}if(null!=u&&null!=p){var b=[];b[0]=u.intersectionPoint;for(var _=1,f=y;c>=f;f++)b[_++]=e[f];if(b[b.length-1]=p.intersectionPoint,o(u.polygonPoint1,p.polygonPoint1)&&o(u.polygonPoint2,p.polygonPoint2)||o(u.polygonPoint1,p.polygonPoint2)&&o(u.polygonPoint2,p.polygonPoint1)){var P=new i.geometry.PolySimple;P.add(b);var E=t.intersection(P),B=t.xor(P);if(checkPoly(E)&&checkPoly(B))return[E,B]}else{var L=iteratePoints(t.getPoints(),u.polygonPoint1,u.polygonPoint2,p.polygonPoint1,p.polygonPoint2);L=L.concat(b.reverse());var C=iteratePoints(t.getPoints(),u.polygonPoint2,u.polygonPoint1,p.polygonPoint1,p.polygonPoint2);C=C.concat(b);var P=new i.geometry.PolySimple;P.add(L);var I=new i.geometry.PolySimple;I.add(C);var E=t.intersection(P),B=t.intersection(I);if(checkPoly(E)&&checkPoly(B))return[E,B]}}return null},i.geometry.LineIntersection.checkPoly=function(t){for(var e=0,n=0;n<t.getNumInnerPoly();n++){var o=t.getInnerPoly(n);if(o.isHole())return!1;if(e++,e>1)return!1}return!0},i.geometry.LmtNode=function(t){this.y=t,this.first_bound,this.next},a=i.geometry.LmtNode,i.geometry.LmtTable=function(){this.top_node},i.geometry.LmtTable.prototype.print=function(){for(var t=0,e=this.top_node;null!=e;){for(var n=e.first_bound;null!=n;n=n.next_bound);t++,e=e.next}},i.geometry.OperationType=function(t){this.m_Type=t},i.geometry.OperationType.GPC_DIFF=new i.geometry.OperationType("Difference"),i.geometry.OperationType.GPC_INT=new i.geometry.OperationType("Intersection"),i.geometry.OperationType.GPC_XOR=new i.geometry.OperationType("Exclusive or"),i.geometry.OperationType.GPC_UNION=new i.geometry.OperationType("Union"),i.geometry.PolyDefault=function(t){null==t&&(t=!1),this.m_IsHole=t,this.m_List=new i.util.ArrayList},i.geometry.PolyDefault.prototype.equals=function(t){if(!(t instanceof PolyDefault))return!1;var e=t;return this.m_IsHole!=e.m_IsHole?!1:o(this.m_List,e.m_List)?!0:!1},i.geometry.PolyDefault.prototype.hashCode=function(){var t=this.m_List,e=17;return e=37*e+t.hashCode()},i.geometry.PolyDefault.prototype.clear=function(){this.m_List.clear()},i.geometry.PolyDefault.prototype.add=function(t,e){var n=[];if(n[0]=t,e&&(n[1]=e),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof m)this.addPoint(n[0]);else if(n[0]instanceof i.geometry.PolySimple)this.addPoly(n[0]);else if(n[0]instanceof Array){var o=n[0];if(2==o.length&&o[0]instanceof Number&&o[1]instanceof Number)this.add(o[0],o[1]);else for(var r=0;r<n[0].length;r++)this.add(n[0][r])}},i.geometry.PolyDefault.prototype.addPointXY=function(t,e){this.addPoint(new m(t,e))},i.geometry.PolyDefault.prototype.addPoint=function(t){var e=this.m_List;0==e.size()&&e.add(new i.geometry.PolySimple),e.get(0).addPoint(t)},i.geometry.PolyDefault.prototype.addPoly=function(t){var e=this.m_IsHole,n=this.m_List;n.size()>0&&e&&alert("ERROR : Cannot add polys to something designated as a hole."),n.add(t)},i.geometry.PolyDefault.prototype.isEmpty=function(){return this.m_List.isEmpty()},i.geometry.PolyDefault.prototype.getBounds=function(){var t=this.m_List;if(0==t.size())return new Rectangle;if(1==t.size()){var e=this.getInnerPoly(0);return e.getBounds()}console.log("getBounds not supported on complex poly.")},i.geometry.PolyDefault.prototype.getInnerPoly=function(t){return this.m_List.get(t)},i.geometry.PolyDefault.prototype.getNumInnerPoly=function(){var t=this.m_List;return t.size()},i.geometry.PolyDefault.prototype.getNumPoints=function(){return this.m_List.get(0).getNumPoints()},i.geometry.PolyDefault.prototype.getX=function(t){return this.m_List.get(0).getX(t)},i.geometry.PolyDefault.prototype.getPoint=function(t){return this.m_List.get(0).getPoint(t)},i.geometry.PolyDefault.prototype.getPoints=function(){return this.m_List.get(0).getPoints()},i.geometry.PolyDefault.prototype.isPointInside=function(t){var e=this.m_List;if(!e.get(0).isPointInside(t))return!1;for(var n=0;n<e.size();n++){var o=e.get(n);if(o.isHole()&&o.isPointInside(t))return!1}return!0},i.geometry.PolyDefault.prototype.getY=function(t){var e=this.m_List;return e.get(0).getY(t)},i.geometry.PolyDefault.prototype.isHole=function(){var t=this.m_List,e=this.m_IsHole;return t.size()>1&&alert("Cannot call on a poly made up of more than one poly."),e},i.geometry.PolyDefault.prototype.setIsHole=function(t){var e=this.m_List;e.size()>1&&alert("Cannot call on a poly made up of more than one poly."),this.m_IsHole=t},i.geometry.PolyDefault.prototype.isContributing=function(t){var e=this.m_List;return e.get(t).isContributing(0)},i.geometry.PolyDefault.prototype.setContributing=function(t,e){var n=this.m_List;1!=n.size()&&alert("Only applies to polys of size 1"),n.get(t).setContributing(0,e)},i.geometry.PolyDefault.prototype.intersection=function(t){return i.geometry.Clip.intersection(t,this,"PolyDefault")},i.geometry.PolyDefault.prototype.union=function(t){return i.geometry.Clip.union(t,this,"PolyDefault")},i.geometry.PolyDefault.prototype.xor=function(t){return i.geometry.Clip.xor(t,this,"PolyDefault")},i.geometry.PolyDefault.prototype.difference=function(t){return i.geometry.Clip.difference(t,this,"PolyDefault")},i.geometry.PolyDefault.prototype.getArea=function(){for(var t=0,e=0;e<getNumInnerPoly();e++){var n=getInnerPoly(e),o=n.getArea()*(n.isHole()?-1:1);t+=o}return t},i.geometry.PolyDefault.prototype.toString=function(){for(var t="",e=this.m_List,n=0;n<e.size();n++){var o=this.getInnerPoly(n);t+="InnerPoly("+n+").hole="+o.isHole();for(var i=[],r=0;r<o.getNumPoints();r++)i.push(new m(o.getX(r),o.getY(r)));i=_.sortPointsClockwise(i);for(var s=0;s<i.length;s++)t+=i[s].toString()}return t},i.geometry.Polygon=function(){this.maxTop,this.maxBottom,this.maxLeft,this.maxRight,this.vertices},i.geometry.Polygon.prototype.fromArray=function(t){this.vertices=[];for(var e=0;e<t.length;e++){var n=t[e];this.vertices.push(new m(n[0],n[1]))}},i.geometry.Polygon.prototype.normalize=function(){for(var t,e=this.vertices,n=this.vertices,i=0;i<e.length;i++){var r=e[i];(null==maxTop||maxTop.y>r.y||maxTop.y==r.y&&r.x<maxTop.x)&&(maxTop=r),(null==maxBottom||maxBottom.y<r.y||maxBottom.y==r.y&&r.x>maxBottom.x)&&(maxBottom=r),(null==maxLeft||maxLeft.x>r.x||maxLeft.x==r.x&&r.y>maxLeft.y)&&(maxLeft=r,t=i),(null==maxRight||maxRight.x<r.x||maxRight.x==r.x&&r.y<maxRight.y)&&(maxRight=r)}if(t>0){n=[];for(var s=0,i=t;i<e.length;i++)n[s++]=this.vertices[i];for(var i=0;t>i;i++)n[s++]=this.vertices[i];e=n}for(var a=!1,l=0;l<this.vertices.length;l++){var r=this.vertices[l];if(o(r,maxBottom)){a=!0;break}if(o(r,maxTop))break}if(a){n=[],n[0]=e[0];for(var s=1,i=e.length-1;i>0;i--)n[s++]=this.vertices[i];e=n}},i.geometry.Polygon.prototype.getVertexIndex=function(t){for(var e=0;e<this.vertices.length;e++)if(o(vertices[e],t))return e;return-1},i.geometry.Polygon.prototype.insertVertex=function(t,e,n){var o=getVertexIndex(t),i=getVertexIndex(e);if(-1==o||-1==i)return!1;if(o>i){var r=o;o=i,i=r}if(i==o+1){for(var s=[],r=0;o>=r;r++)s[r]=this.vertices[r];s[i]=n;for(var r=i;r<this.vertices.length;r++)s[r+1]=this.vertices[r];this.vertices=s}else i==vertices.length-1&&0==o&&this.vertices.push(n);return!0},i.geometry.Polygon.prototype.clone=function(){var t=new i.geometry.Polygon;return t.vertices=vertices.slice(this.vertices.length-1),t},i.geometry.Polygon.prototype.toString=function(){for(var t=this.vertices,e="[",n=0;n<t.length;n++){var o=t[n];e+=(n>0?",":"")+"["+o.x+","+o.y+"]"}return e+="]"},i.geometry.PolygonNode=function(t,e,n){this.active,this.hole,this.v=[],this.next,this.proxy;var o=new d(e,n);this.v[r.LEFT]=o,this.v[r.RIGHT]=o,this.next=t,this.proxy=this,this.active=1},i.geometry.PolygonNode.prototype.add_right=function(t,e){var n=new d(t,e);this.proxy.v[r.RIGHT].next=n,this.proxy.v[r.RIGHT]=n},i.geometry.PolygonNode.prototype.add_left=function(t,e){var n=this.proxy,o=new d(t,e);o.next=n.v[r.LEFT],n.v[r.LEFT]=o},i.geometry.PolySimple=function(){this.m_List=new i.util.ArrayList,this.m_Contributes=!0},i.geometry.PolySimple.prototype.equals=function(t){if(!(t instanceof PolySimple))return!1;var e=t,n=this.m_List.size(),o=e.m_List.size();if(n!=o)return!1;if(n>0){for(var i=this.getX(0),r=this.getY(0),s=-1,a=0;-1==s&&o>a;a++){var l=e.getX(a),h=e.getY(a);i==l&&r==h&&(s=a)}if(-1==s)return!1;for(var a=s,u=0;n>u;u++){i=this.getX(u),r=this.getY(u);var l=e.getX(a),h=e.getY(a);if(i!=l||r!=h)return!1;a++,a>=o&&(a=0)}}return!0},i.geometry.PolySimple.prototype.hashCode=function(){var t=17;return t=37*t+this.m_List.hashCode()},i.geometry.PolySimple.prototype.toString=function(){return"PolySimple: num_points="+getNumPoints()},i.geometry.PolySimple.prototype.clear=function(){this.m_List.clear()},i.geometry.PolySimple.prototype.add=function(t,e){var n=[];if(n[0]=t,e&&(n[1]=e),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof m)this.addPoint(n[0]);else if(n[0]instanceof Poly)this.addPoly(n[0]);else if(n[0]instanceof Array)for(var o=0;o<n[0].length;o++){var i=n[0][o];this.add(i)}},i.geometry.PolySimple.prototype.addPointXY=function(t,e){this.addPoint(new m(t,e))},i.geometry.PolySimple.prototype.addPoint=function(t){this.m_List.add(t)},i.geometry.PolySimple.prototype.addPoly=function(t){alert("Cannot add poly to a simple poly.")},i.geometry.PolySimple.prototype.isEmpty=function(){return this.m_List.isEmpty()},i.geometry.PolySimple.prototype.getBounds=function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=-Number.MAX_VALUE,i=0;i<this.m_List.size();i++){var r=this.getX(i),s=this.getY(i);t>r&&(t=r),r>n&&(n=r),e>s&&(e=s),s>o&&(o=s)}return new Rectangle(t,e,n-t,o-e)},i.geometry.PolySimple.prototype.getInnerPoly=function(t){return 0!=t&&alert("PolySimple only has one poly"),this},i.geometry.PolySimple.prototype.getNumInnerPoly=function(){return 1},i.geometry.PolySimple.prototype.getNumPoints=function(){return this.m_List.size()},i.geometry.PolySimple.prototype.getX=function(t){return this.m_List.get(t).x},i.geometry.PolySimple.prototype.getY=function(t){return this.m_List.get(t).y},i.geometry.PolySimple.prototype.getPoint=function(t){return this.m_List.get(t)},i.geometry.PolySimple.prototype.getPoints=function(){return this.m_List.toArray()},i.geometry.PolySimple.prototype.isPointInside=function(t){for(var e=this.getPoints(),n=e.length-1,o=!1,i=0;i<e.length;i++)(e[i].y<t.y&&e[n].y>=t.y||e[n].y<t.y&&e[i].y>=t.y)&&e[i].x+(t.y-e[i].y)/(e[n].y-e[i].y)*(e[n].x-e[i].x)<t.x&&(o=!o),n=i;return o},i.geometry.PolySimple.prototype.isHole=function(){return!1},i.geometry.PolySimple.prototype.setIsHole=function(t){alert("PolySimple cannot be a hole")},i.geometry.PolySimple.prototype.isContributing=function(t){return 0!=t&&alert("PolySimple only has one poly"),this.m_Contributes},i.geometry.PolySimple.prototype.setContributing=function(t,e){0!=t&&alert("PolySimple only has one poly"),this.m_Contributes=e},i.geometry.PolySimple.prototype.intersection=function(t){return i.geometry.Clip.intersection(this,t,"PolySimple")},i.geometry.PolySimple.prototype.union=function(t){return i.geometry.Clip.union(this,t,"PolySimple")},i.geometry.PolySimple.prototype.xor=function(t){return i.geometry.Clip.xor(t,this,"PolySimple")},i.geometry.PolySimple.prototype.difference=function(t){return i.geometry.Clip.difference(t,this,"PolySimple")},i.geometry.PolySimple.prototype.getArea=function(){if(this.getNumPoints()<3)return 0;for(var t=this.getX(0),e=this.getY(0),n=0,o=1;o<this.getNumPoints()-1;o++){var i=this.getX(o),r=this.getY(o),s=this.getX(o+1),a=this.getY(o+1),l=(s-i)*(e-r)-(t-i)*(a-r);n+=l}return n=.5*Math.abs(n)},i.geometry.Rectangle=function(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o},i.geometry.Rectangle.prototype.getMaxY=function(){return this.y+this.h},i.geometry.Rectangle.prototype.getMinY=function(){return this.y},i.geometry.Rectangle.prototype.getMaxX=function(){return this.x+this.w},i.geometry.Rectangle.prototype.getMinX=function(){return this.x},i.geometry.Rectangle.prototype.toString=function(){return"["+x.toString()+" "+y.toString()+" "+w.toString()+" "+h.toString()+"]"},i.geometry.ScanBeamTree=function(t){this.y=t,this.less,this.more},i.geometry.ScanBeamTreeEntries=function(){this.sbt_entries=0,this.sb_tree},i.geometry.ScanBeamTreeEntries.prototype.build_sbt=function(){var t=[],e=0;return e=this.inner_build_sbt(e,t,this.sb_tree),e!=this.sbt_entries,t},i.geometry.ScanBeamTreeEntries.prototype.inner_build_sbt=function(t,e,n){return null!=n.less&&(t=this.inner_build_sbt(t,e,n.less)),e[t]=n.y,t++,null!=n.more&&(t=this.inner_build_sbt(t,e,n.more)),t},g=i.geometry.StNode=function(t,e){this.edge,this.xb,this.xt,this.dx,this.prev,this.edge=t,this.xb=t.xb,this.xt=t.xt,this.dx=t.dx,this.prev=e},i.geometry.TopPolygonNode=function(){this.top_node},l=i.geometry.TopPolygonNode,i.geometry.TopPolygonNode.prototype.add_local_min=function(t,e){var n=this.top_node;return this.top_node=new i.geometry.PolygonNode(n,t,e),this.top_node},i.geometry.TopPolygonNode.prototype.merge_left=function(t,e){e.proxy.hole=!0;var n=this.top_node;if(t.proxy!=e.proxy){t.proxy.v[r.RIGHT].next=e.proxy.v[r.LEFT],e.proxy.v[r.LEFT]=t.proxy.v[r.LEFT];for(var o=t.proxy,i=n;null!=i;i=i.next)i.proxy==o&&(i.active=0,i.proxy=e.proxy)}},i.geometry.TopPolygonNode.prototype.merge_right=function(t,e){var n=this.top_node;if(e.proxy.hole=!1,t.proxy!=e.proxy){e.proxy.v[r.RIGHT].next=t.proxy.v[r.LEFT],e.proxy.v[r.RIGHT]=t.proxy.v[r.RIGHT];for(var o=t.proxy,i=n;null!=i;i=i.next)i.proxy==o&&(i.active=0,i.proxy=e.proxy)}},i.geometry.TopPolygonNode.prototype.count_contours=function(){for(var t=0,e=this.top_node;null!=e;e=e.next)if(0!=e.active){for(var n=0,o=e.proxy.v[r.LEFT];null!=o;o=o.next)n++;n>2?(e.active=n,t++):e.active=0}return t},i.geometry.TopPolygonNode.prototype.getResult=function(t){var e=this.top_node,n=i.geometry.Clip.createNewPoly(t),o=this.count_contours();if(o>0){for(var s=0,a=null,l=e;null!=l;l=a)if(a=l.next,0!=l.active){var h=n;o>1&&(h=i.geometry.Clip.createNewPoly(t)),l.proxy.hole&&h.setIsHole(l.proxy.hole);for(var u=l.proxy.v[r.LEFT];null!=u;u=u.next)h.add(u.x,u.y);o>1&&n.addPoly(h),s++}var p=n;n=i.geometry.Clip.createNewPoly(t);for(var y=0;y<p.getNumInnerPoly();y++){var c=p.getInnerPoly(y);c.isHole()||n.addPoly(c)}for(var y=0;y<p.getNumInnerPoly();y++){var c=p.getInnerPoly(y);c.isHole()&&n.addPoly(c)}}return n},i.geometry.TopPolygonNode.prototype.print=function(){for(var t=this.top_node,e=0,n=null,o=t;null!=o;o=n)if(n=o.next,0!=o.active){for(var i=o.proxy.v[r.LEFT];null!=i;i=i.next);e++}},i.geometry.VertexNode=function(t,e){this.x,this.y,this.next,this.x=t,this.y=e,this.next=null},d=i.geometry.VertexNode,i.geometry.VertexType=function(){},i.geometry.VertexType.NUL=0,i.geometry.VertexType.EMX=1,i.geometry.VertexType.ELI=2,i.geometry.VertexType.TED=3,i.geometry.VertexType.ERI=4,i.geometry.VertexType.RED=5,i.geometry.VertexType.IMM=6,i.geometry.VertexType.IMN=7,i.geometry.VertexType.EMN=8,i.geometry.VertexType.EMM=9,i.geometry.VertexType.LED=10,i.geometry.VertexType.ILI=11,i.geometry.VertexType.BED=12,i.geometry.VertexType.IRI=13,i.geometry.VertexType.IMX=14,i.geometry.VertexType.FUL=15,i.geometry.VertexType.getType=function(t,e,n,o){return t+(e<<1)+(n<<2)+(o<<3)},c=i.geometry.VertexType,i.geometry.WeilerAtherton=function(){},i.geometry.WeilerAtherton.prototype.merge=function(t,e){t=t.clone(),e=e.clone()}},{}],12:[function(t,e,n){"use strict";function o(t,e,n,o){this.x=t,this.y=e,this.width=n,this.height=o,this.items=[]}var i=function(t,e,n,o,i,r,s,a){var l=(s-i)*(e-r)-(a-r)*(t-i),h=(n-t)*(e-r)-(o-e)*(t-i),u=(a-r)*(n-t)-(s-i)*(o-e);if(0!==u){var p=l/u,y=h/u;if(p>=0&&1>=p&&y>=0&&1>=y)return!0}return!1};o.prototype.insert=function(t){(t.fromX>=this.x&&t.fromY>=this.y&&t.toX<=this.x+this.width&&t.toY<=this.y+this.height||i(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y,this.x+this.width,this.y)||i(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y,this.x,this.y+this.height)||i(t.fromX,t.fromY,t.toX,t.toY,this.x+this.width,this.y,this.x+this.width,this.y+this.height)||i(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y+this.height,this.x+this.width,this.y+this.height))&&this.items.push(t)},e.exports=o},{}],13:[function(t,e,n){"use strict";function o(t,e,n){this.bounds=t,this.rows=e,this.cols=n,this.cellX=this.bounds.width/this.cols,this.cellY=this.bounds.height/this.rows,this.cells=[],this.out=new r;for(var o=0;o<this.cols;o++){this.cells[o]=[];for(var s=0;s<this.rows;s++)this.cells[o][s]=new i(o*this.cellX,s*this.cellY,this.cellX,this.cellY)}}var i=t("./cell"),r=t("../../linkedlist/doublylinkedlist");o.prototype.insert=function(t){if(t instanceof Array)for(var e=0,n=t.length;n>e;)this.insert(t),e++;else for(var o=0;o<this.cols;o++)for(var i=0;i<this.rows;i++)this.cells[o][i].insert(t)},o.prototype.addOut=function(t){for(var e=0,n=t.length;n>e;)this.out.add(t[e]),e++},o.prototype.retrieve=function(t){var e=t.x%this.cellX+t.width>this.cellX?!0:!1,n=t.y%this.cellY+t.height>this.cellY?!0:!1,o=Math.floor(t.x/this.cellX),i=Math.floor(t.y/this.cellY);return this.out.clear(),this.addOut(this.cells[o][i].items),e&&this.addOut(this.cells[o+1][i].items),n&&this.addOut(this.cells[o][i+1].items),e&&n&&this.addOut(this.cells[o+1][i+1].items),this.out},e.exports=o},{"../../linkedlist/doublylinkedlist":31,"./cell":12}],14:[function(t,e,n){e.exports={Grid:t("./grid"),Cell:t("./cell")}},{"./cell":12,"./grid":13}],15:[function(t,e,n){e.exports={Vector2:t("./vector2"),LineSegment2:t("./linesegment2"),Triangle2:t("./triangle2"),Polygon2:t("./polygon2"),RegularPolygon2:t("./regularpolygon2"),gpc:t("./gpc"),VisibilityPolygon:t("./visibilitypolygon"),Grid:t("./grid"),QuadTree:t("./quadtree")}},{"./gpc":11,"./grid":14,"./linesegment2":16,"./polygon2":17,"./quadtree":19,"./regularpolygon2":23,"./triangle2":24,"./vector2":25,"./visibilitypolygon":26}],16:[function(t,e,n){"use strict";function o(t,e){if(!(this instanceof o)){var n=r.pop();return n?(n.start.free(),n.end.free(),n.set(t,e)):(n=new o(t,e),s++),n}this.start=t||i(),this.end=e||i()}var i=t("./vector2");e.exports=o;var r=[],s=0;o.getStats=function(){return[r.length,s]},o.prototype.set=function(t,e){return this.start=t||i(),this.end=e||i(),this},o.prototype.free=function(){r.push(this)},o.prototype.lengthSq=function(){return this.start.distanceSq(this.end)},o.prototype.length=function(){return this.start.distance(this.end)},o.prototype.closestPoint=function(t,e){var n=this.lengthSq();if(0===n)return this.start.clone();var o=((t.x-this.start.x)*(this.end.x-this.start.x)+(t.y-this.start.y)*(this.end.y-this.start.y))/n;if(!e){if(0>o)return this.start.clone();if(o>1)return this.end.clone()}return i(this.start.x+o*(this.end.x-this.start.x),this.start.y+o*(this.end.y-this.start.y))},o.prototype.distanceSq=function(t,e){var n=this.closestPoint(t,e),o=t.distanceSq(n);return n.free(),o},o.prototype.distance=function(t,e){return Math.sqrt(this.distanceSq(t,e))},o.prototype.intersect=function(t,e){var n=(t.end.y-t.start.y)*(this.end.x-this.start.x)-(t.end.x-t.start.x)*(this.end.y-this.start.y);if(0===n)return null;var o=(t.end.x-t.start.x)*(this.start.y-t.start.y)-(t.end.y-t.start.y)*(this.start.x-t.start.x),r=(this.end.x-this.start.x)*(this.start.y-t.start.y)-(this.end.y-this.start.y)*(this.start.x-t.start.x),s=o/n,a=r/n;return e||s>=0&&1>=s&&a>=0&&1>=a?i(this.start.x-s*(this.start.x-this.end.x),this.start.y-s*(this.start.y-this.end.y)):!1},o.prototype.intersectCircle=function(t,e,n){var o=e*e,i=this.closestPoint(t,n),r=t.clone().subtract(i),s=r.distanceSq();return r.free(),o>s?i:(i.free(),!1)},o.prototype.equals=function(t){return this.start===t.start&&this.end===t.end},o.prototype.inverse=function(){return o(this.end.clone(),this.start.clone())}},{"./vector2":25}],17:[function(t,e,n){"use strict";function o(t){if(!(this instanceof o)){var e=a.pop();return e?(e.freePoints(),e.set(t)):(e=new o(t),l++),e}this.points=t||[]}var i=t("./vector2"),r=t("./linesegment2"),s=1e-7;e.exports=o;var a=[],l=0;o.fromArray=function(t){for(var e=o(),n=0;n<t.length;n++)e.add(i.fromArray(t[n]));return e},o.getStats=function(){return[a.length,l]},o.prototype.free=function(){this.freePoints(),a.push(this)},o.prototype.freePoints=function(){for(var t=this.points.pop();t;)t.free(),t=this.points.pop();return this},o.prototype.set=function(t){return this.points=t||[],this},o.prototype.add=function(t){return this.points.push(t),this},o.prototype.translate=function(t){for(var e=0;e<this.points.length;e++)this.points[e].add(t);return this},o.prototype.rotate=function(t,e){for(var n=0;n<this.points.length;n++)this.points[n].rotate(t,e);return this},o.prototype.containsPoint=function(t){for(var e=!1,n=0,o=this.points.length-1;n<this.points.length;o=n++){var i=this.points[n].x,r=this.points[n].y,s=this.points[o].x,a=this.points[o].y,l=r>t.y!=a>t.y&&t.x<(s-i)*(t.y-r)/(a-r)+i;l&&(e=!e)}return e},o.prototype.intersectsLine=function(t,e){for(var n=r(),o=!1,i=0,a=this.points.length-1;i<this.points.length;a=i++){var l=this.points[i].x,h=this.points[i].y,u=this.points[a].x,p=this.points[a].y;n.start.set(l,h),n.end.set(u,p);var y=n.intersect(t);if(y){if(e&&(this.points[i].isEqualEpsilon(y)||this.points[a].isEqualEpsilon(y)||t.start.isEqualEpsilon(y)||t.end.isEqualEpsilon(y))){var c=this.points[i].clone().subtract(this.points[a]).normalize(),d=c.angle();c.copy(t.start).subtract(t.end).normalize();var f=c.angle();if(c.free(),y.free(),Math.abs(d-f)<s){o=!0;break}continue}y.free(),o=!0;break}}return n.free(),o},o.prototype.intersectsTriangle=function(t,e){var n=r();return n.start.copy(t.v0),n.end.copy(t.v1),this.intersectsLine(n,e)?(n.free(),!0):(n.start.copy(t.v1),n.end.copy(t.v2),this.intersectsLine(n,e)?(n.free(),!0):(n.start.copy(t.v2),n.end.copy(t.v0),this.intersectsLine(n,e)?(n.free(),!0):!1))},o.prototype.AABB=function(){for(var t=this.points[0].clone(),e=this.points[0].clone(),n=1;n<this.points.length;n++){var o=this.points[n];o.x<t.x?t.x=o.x:o.x>e.x&&(e.x=o.x),o.y<t.y?t.y=o.y:o.y>e.y&&(e.y=o.y)}return[t,e]},o.prototype.winding=function(){return this.area()>0},o.prototype.rewind=function(t){t=!!t;var e=this.winding();return e!==t&&this.points.reverse(),this},o.prototype.area=function(){for(var t=0,e=this.points[0],n=i(),o=i(),r=0,s=this.points.length-1;r<this.points.length;s=r++)n.copy(e).subtract(this.points[r]),o.copy(e).subtract(this.points[s]),t+=n.cross(o);return n.free(),o.free(),t/2},o.prototype.clean=function(t){for(var e=i(),n=[],o=0,r=this.points.length-1;o<this.points.length;r=o++){var s=e.copy(this.points[o]).subtract(this.points[r]).length();s>t?n.push(this.points[o]):this.points[o].free()}this.points=n},o.prototype.toArray=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].toArray());return t}},{"./linesegment2":16,"./vector2":25}],18:[function(t,e,n){"use strict";function o(t,e,n,o){i.call(this,t,e,n,o),this._stuckChildren=[]}var i=t("./pointnode");o.prototype=new i,o.prototype._classConstructor=o,o.prototype._stuckChildren=null,o.prototype._out=[],o.prototype.insert=function(t){if(this.nodes.length){var e=this._findIndex(t),n=this.nodes[e];return void(t.x>=n._bounds.x&&t.x+t.width<=n._bounds.x+n._bounds.width&&t.y>=n._bounds.y&&t.y+t.height<=n._bounds.y+n._bounds.height?this.nodes[e].insert(t):this._stuckChildren.push(t))}this.children.push(t);var o=this.children.length;if(this._depth<this._maxDepth&&o>this._maxChildren){this.subdivide();var i;for(i=0;o>i;i++)this.insert(this.children[i]);this.children.length=0}},o.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)},o.prototype.retrieve=function(t){var e=this._out;if(e.length=0,this.nodes.length){var n=this._findIndex(t),o=this.nodes[n];t.x>=o._bounds.x&&t.x+t.width<=o._bounds.x+o._bounds.width&&t.y>=o._bounds.y&&t.y+t.height<=o._bounds.y+o._bounds.height?e.push.apply(e,this.nodes[n].retrieve(t)):(t.x<=this.nodes[i.TOP_RIGHT]._bounds.x&&(t.y<=this.nodes[i.BOTTOM_LEFT]._bounds.y&&e.push.apply(e,this.nodes[i.TOP_LEFT].retrieve(t)),t.y+t.height>this.nodes[i.BOTTOM_LEFT]._bounds.y&&e.push.apply(e,this.nodes[i.BOTTOM_LEFT].retrieve(t))),t.x+t.width>this.nodes[i.TOP_RIGHT]._bounds.x&&(t.y<=this.nodes[i.BOTTOM_RIGHT]._bounds.y&&e.push.apply(e,this.nodes[i.TOP_RIGHT].retrieve(t)),t.y+t.height>this.nodes[i.BOTTOM_RIGHT]._bounds.y&&e.push.apply(e,this.nodes[i.BOTTOM_RIGHT].retrieve(t))))}return e.push.apply(e,this._stuckChildren),e.push.apply(e,this.children),e},o.prototype.getAllContent=function(){var t=this._out;if(this.nodes.length){var e;for(e=0;e<this.nodes.length;e++)this.nodes[e].getAllContent()}return t.push.apply(t,this._stuckChildren),t.push.apply(t,this.children),t},o.prototype.clear=function(){this._stuckChildren.length=0,this.children.length=0;var t=this.nodes.length;if(t){var e;for(e=0;t>e;e++)this.nodes[e].clear();this.nodes.length=0}},e.exports=o},{"./pointnode":20}],19:[function(t,e,n){e.exports={QuadTree:t("./quadtree"),PointNode:t("./pointnode"),BoundsNode:t("./boundsnode")}},{"./boundsnode":18,"./pointnode":20,"./quadtree":21}],20:[function(t,e,n){"use strict";function o(t,e,n,o){this._bounds=t,this.children=[],this.nodes=[],o&&(this._maxChildren=o),n&&(this._maxDepth=n),e&&(this._depth=e)}o.prototype.nodes=null,o.prototype._classConstructor=o,o.prototype.children=null,o.prototype._bounds=null,o.prototype._depth=0,o.prototype._maxChildren=4,o.prototype._maxDepth=4,o.TOP_LEFT=0,o.TOP_RIGHT=1,o.BOTTOM_LEFT=2,o.BOTTOM_RIGHT=3,o.prototype.insert=function(t){if(this.nodes.length){var e=this._findIndex(t);return void this.nodes[e].insert(t)}this.children.push(t);var n=this.children.length;if(this._depth<this._maxDepth&&n>this._maxChildren){this.subdivide();var o;for(o=0;n>o;o++)this.insert(this.children[o]);this.children.length=0}},o.prototype.retrieve=function(t){if(this.nodes.length){var e=this._findIndex(t);return this.nodes[e].retrieve(t)}return this.children},o.prototype._findIndex=function(t){var e=this._bounds,n=t.x>e.x+e.width/2?!1:!0,i=t.y>e.y+e.height/2?!1:!0,r=o.TOP_LEFT;return n?i||(r=o.BOTTOM_LEFT):r=i?o.TOP_RIGHT:o.BOTTOM_RIGHT,r},o.prototype.subdivide=function(){var t=this._depth+1,e=this._bounds.x,n=this._bounds.y,i=this._bounds.width/2|0,r=this._bounds.height/2|0,s=e+i,a=n+r;this.nodes[o.TOP_LEFT]=new this._classConstructor({x:e,y:n,width:i,height:r},t,this._maxDepth,this._maxChildren),this.nodes[o.TOP_RIGHT]=new this._classConstructor({x:s,y:n,width:i,height:r},t,this._maxDepth,this._maxChildren),this.nodes[o.BOTTOM_LEFT]=new this._classConstructor({x:e,y:a,width:i,height:r},t,this._maxDepth,this._maxChildren),this.nodes[o.BOTTOM_RIGHT]=new this._classConstructor({x:s,y:a,width:i,height:r},t,this._maxDepth,this._maxChildren)},o.prototype.clear=function(){this.children.length=0;var t,e=this.nodes.length;for(t=0;e>t;t++)this.nodes[t].clear();this.nodes.length=0},e.exports=o},{}],21:[function(t,e,n){"use strict";function o(t,e,n,o){var s;s=e?new i(t,0,n,o):new r(t,0,n,o),this.root=s}var i=t("./pointnode"),r=t("./boundsnode");o.prototype.root=null,o.prototype.insert=function(t){if(t instanceof Array)for(var e=0,n=t.length;n>e;)this.root.insert(t[e]),e++;else this.root.insert(t)},o.prototype.clear=function(){this.root.clear()},o.prototype.retrieve=function(t){return this.root.retrieve(t)},e.exports=o},{"./boundsnode":18,"./pointnode":20}],22:[function(t,e,n){"use strict";function o(t,e,n,s){if(!(this instanceof o)){var a=i.pop();return a?a.set(t,e,n,s):(a=new o(t||0,e||0,n||0,s||0),r++),a}this.x=t||0,this.y=e||0,this.width=n||0,this.height=s||0}e.exports=o;var i=[],r=0;o.getStats=function(){return[i.length,r]},o.fromArray=function(t){return o(t[0]||0,t[1]||0,t[2]||0,t[3]||0)},o.fromObject=function(t){return o(t.x||0,t.y||0,t.width||0,t.height||0)},o.prototype.set=function(t,e,n,o){return this.x=t||0,this.y=e||0,this.width=n||0,this.height=o||0,this},o.prototype.free=function(){i.push(this)},o.prototype.translate=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.intersects=function(t){return!(this.x+this.width<t.x||this.y+this.height<t.y||this.x>t.x+t.width||this.y>t.y+t.height)},o.prototype.toString=function(){return"x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height},o.prototype.toArray=function(){return[this.x,this.y]},o.prototype.toObject=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},{}],23:[function(t,e,n){"use strict";function o(t,e,n){n=n||i(),(!e||2>e)&&(e=3),(!t||0>=t)&&(t=1);for(var o=r(),s=0;e>s;s++)o.add(i(n.x+t*Math.cos(2*s*Math.PI/e+.25*Math.PI),n.y+t*Math.sin(2*s*Math.PI/e+.25*Math.PI)));return o}var i=t("./vector2"),r=t("./polygon2");e.exports=o},{"./polygon2":17,"./vector2":25}],24:[function(t,e,n){"use strict";function o(t,e,n){if(!(this instanceof o)){var i=r.pop();return i?i.set(t,e,n):(i=new o(t,e,n),s++),i}this.v0=t,this.v1=e,this.v2=n}e.exports=o;var i=1e-7,r=[],s=0;o.getStats=function(){return[r.length,s]},o.prototype.free=function(){
r.push(this)},o.prototype.set=function(t,e,n){return this.v0.free(),this.v1.free(),this.v2.free(),this.v0=t,this.v1=e,this.v2=n,this},o.prototype.translate=function(t){return this.v0.add(t),this.v1.add(t),this.v2.add(t),this},o.prototype.calcCircumcircle=function(){var t,e,n=this.v1.x-this.v0.x,o=this.v1.y-this.v0.y,r=this.v2.x-this.v0.x,s=this.v2.y-this.v0.y,a=n*(this.v0.x+this.v1.x)+o*(this.v0.y+this.v1.y),l=r*(this.v0.x+this.v2.x)+s*(this.v0.y+this.v2.y),h=2*(n*(this.v2.y-this.v1.y)-o*(this.v2.x-this.v1.x));if(Math.abs(h)<i){var u=Math.min(this.v0.x,this.v1.x,this.v2.x),p=Math.min(this.v0.y,this.v1.y,this.v2.y),y=Math.max(this.v0.x,this.v1.x,this.v2.x),c=Math.max(this.v0.y,this.v1.y,this.v2.y);this.center.set((u+y)/2,(p+c)/2),t=this.center.x-u,e=this.center.y-p}else{var d=(s*a-o*l)/h,f=(n*l-r*a)/h;this.center.set(d,f),t=this.center.x-this.v0.x,e=this.center.y-this.v0.y}this.radius_squared=t*t+e*e,this.radius=Math.sqrt(this.radius_squared)},o.prototype.inCircumcircle=function(t){var e=this.center.x-t.x,n=this.center.y-t.y,o=e*e+n*n;return o<=this.radius_squared}},{}],25:[function(t,e,n){"use strict";function o(t,e){if(!(this instanceof o)){var n=l.pop();return n?n.set(t,e):(n=new o(t||0,e||0),h++),n}this.x=t||0,this.y=e||0}function i(t){return t*a}function r(t){return t/a}e.exports=o;var s=1e-7,a=180/Math.PI,l=[],h=0;o.warmup=function(t){for(;t--;)(new o).free()},o.getStats=function(){return[l.length,h]},o.fromArray=function(t){return o(t[0]||0,t[1]||0)},o.fromObject=function(t){return o(t.x||0,t.y||0)},o.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},o.prototype.free=function(){l.push(this)},o.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},o.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},o.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},o.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},o.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},o.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},o.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=0,this.y=0):(this.x/=t,this.y/=t),this},o.prototype.clone=function(){return o(this.x,this.y)},o.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.zero=function(){return this.x=this.y=0,this},o.prototype.dot=function(t){return this.x*t.x+this.y*t.y},o.prototype.cross=function(t){return this.x*t.y-this.y*t.x},o.prototype.projectOnto=function(t){var e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this},o.prototype.setAngle=function(t){var e=this.length();this.x=Math.cos(t)*e,this.y=Math.sin(t)*e},o.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},o.prototype.horizontalAngleDeg=function(){return i(this.horizontalAngle())},o.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},o.prototype.verticalAngleDeg=function(){return i(this.verticalAngle())},o.prototype.angle=o.prototype.horizontalAngle,o.prototype.angleDeg=o.prototype.horizontalAngleDeg,o.prototype.direction=o.prototype.horizontalAngle,o.prototype.rotate=function(t,e){var n=0,o=0;e&&(n=e.x||0,o=e.y||0);var i=n+this.x*Math.cos(t)-this.y*Math.sin(t),r=o+this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=i,this.y=r,this},o.prototype.rotateDeg=function(t){return t=r(t),this.rotate(t)},o.prototype.rotateBy=function(t){var e=this.angle()+t;return this.rotate(e)},o.prototype.rotateByDeg=function(t){return t=r(t),this.rotateBy(t)},o.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},o.prototype.distanceSq=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},o.prototype.length=function(){return Math.sqrt(this.lengthSq())},o.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},o.prototype.magnitude=o.prototype.length,o.prototype.isZero=function(){return 0===this.x&&0===this.y},o.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},o.prototype.isEqualEpsilon=function(t){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s},o.prototype.toString=function(){return"x: "+this.x+", y: "+this.y},o.prototype.toArray=function(){return[this.x,this.y]},o.prototype.toObject=function(){return{x:this.x,y:this.y}}},{}],26:[function(t,e,n){"use strict";function o(t,e){return t[2]-e[2]}function i(t){this.polygon=r(),this.segments=t,this.heap=[],this.map=new Array(this.segments.length),this.points=new Array(2*this.segments.length),this.position=s()}var r=t("./polygon2"),s=t("./vector2"),a=t("./linesegment2"),l=Math.PI,h=2*l,u=-1*l,p=1e-7,y=["start","end"];e.exports=i,i.prototype.angle=function(t,e){var n=e.clone().subtract(t),o=n.angle();return n.free(),o},i.prototype.angle2=function(t,e,n){var o=this.angle(t,e),i=this.angle(e,n),r=o-i;return 0>r&&(r+=h),r>h&&(r-=h),r},i.prototype.compute=function(t){this.position.copy(t),this.reset(),this.sortPoints();var e=this.position.clone();e.x+=1;for(var n=0,o=this.segments.length;o>n;){var i=this.angle(this.segments[n].start,this.position),r=this.angle(this.segments[n].end,this.position);(i>u&&0>=i&&l>=r&&r>=0&&r-i>l||r>u&&0>=r&&l>=i&&i>=0&&i-r>l)&&this.insert(n,e),n+=1}for(n=0,o=2*this.segments.length;o>n;){var s=!1,h=!1,y=n,c=this.segments[this.points[n][0]][this.points[n][1]],d=this.heap[0];do if(-1!==this.map[this.points[n][0]]?(this.points[n][0]===d&&(s=!0,c=this.segments[this.points[n][0]][this.points[n][1]]),this.remove(this.map[this.points[n][0]],c)):(this.insert(this.points[n][0],c),this.heap[0]!==d&&(h=!0)),++n,n===o)break;while(this.points[n][2]<this.points[y][2]+p);var f=a(t.clone(),c.clone());if(s){this.polygon.add(c.clone());var g=this.segments[this.heap[0]].intersect(f,!0);g&&(g.isEqualEpsilon(c)?g.free():this.polygon.add(g))}else h&&(this.polygon.add(this.segments[d].intersect(f,!0)),this.polygon.add(this.segments[this.heap[0]].intersect(f,!0)))}return this.polygon},i.prototype.insert=function(t,e){var n=a(this.position.clone(),e.clone()),o=this.segments[t].intersect(n,!0);if(o===!1)return void n.free();o.free();var i=this.heap.length;for(this.heap.push(t),this.map[t]=i;i>0;){var r=this.parent(i);if(!this.lessThan(this.heap[i],this.heap[r],e))break;this.map[this.heap[r]]=i,this.map[this.heap[i]]=r;var s=this.heap[i];this.heap[i]=this.heap[r],this.heap[r]=s,i=r}},i.prototype.remove=function(t,e){if(this.map[this.heap[t]]=-1,t===this.heap.length-1)return void this.heap.pop();this.heap[t]=this.heap.pop(),this.map[this.heap[t]]=t;var n=t,o=this.parent(n);if(0!==n&&this.lessThan(this.heap[n],this.heap[o],e))for(;n>0&&(o=this.parent(n),this.lessThan(this.heap[n],this.heap[o],e));)this.swap(n,o),n=o;else for(;;){var i=this.child(n),r=i+1;if(i<this.heap.length&&this.lessThan(this.heap[i],this.heap[n],e)&&(r===this.heap.length||this.lessThan(this.heap[i],this.heap[r],e)))this.swap(n,i),n=i;else{if(!(r<this.heap.length&&this.lessThan(this.heap[r],this.heap[n],e)))break;this.swap(n,r),n=r}}},i.prototype.lessThan=function(t,e,n){var o=a(this.position.clone(),n.clone()),i=this.segments[t].intersect(o,!0),r=this.segments[e].intersect(o,!0);if(!i.isEqualEpsilon(r)){var s=i.distanceSq(this.position),h=r.distanceSq(this.position);return i.free(),r.free(),o.free(),h>s}var u=this.segments[t].start;i.isEqualEpsilon(this.segments[t].start)&&(u=this.segments[t].end);var p=this.segments[e].start;r.isEqualEpsiolon(this.segments[e].start)&&(p=this.segments[e].end);var y=this.angle2(u,i,this.position),c=this.angle2(p,r,this.position);return i.free(),r.free(),l>y?c>l?!0:y>c:c>y},i.prototype.parent=function(t){return Math.floor((t-1)/2)},i.prototype.child=function(t){return 2*t+1},i.prototype.swap=function(t,e){this.map[this.heap[e]]=t,this.map[this.heap[t]]=e;var n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n},i.prototype.sortPoints=function(){for(var t=0,e=this.segments.length,n=null,i=s();e>t;){for(var r=0;2>r;++r){n=0===r?this.segments[t][y[r]]:this.segments[t][y[r]],i.copy(this.position).subtract(n);var a=2*t+r;this.points[a]?(this.points[a][0]=t,this.points[a][1]=y[r],this.points[a][2]=i.angle()):this.points[a]=[t,y[r],i.angle()]}t+=1}i.free(),this.points=this.points.sort(o)},i.prototype.reset=function(){this.polygon.freePoints();for(var t=0,e=this.map.length;e>t;)this.map[t]=-1,t+=1;for(;this.heap.length>0;)this.heap.pop()}},{"./linesegment2":16,"./polygon2":17,"./vector2":25}],27:[function(t,e,n){(function(n){var o={};o.geometry=t("./geometry"),o.linkedlist=t("./linkedlist"),o.procedural=t("./procedural"),o.timer=t("./timer"),o.input=t("./input"),o.game=t("./game"),e.exports=o,n.ULTRON=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./game":7,"./geometry":15,"./input":28,"./linkedlist":32,"./procedural":36,"./timer":38}],28:[function(t,e,n){e.exports={Unified:t("./unified")}},{"./unified":30}],29:[function(t,e,n){function o(t,e,n,o){t[i](s+e,"wheel"===r?n:function(t){!t&&(t=window.event);var e={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"===r?(e.deltaY=-1/40*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-1/40*t.wheelDeltaX)):e.deltaY=t.detail,n(e)},o||!1)}var i,r,s="";window.addEventListener?i="addEventListener":(i="attachEvent",s="on"),r="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.exports=function(t,e,n){o(t,r,e,n),"DOMMouseScroll"===r&&o(t,"MozMousePixelScroll",e,n)}},{}],30:[function(t,e,n){"use strict";function o(t,e){this.element=t||document,e=e||{},this.preventDefaults=!!e.preventDefaults,this.stopPropagation=!!e.stopPropagation,this.down=new E,this.up=new E,this.gamepadconnected=new E,this.gamepaddisconnected=new E,this.state={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this._keybindmap={},this._keyStates={},this._bindPressCounts={},this._gamepads={},this._gamepadButtonStates={},this._gamepadRaf=!1,this.initEvents()}function i(t,e,n){h(n.keyCode,x[n.keyCode],e,t,n)}function r(t,e,n){var o=-1-n.button,i="<mouse "+(n.button+1)+">";return h(o,i,e,t,n),!1}function s(t){var e=t._keybindmap["<mouse 3>"];return e?!1:void 0}function a(t,e){var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||0;t.state["mouse-dx"]+=n,t.state["mouse-dy"]+=o}function l(t,e){var n=1;switch(e.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=t.element.clientHeight||window.innerHeight}return t.state["mouse-scrollx"]+=e.deltaX*n,t.state["mouse-scrolly"]+=e.deltaY*n,t.state["mouse-scrollz"]+=e.deltaZ*n||0,!1}function h(t,e,n,o,i){var r=o._keybindmap[e];if(r){o.preventDefaults&&i.preventDefault(),o.stopPropagation&&i.stopPropagation();var s=o._keyStates[t];if(v(s,n))for(var a=0;a<r.length;++a)u(r[a],n,o,i);o._keyStates[t]=n}}function u(t,e,n,o){var i=n._bindPressCounts[t]||0;i+=e?1:-1,0>i&&(i=0),n._bindPressCounts[t]=i;var r=n.state[t];if(v(r,i)){var s=e?n.down:n.up;s.emit(t,t,o)}n.state[t]=!!i}function p(t,e,n){var o=n._keybindmap[e];if(o){var i=1===t,r=!1;if("object"==typeof t)i=t.pressed,t=t.value,r=!0,n.state[e]=t;else{var s=n._buttonStates[e];if(v(s,t)){var a=0;for(a=0;a<o.length;++a)u(o[a],i,n,null)}}}}function y(t){var e=m(t);if(!e)return void(t._gamepadRaf&&(P(t._gamepadRaf),t._gamepadRaf=!1));var n="";for(var o in t._gamepads){for(var i=t._gamepads[o],r=0;r<i.buttons.length;r++)n="<gamepad-"+o+"-"+L[r]+">",p(i.buttons[r],n,t);for(r=0;r<i.axes.length;r++)n="<gamepad-"+o+"-"+C[r]+">",t.state[n]=i.axes[r]}t._gamepadRaf=b(y)}function c(t,e){f(t,e.gamepad)}function d(t,e){g(t,e.gamepad)}function f(t,e){t._gamepads[e.index]=e,t.gamepadconnected.emit(e),t._gamepadRaf||(t._gamepadRaf=b(y))}function g(t,e){delete t._gamepads[e.index],t.gamepaddisconnected.emit(e);for(var n in t._gamepads)if(t._gamepads.hasOwnProperty(n))return;t._gamepadRaf&&(P(t._gamepadRaf),t._gamepadRaf=!1)}function m(t){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],n=!1,o=0;o<e.length;o++)e[o]&&(n=!0,e[o].index in t._gamepads?t._gamepads[e[o].index]=e[o]:f(t,e[o]));return n}function v(t,e){return t?!e:e}var x=t("vkey"),_=t("request-frame"),b=_("request"),P=_("cancel"),E=t("eventemitter3"),B=t("./mousewheel-polyfill");e.exports=o;var L=["a","b","x","y","left-shoulder","right-shoulder","left-trigger","right-trigger","select","start","left-stick","right-stick","dpad-up","dpad-down","dpad-left","dpad-right"],C=["left-stick-x","left-stick-y","right-stick-x","right-stick-y"],I="GamepadEvent"in window;o.prototype.initEvents=function(){window.addEventListener("keydown",i.bind(void 0,this,!0),!1),window.addEventListener("keyup",i.bind(void 0,this,!1),!1),this.element.addEventListener("mousedown",r.bind(void 0,this,!0),!1),this.element.addEventListener("mouseup",r.bind(void 0,this,!1),!1),this.element.oncontextmenu=s.bind(void 0,this),this.element.addEventListener("mousemove",a.bind(void 0,this),!1),B(this.element,l.bind(void 0,this),!1),I?(window.addEventListener("gamepadconnected",c.bind(void 0,this),!1),window.addEventListener("gamepaddisconnected",d.bind(void 0,this),!1)):window.setInterval(m.bind(void 0,this),500)},o.prototype.bind=function(t){for(var e=1;e<arguments.length;++e){var n=arguments[e],o=this._keybindmap[n]||[];-1===o.indexOf(t)&&o.push(t),this._keybindmap[n]=o}this.state[t]=!!this.state[t]},o.prototype.unbind=function(t){for(var e in this._keybindmap){var n=this._keybindmap[e],o=n.indexOf(t);o>-1&&n.splice(o,1)}},o.prototype.tick=function(){this.state["mouse-dx"]=this.state["mouse-dy"]=0,this.state["mouse-scrollx"]=this.state["mouse-scrolly"]=this.state["mouse-scrollz"]=0},o.prototype.getBoundKeys=function(){var t=[];for(var e in this._keybindmap)t.push(e);return t}},{"./mousewheel-polyfill":29,eventemitter3:2,"request-frame":3,vkey:4}],31:[function(t,e,n){"use strict";function o(){this._head=null,this._tail=null,this._length=0,this._nodeCache=[]}o.prototype={constructor:o,add:function(t){var e=this._allocate(t);0===this._length?(this._head=e,this._tail=e):(this._tail.next=e,e.prev=this._tail,this._tail=e),this._length++},set:function(t,e){if(t>-1&&t<this._length){var n,o;if(t>this._length/2)for(n=this._tail,o=this._length-1;o-- >t;)n=n.prev;else for(n=this._head,o=0;o++<t;)n=n.next;n.data=e}},item:function(t){if(t>-1&&t<this._length){var e,n;if(t>this._length/2)for(e=this._tail,n=this._length-1;n-- >t;)e=e.prev;else for(e=this._head,n=0;n++<t;)e=e.next;return e.data}return null},pop:function(){return this.remove(this._length-1)},remove:function(t){if(t>-1&&t<this._length){var e=this._head,n=0;if(0===t)this._head=e.next,this._head?this._head.prev=null:this._tail=null;else if(t===this._length-1)e=this._tail,this._tail=e.prev,this._tail.next=null;else{for(;n++<t;)e=e.next;e.prev.next=e.next}return this._length--,this._free(e),e.data}return null},clear:function(){for(;this._length>0;)this.remove(0)},size:function(){return this._length},toArray:function(){for(var t=[],e=this._head;e;)t.push(e.data),e=e.next;return t},toString:function(){return this.toArray().toString()},_free:function(t){this._nodeCache.push(t)},_allocate:function(t){var e=this._nodeCache.pop();return e||(e={}),e.data=t,e.prev=null,e.next=null,e}},e.exports=o},{}],32:[function(t,e,n){e.exports={DoublyLinkedList:t("./doublylinkedlist")}},{"./doublylinkedlist":31}],33:[function(t,e,n){"use strict";function o(t,e,n,o,l,c){var d,f;this.centers=[],e=e||1,l=l||6,4>l&&(l=4);var g={min:4,max:l},m={min:n,max:o},v=t.integer(g),x=i(t.floating(m),v),_=p(x.toArray());x.free();var b,P,E;this.centers.push(s());for(var B=1;e>B;B++)v=t.integer(g),x=i(t.floating(m),v),c||x.rotate(t.floating({min:0,max:2*Math.PI/v})),E=t.integer({min:0,max:_.getNumPoints()-1}),b=s(_.getX(E),_.getY(E)),this.centers.push(b),x.translate(b),P=p(x.toArray()),_=_.union(P),x.free();var L=y(_);x=r.fromArray(L),this.polygon=x;var C=Math.ceil(e/2);this.doors=[];var I,O={};for(B=0;C>B;B++){for(I=t.integer({min:0,max:this.polygon.points.length-1});O[I];)I=t.integer({min:0,max:this.polygon.points.length-1});O[I]=!0,d=I+1,d===this.polygon.points.length&&(d=0),f=a(this.polygon.points[I].clone(),this.polygon.points[d].clone());var S=f.end.clone(),T=f.start.clone(),w=f.length();S.subtract(f.start).normalize().multiplyScalar(w/2),T.add(S),this.doors.push(T),S.free(),f.free()}var A=[];for(B=0;B<this.centers.length;B++)A.push(this.centers[B].toArray());for(this.graph=new u,this.delaunay_used={},this.delaunay=h.triangulate(A),B=0;B<this.delaunay.length;B+=1)this.delaunay_used[this.delaunay[B]]||(this.graph.addNode(this.delaunay[B]),this.delaunay_used[this.delaunay[B]]=!0);for(this.delaunay_exists={},this.delaunay_triangles=[],this.delaunay_lines=[],B=0;B<this.delaunay.length;B+=3)this.addDelaunayLine(B,B+1),this.addDelaunayLine(B+1,B+2),this.addDelaunayLine(B+2,B);for(I=this.centers.length,B=0;B<this.doors.length;B++)this.connectDoor(this.doors[B],I);var N=this.graph.prim();for(this.mst_lines=[],B=0;B<N.length;B++){var D=N[B].source;d=N[B].sink,f=a(this.centers[D].clone(),this.centers[d].clone()),this.mst_lines.push(f)}this.outside=this.polygon.AABB(),this.outside[0].subtractScalar(50),this.outside[1].addScalar(50)}var i=t("../../geometry/regularpolygon2"),r=t("../../geometry/polygon2"),s=t("../../geometry/vector2"),a=t("../../geometry/linesegment2"),l=t("../../geometry/gpc"),h=t("delaunay-fast"),u=t("../graph");e.exports=o;var p=function(t){for(var e=new l.geometry.PolyDefault,n=0;n<t.length;n++)e.addPoint(new l.geometry.Point(t[n][0],t[n][1]));return e},y=function(t){var e,n=[],o=t.getNumPoints();for(e=0;o>e;e++)n.push([t.getX(e),t.getY(e)]);return n};o.prototype.connectDoor=function(t,e){for(var n,o,i=9999999,r=!1,s=0;e>s;s++)n=a(this.centers[s].clone(),t.clone()),this.polygon.intersectsLine(n,!0)||(o=n.length(),i>o&&(i=o,r=s)),n.free();r!==!1?(this.centers.push(t.clone()),this.graph.addNode(this.centers.length-1),this.graph.addEdge(r,this.centers.length-1,i),this.delaunay_lines.push(a(this.centers[r].clone(),t.clone()))):n.free()},o.prototype.addDelaunayLine=function(t,e){var n=t+":"+e,o=e+":"+t;if(!this.delaunay_exists[n]&&!this.delaunay_exists[o]){this.delaunay_exists[n]=!0,this.delaunay_exists[o]=!0;var i=a(this.centers[this.delaunay[t]].clone(),this.centers[this.delaunay[e]].clone());this.polygon.intersectsLine(i)?i.free():(this.graph.addEdge(this.delaunay[t],this.delaunay[e],i.length()),this.delaunay_lines.push(i))}},o.prototype.translate=function(t){this.polygon.translate(t);for(var e=0;e<this.centers.length;e++)this.centers[e].add(t);for(e=0;e<this.delaunay_triangles.length;e++)this.delaunay_triangles[e].translate(t);return this}},{"../../geometry/gpc":11,"../../geometry/linesegment2":16,"../../geometry/polygon2":17,"../../geometry/regularpolygon2":23,"../../geometry/vector2":25,"../graph":35,"delaunay-fast":1}],34:[function(t,e,n){"use strict";function o(t,e,n,o,i){this.sizeChance={min:o,max:i},this.posChance={min:0,max:1},this.rooms=[],this.vectors=[],this.chance=t,this.iterations=e,this.radius=n,this.minSide=o,this.maxSide=i,this.state=a}var i=t("../../geometry/rectangle2"),r=t("../../geometry/vector2"),s=(t("../../geometry/linesegment2"),t("../../geometry/gpc"),t("delaunay-fast"),t("../graph"),t("../../ai/steering").avoidance);e.exports=o;var a=1,l=2,h=3;o.prototype.step=function(){switch(this.state){case a:this.addRoom();break;case l:this.evadeRooms()}},o.prototype.addRoom=function(){var t=2*Math.PI*this.chance.floating(this.posChance),e=this.chance.floating(this.posChance)+this.chance.floating(this.posChance),n=e>1?2-e:e,o=this.radius*n*Math.cos(t),s=this.radius*n*Math.sin(t),a=this.chance.integer(this.sizeChance),h=this.chance.integer(this.sizeChance),u=i(o-a/2,s-h/2,a,h);this.rooms.push(u),this.vectors.push(r()),this.rooms.length===this.iterations&&(this.state=l)},o.prototype.evadeRooms=function(){var t,e,n,o,i,a,l=this.rooms.length,u=r(),p=r(),y=!1,c=!1;for(t=0;l>t;t++){for(y=!1,e=this.rooms[t],n=this.vectors[t],o=0;l>o;o++)o!==t&&(i=this.rooms[o],e.intersects(i)&&(u.set(e.x,e.y),p.set(i.x,i.y),a=s(p,u,n,10,10,5),n.copy(a),a.free(),y=!0));y&&(e.x+=n.x,e.y+=n.y,c=!0)}if(u.free(),p.free(),!c){for(n=this.vectors.pop();n;)n.free(),n=this.vectors.pop();this.state=h}}},{"../../ai/steering":5,"../../geometry/gpc":11,"../../geometry/linesegment2":16,"../../geometry/rectangle2":22,"../../geometry/vector2":25,"../graph":35,"delaunay-fast":1}],35:[function(t,e,n){"use strict";var o=function(t,e,n){this.source=t,this.sink=e,this.capacity=n},i=function(){this.edges={},this.nodes=[],this.nodeMap={},this.addNode=function(t){this.nodes.push(t),this.nodeMap[t]=this.nodes.length-1,this.edges[t]=[]},this.addEdge=function(t,e,n){this.edges[t].push(new o(t,e,n)),this.edges[e].push(new o(e,t,n))},this.edgeExists=function(t,e){if(void 0!==this.edges[t])for(var n=0;n<this.edges[t].length;n++)if(this.edges[t][n].sink===e)return this.edges[t][n];return null},this.prim=function(){function t(t){for(var n=[999999,null],i=0;i<e.length;i++)for(var r=0;r<t.edges[e[i]].length;r++)t.edges[e[i]][r].capacity<n[0]&&void 0===o[t.edges[e[i]][r].sink]&&(n=[t.edges[e[i]][r].capacity,t.edges[e[i]][r]]);return n}var e=[],n=[],o={},i=this.nodes[Math.round(Math.random()*(this.nodes.length-1))];e.push(i),o[i]=!0;for(var r=t(this);null!==r[1];)n.push(r[1]),e.push(r[1].sink),o[r[1].sink]=!0,r=t(this);return n}};e.exports=i},{}],36:[function(t,e,n){e.exports={Graph:t("./graph"),Building:t("./building"),Dungeon:t("./dungeon")}},{"./building":33,"./dungeon":34,"./graph":35}],37:[function(t,e,n){"use strict";function o(){this.simulationTimestep=1e3/60,this.frameDelta=0,this.lastFrameTimeMs=0,this.fps=60,this.lastFpsUpdate=0,this.framesThisSecond=0,this.numUpdateSteps=0,this.minFrameDelay=0,this.running=!1,this.started=!1,this.panic=!1,this.rafHandle=!1,this.boundAnimate=this.animate.bind(this)}var i=t("request-frame"),r=i("request"),s=i("cancel"),a=function(){};e.exports=o,o.prototype.begin=a,o.prototype.update=a,o.prototype.render=a,o.prototype.end=a,o.prototype.getSimulationTimestep=function(){return this.simulationTimestep},o.prototype.setSimulationTimestep=function(t){return this.simulationTimestep=t,this},o.prototype.getFPS=function(){return this.fps},o.prototype.getMaxAllowedFPS=function(){return 1e3/this.minFrameDelay},o.prototype.setMaxAllowedFPS=function(t){return"undefined"==typeof t&&(t=1/0),0===t?this.stop():this.minFrameDelay=1e3/t,this},o.prototype.resetFrameDelta=function(){var t=this.frameDelta;return this.frameDelta=0,t},o.prototype.setBegin=function(t){return this.begin=t||this.begin,this},o.prototype.setUpdate=function(t){return this.update=t||this.update,this},o.prototype.setRender=function(t){return this.render=t||this.render,this},o.prototype.setEnd=function(t){return this.end=t||this.end,this},o.prototype.start=function(){if(!this.started){this.started=!0;var t=this;this.rafHandle=r(function(e){t.render(1),t.running=!0,t.lastFrameTimeMs=e,t.lastFpsUpdate=e,t.framesThisSecond=0,t.rafHandle=r(t.boundAnimate)})}return this},o.prototype.stop=function(){return this.running=!1,this.started=!1,s(this.rafHandle),this},o.prototype.isRunning=function(){return this.running},o.prototype.animate=function(t){if(t<this.lastFrameTimeMs+this.minFrameDelay)return void(this.rafHandle=r(this.boundAnimate));for(this.frameDelta+=t-this.lastFrameTimeMs,this.lastFrameTimeMs=t,this.begin(t,this.frameDelta),t>this.lastFpsUpdate+1e3&&(this.fps=.25*this.framesThisSecond+.75*this.fps,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond++,this.numUpdateSteps=0;this.frameDelta>=this.simulationTimestep;)if(this.update(this.simulationTimestep),this.frameDelta-=this.simulationTimestep,++this.numUpdateSteps>=240){this.panic=!0;break}this.render(this.frameDelta/this.simulationTimestep),this.end(this.fps,this.panic),this.panic=!1,this.rafHandle=r(this.boundAnimate)}},{"request-frame":3}],38:[function(t,e,n){e.exports={GameLoop:t("./gameloop")}},{"./gameloop":37}]},{},[27])(27)});