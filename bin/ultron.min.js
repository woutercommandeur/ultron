!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ULTRON=t()}}(function(){var t;return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){var i;!function(){"use strict";function t(t){var e,n,i,o,r,s,a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<l&&(l=t[e][1]),t[e][1]>u&&(u=t[e][1]);return n=h-a,i=u-l,o=Math.max(n,i),r=a+.5*n,s=l+.5*i,[[r-20*o,s-o],[r,s+20*o],[r+20*o,s-o]]}function n(t,e,n,i){var o,s,a,l,h,u,p,y,d,f,c=t[e][0],g=t[e][1],m=t[n][0],v=t[n][1],x=t[i][0],_=t[i][1],b=Math.abs(g-v),P=Math.abs(v-_);if(r>b&&r>P)throw new Error("Eek! Coincident points!");return r>b?(l=-((x-m)/(_-v)),u=(m+x)/2,y=(v+_)/2,o=(m+c)/2,s=l*(o-u)+y):r>P?(a=-((m-c)/(v-g)),h=(c+m)/2,p=(g+v)/2,o=(x+m)/2,s=a*(o-h)+p):(a=-((m-c)/(v-g)),l=-((x-m)/(_-v)),h=(c+m)/2,u=(m+x)/2,p=(g+v)/2,y=(v+_)/2,o=(a*h-l*u+y-p)/(a-l),s=b>P?a*(o-h)+p:l*(o-u)+y),d=m-o,f=v-s,{i:e,j:n,k:i,x:o,y:s,r:d*d+f*f}}function o(t){var e,n,i,o,r,s;for(n=t.length;n;)for(o=t[--n],i=t[--n],e=n;e;)if(s=t[--e],r=t[--e],i===r&&o===s||i===s&&o===r){t.splice(n,2),t.splice(e,2);break}}var r=1/1048576;i={triangulate:function(e,i){var s,a,l,h,u,p,y,d,f,c,g,m,v=e.length;if(3>v)return[];if(e=e.slice(0),i)for(s=v;s--;)e[s]=e[s][i];for(l=new Array(v),s=v;s--;)l[s]=s;for(l.sort(function(t,n){return e[n][0]-e[t][0]}),h=t(e),e.push(h[0],h[1],h[2]),u=[n(e,v+0,v+1,v+2)],p=[],y=[],s=l.length;s--;y.length=0){for(m=l[s],a=u.length;a--;)d=e[m][0]-u[a].x,d>0&&d*d>u[a].r?(p.push(u[a]),u.splice(a,1)):(f=e[m][1]-u[a].y,d*d+f*f-u[a].r>r||(y.push(u[a].i,u[a].j,u[a].j,u[a].k,u[a].k,u[a].i),u.splice(a,1)));for(o(y),a=y.length;a;)g=y[--a],c=y[--a],u.push(n(e,c,g,m))}for(s=u.length;s--;)p.push(u[s]);for(u.length=0,s=p.length;s--;)p[s].i<v&&p[s].j<v&&p[s].k<v&&u.push(p[s].i,p[s].j,p[s].k);return u},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var n=t[1][0]-t[0][0],i=t[2][0]-t[0][0],o=t[1][1]-t[0][1],r=t[2][1]-t[0][1],s=n*r-i*o;if(0===s)return null;var a=(r*(e[0]-t[0][0])-i*(e[1]-t[0][1]))/s,l=(n*(e[1]-t[0][1])-o*(e[0]-t[0][0]))/s;return 0>a||0>l||a+l>1?null:[a,l]}},"undefined"!=typeof e&&(e.exports=i)}()},{}],2:[function(t,e,n){"use strict";function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){}var r="function"!=typeof Object.create?"~":!1;o.prototype._events=void 0,o.prototype.listeners=function(t,e){var n=r?r+t:t,i=this._events&&this._events[n];if(e)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var o=0,s=i.length,a=new Array(s);s>o;o++)a[o]=i[o].fn;return a},o.prototype.emit=function(t,e,n,i,o,s){var a=r?r+t:t;if(!this._events||!this._events[a])return!1;var l,h,u=this._events[a],p=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,o),!0;case 6:return u.fn.call(u.context,e,n,i,o,s),!0}for(h=1,l=new Array(p-1);p>h;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var y,d=u.length;for(h=0;d>h;h++)switch(u[h].once&&this.removeListener(t,u[h].fn,void 0,!0),p){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,e);break;case 3:u[h].fn.call(u[h].context,e,n);break;default:if(!l)for(y=1,l=new Array(p-1);p>y;y++)l[y-1]=arguments[y];u[h].fn.apply(u[h].context,l)}}return!0},o.prototype.on=function(t,e,n){var o=new i(e,n||this),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.once=function(t,e,n){var o=new i(e,n||this,!0),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],o]:this._events[s].push(o):this._events[s]=o,this},o.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events||!this._events[o])return this;var s=this._events[o],a=[];if(e)if(s.fn)(s.fn!==e||i&&!s.once||n&&s.context!==n)&&a.push(s);else for(var l=0,h=s.length;h>l;l++)(s[l].fn!==e||i&&!s[l].once||n&&s[l].context!==n)&&a.push(s[l]);return a.length?this._events[o]=1===a.length?a[0]:a:delete this._events[o],this},o.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[r?r+t:t]:this._events=r?{}:Object.create(null),this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=r,"undefined"!=typeof e&&(e.exports=o)},{}],3:[function(e,n,i){!function(e){function o(t){function n(){function t(t,e,n){return t||e?(console.warn(n),!0):!1}function n(){return h?t(i,o,l):!1}var i=e.webkitRequestAnimationFrame,o=e.requestAnimationFrame,r=screen.width<=768?!0:!1,s=!(i&&o),a=e.performance?!1:!0,l="setTimeout is being used as a substitiue forrequestAnimationFrame due to a bug within iOS 6 builds",h=s&&r&&a;return n()}function i(t){clearTimeout(t)}function o(t){var e=Date.now(),n=Math.max(g+16,e);return setTimeout(function(){t(g=n)},n-e)}function r(){return Array.prototype.filter?(u=e["request"+f]||e[d.filter(function(t){return void 0!==e[t+c]?t:void 0})+c]||o,n()?o:u):o}function s(){function t(t,n){for(var i;n<t.length;n++)if(e[t[n]]){i=e[t[n]];break}return i}var o=[];return Array.prototype.map?(d.map(function(t){return["Cancel","CancelRequest"].map(function(e){o.push(t+e+f)})}),p=e["cancel"+f]||t(o,0)||i,n()?i:p):i}function a(){return x?o:r()}function l(){return s()}function h(){x?(e.requestAnimationFrame=o,e.cancelAnimationFrame=i):(e.requestAnimationFrame=r(),e.cancelAnimationFrame=s())}var u,p,y,d=["moz","webkit"],f="AnimationFrame",c="Request"+f,g=0,m=e.mozRequestAnimationFrame,v=e.mozCancelAnimationFrame,x=m&&!v;switch(Date.now||(Date.now=function(){return(new Date).getTime()}),t){case"request":case"":y=a();break;case"cancel":y=l();break;case"native":h();break;default:throw new Error("RequestFrame parameter is not a type.")}return y}"object"==typeof n&&"object"==typeof n.exports?n.exports=i=o:"function"==typeof t&&t.amd?t(function(){return o}):"object"==typeof e&&(e.requestFrame=o)}(window)},{}],4:[function(t,e,n){var i,o="undefined"!=typeof window?window.navigator.userAgent:"",r=/OS X/.test(o),s=/Opera/.test(o),a=!/like Gecko/.test(o)&&!s,l=e.exports={0:r?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",27:"<escape>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:r?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num-->",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:r&&a?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:s?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(i=58;65>i;++i)l[i]=String.fromCharCode(i);for(i=48;58>i;++i)l[i]=i-48+"";for(i=65;91>i;++i)l[i]=String.fromCharCode(i);for(i=96;106>i;++i)l[i]="<num-"+(i-96)+">";for(i=112;136>i;++i)l[i]="F"+(i-111)},{}],5:[function(t,e,n){"use strict";function i(t,e){var n;for(n in t)if("undefined"==typeof e[n])return!1;for(n in t)if(t[n])switch(typeof t[n]){case"object":if(!i(t[n],e[n]))return!1;break;case"function":if("undefined"==typeof e[n]||"equals"!==n&&t[n].toString()!==e[n].toString())return!1;break;default:if(t[n]!==e[n])return!1}else if(e[n])return!1;for(n in e)if("undefined"==typeof t[n])return!1;return!0}var o=o||{};o.util={},o.geometry={},n=e.exports=o;var r,s,a,l,u,p,d,f,c,g,m=function(t,e){this.x=t,this.y=e};o.geometry.Point=m,o.util.ArrayHelper=function(){};var v=o.util.ArrayHelper;v.create2DArray=function(t,e){for(var n=[],i=0;t>i;i++)n[i]=[];return n},v.valueEqual=function(t,e){return t===e?!0:i(t,e)?!0:!1},v.sortPointsClockwise=function(t){var e=!1;t instanceof o.util.ArrayList&&(t=t.toArray(),e=!0);for(var n,r=null,s=null,a=null,l=null,h=t,u=0;u<t.length;u++){var p=t[u];(null===r||r.y>p.y||r.y===p.y&&p.x<r.x)&&(r=p),(null===s||s.y<p.y||s.y===p.y&&p.x>s.x)&&(s=p),(null===a||a.x>p.x||a.x===p.x&&p.y>a.y)&&(a=p,n=u),(null===l||l.x<p.x||l.x===p.x&&p.y<l.y)&&(l=p)}if(n>0){h=[];for(var y=0,u=n;u<t.length;u++)h[y++]=t[u];for(var u=0;n>u;u++)h[y++]=t[u];t=h}for(var d=!1,u=0;u<t.length;u++){var p=t[u];if(i(p,s)){d=!0;break}if(i(p,r))break}if(d){h=[],h[0]=t[0];for(var y=1,u=t.length-1;u>0;u--)h[y++]=t[u];t=h}return e?new o.util.ArrayList(t):t};var _=o.util.ArrayHelper;o.util.ArrayList=function(t){this._array=[],null!=t&&(this._array=t)};var b=o.util.ArrayList.prototype;b.add=function(t){this._array.push(t)},b.get=function(t){return this._array[t]},b.size=function(){return this._array.length},b.clear=function(){this._array=[]},b.equals=function(t){if(this._array.length!=t.size())return!1;for(var e=0;e<this._array.length;e++){var n=this._array[e],i=t.get(e);if(!_.valueEqual(n,i))return!1}return!0},b.hashCode=function(){return 0},b.isEmpty=function(){return 0==this._array.length},b.toArray=function(){return this._array},o.geometry.Clip=function(){},o.geometry.Clip.DEBUG=!1,o.geometry.Clip.GPC_EPSILON=2.220446049250313e-16,o.geometry.Clip.GPC_VERSION="2.31",o.geometry.Clip.LEFT=0,o.geometry.Clip.RIGHT=1,o.geometry.Clip.ABOVE=0,o.geometry.Clip.BELOW=1,o.geometry.Clip.CLIP=0,o.geometry.Clip.SUBJ=1,r=o.geometry.Clip;var b=o.geometry.Clip.prototype,v=o.geometry.Clip;v.intersection=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),o.geometry.Clip.clip(o.geometry.OperationType.GPC_INT,t,e,n)},v.union=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),o.geometry.Clip.clip(o.geometry.OperationType.GPC_UNION,t,e,n)},v.xor=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),o.geometry.Clip.clip(o.geometry.OperationType.GPC_XOR,t,e,n)},v.difference=function(t,e,n){return(null==n||void 0==n)&&(n="PolyDefault"),o.geometry.Clip.clip(o.geometry.OperationType.GPC_DIFF,e,t,n)},v.intersection=function(t,e){return o.geometry.Clip.clip(o.geometry.OperationType.GPC_INT,t,e,"PolyDefault.class")},v.createNewPoly=function(t){return"PolySimple"==t?new o.geometry.PolySimple:"PolyDefault"==t?new o.geometry.PolyDefault:"PolyDefault.class"==t?new o.geometry.PolyDefault:null},v.clip=function(t,e,n,i){var a=o.geometry.Clip.createNewPoly(i);if(e.isEmpty()&&n.isEmpty()||e.isEmpty()&&(t==o.geometry.OperationType.GPC_INT||t==o.geometry.OperationType.GPC_DIFF)||n.isEmpty()&&t==o.geometry.OperationType.GPC_INT)return a;t!=o.geometry.OperationType.GPC_INT&&t!=o.geometry.OperationType.GPC_DIFF||e.isEmpty()||n.isEmpty()||o.geometry.Clip.minimax_test(e,n,t);var h=new o.geometry.LmtTable,y=new o.geometry.ScanBeamTreeEntries,f=null,g=null;if(e.isEmpty()||(f=o.geometry.Clip.build_lmt(h,y,e,o.geometry.Clip.SUBJ,t)),o.geometry.Clip.DEBUG&&h.print(),n.isEmpty()||(g=o.geometry.Clip.build_lmt(h,y,n,o.geometry.Clip.CLIP,t)),o.geometry.Clip.DEBUG&&h.print(),null==h.top_node)return a;var m=y.build_sbt(),v=[];v[0]=o.geometry.Clip.LEFT,v[1]=o.geometry.Clip.LEFT,t==o.geometry.OperationType.GPC_DIFF&&(v[r.CLIP]=o.geometry.Clip.RIGHT),o.geometry.Clip.DEBUG;for(var x=h.top_node,_=new l,b=new u,P=0;P<m.length;){var E=m[P++],B=0,L=0;if(P<m.length&&(B=m[P],L=B-E),null!=x&&x.y==E){for(var I=x.first_bound;null!=I;I=I.next_bound)o.geometry.Clip.add_edge_to_aet(b,I);x=x.next}o.geometry.Clip.DEBUG&&b.print();var C=-Number.MAX_VALUE,O=b.top_node,T=b.top_node;b.top_node.bundle[r.ABOVE][b.top_node.type]=b.top_node.top.y!=E?1:0,b.top_node.bundle[r.ABOVE][0==b.top_node.type?1:0]=0,b.top_node.bstate[r.ABOVE]=s.UNBUNDLED;for(var S=b.top_node.next;null!=S;S=S.next){var A=S.type,w=0==S.type?1:0;S.bundle[r.ABOVE][A]=S.top.y!=E?1:0,S.bundle[r.ABOVE][w]=0,S.bstate[r.ABOVE]=s.UNBUNDLED,1==S.bundle[r.ABOVE][A]&&(r.EQ(O.xb,S.xb)&&o.geometry.Clip.EQ(O.dx,S.dx)&&O.top.y!=E&&(S.bundle[r.ABOVE][A]^=O.bundle[r.ABOVE][A],S.bundle[r.ABOVE][w]=O.bundle[r.ABOVE][w],S.bstate[r.ABOVE]=s.BUNDLE_HEAD,O.bundle[r.ABOVE][r.CLIP]=0,O.bundle[r.ABOVE][r.SUBJ]=0,O.bstate[r.ABOVE]=s.BUNDLE_TAIL),O=S)}var N=[];N[r.CLIP]=p.NH,N[r.SUBJ]=p.NH;var D=[];D[r.CLIP]=0,D[r.SUBJ]=0;for(var V=null,I=b.top_node;null!=I;I=I.next){if(D[r.CLIP]=I.bundle[r.ABOVE][r.CLIP]+(I.bundle[r.BELOW][r.CLIP]<<1),D[r.SUBJ]=I.bundle[r.ABOVE][r.SUBJ]+(I.bundle[r.BELOW][r.SUBJ]<<1),0!=D[r.CLIP]||0!=D[r.SUBJ]){I.bside[r.CLIP]=v[r.CLIP],I.bside[r.SUBJ]=v[r.SUBJ];var U=!1,M=0,k=0,H=0,X=0;if(t==o.geometry.OperationType.GPC_DIFF||t==o.geometry.OperationType.GPC_INT?(U=0!=D[r.CLIP]&&(0!=v[r.SUBJ]||0!=N[r.SUBJ])||0!=D[r.SUBJ]&&(0!=v[r.CLIP]||0!=N[r.CLIP])||0!=D[r.CLIP]&&0!=D[r.SUBJ]&&v[r.CLIP]==v[r.SUBJ],M=0!=v[r.CLIP]&&0!=v[r.SUBJ]?1:0,k=0!=(v[r.CLIP]^I.bundle[r.ABOVE][r.CLIP])&&0!=(v[r.SUBJ]^I.bundle[r.ABOVE][r.SUBJ])?1:0,H=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0))&&0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0))?1:0,X=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^I.bundle[r.BELOW][r.CLIP])&&0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^I.bundle[r.BELOW][r.SUBJ])?1:0):t==o.geometry.OperationType.GPC_XOR?(U=0!=D[r.CLIP]||0!=D[r.SUBJ],M=v[r.CLIP]^v[r.SUBJ],k=v[r.CLIP]^I.bundle[r.ABOVE][r.CLIP]^(v[r.SUBJ]^I.bundle[r.ABOVE][r.SUBJ]),H=v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)),X=v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^I.bundle[r.BELOW][r.CLIP]^(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^I.bundle[r.BELOW][r.SUBJ])):t==o.geometry.OperationType.GPC_UNION&&(U=!((0==D[r.CLIP]||0!=v[r.SUBJ]&&0==N[r.SUBJ])&&(0==D[r.SUBJ]||0!=v[r.CLIP]&&0==N[r.CLIP])&&(0==D[r.CLIP]||0==D[r.SUBJ]||v[r.CLIP]!=v[r.SUBJ])),M=0!=v[r.CLIP]||0!=v[r.SUBJ]?1:0,k=0!=(v[r.CLIP]^I.bundle[r.ABOVE][r.CLIP])||0!=(v[r.SUBJ]^I.bundle[r.ABOVE][r.SUBJ])?1:0,H=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0))||0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0))?1:0,X=0!=(v[r.CLIP]^(N[r.CLIP]!=p.NH?1:0)^I.bundle[r.BELOW][r.CLIP])||0!=(v[r.SUBJ]^(N[r.SUBJ]!=p.NH?1:0)^I.bundle[r.BELOW][r.SUBJ])?1:0),v[r.CLIP]^=I.bundle[r.ABOVE][r.CLIP],v[r.SUBJ]^=I.bundle[r.ABOVE][r.SUBJ],0!=D[r.CLIP]&&(N[r.CLIP]=p.next_h_state[N[r.CLIP]][(D[r.CLIP]-1<<1)+v[r.CLIP]]),0!=D[r.SUBJ]&&(N[r.SUBJ]=p.next_h_state[N[r.SUBJ]][(D[r.SUBJ]-1<<1)+v[r.SUBJ]]),U){var J=I.xb,R=d.getType(H,X,M,k);switch(R){case d.EMN:case d.IMN:I.outp[r.ABOVE]=_.add_local_min(J,E),C=J,V=I.outp[r.ABOVE];break;case d.ERI:J!=C&&(V.add_right(J,E),C=J),I.outp[r.ABOVE]=V,V=null;break;case d.ELI:I.outp[r.BELOW].add_left(J,E),C=J,V=I.outp[r.BELOW];break;case d.EMX:J!=C&&(V.add_left(J,E),C=J),_.merge_right(V,I.outp[r.BELOW]),V=null;break;case d.ILI:J!=C&&(V.add_left(J,E),C=J),I.outp[r.ABOVE]=V,V=null;break;case d.IRI:I.outp[r.BELOW].add_right(J,E),C=J,V=I.outp[r.BELOW],I.outp[r.BELOW]=null;break;case d.IMX:J!=C&&(V.add_right(J,E),C=J),_.merge_left(V,I.outp[r.BELOW]),V=null,I.outp[r.BELOW]=null;break;case d.IMM:J!=C&&(V.add_right(J,E),C=J),_.merge_left(V,I.outp[r.BELOW]),I.outp[r.BELOW]=null,I.outp[r.ABOVE]=_.add_local_min(J,E),V=I.outp[r.ABOVE];break;case d.EMM:J!=C&&(V.add_left(J,E),C=J),_.merge_right(V,I.outp[r.BELOW]),I.outp[r.BELOW]=null,I.outp[r.ABOVE]=_.add_local_min(J,E),V=I.outp[r.ABOVE];break;case d.LED:I.bot.y==E&&I.outp[r.BELOW].add_left(J,E),I.outp[r.ABOVE]=I.outp[r.BELOW],C=J;break;case d.RED:I.bot.y==E&&I.outp[r.BELOW].add_right(J,E),I.outp[r.ABOVE]=I.outp[r.BELOW],C=J}}}o.geometry.Clip.DEBUG&&_.print(),_.print()}for(var I=b.top_node;null!=I;I=I.next)if(I.top.y==E){var F=I.prev,S=I.next;null!=F?F.next=S:b.top_node=S,null!=S&&(S.prev=F),I.bstate[r.BELOW]==s.BUNDLE_HEAD&&null!=F&&F.bstate[r.BELOW]==s.BUNDLE_TAIL&&(F.outp[r.BELOW]=I.outp[r.BELOW],F.bstate[r.BELOW]=s.UNBUNDLED,null!=F.prev&&F.prev.bstate[r.BELOW]==s.BUNDLE_TAIL&&(F.bstate[r.BELOW]=s.BUNDLE_HEAD))}else I.top.y==B?I.xt=I.top.x:I.xt=I.bot.x+I.dx*(B-I.bot.y);if(P<y.sbt_entries){var G=new c;G.build_intersection_table(b,L);for(var q=G.top_node;null!=q;q=q.next){if(O=q.ie[0],T=q.ie[1],!(0==O.bundle[r.ABOVE][r.CLIP]&&0==O.bundle[r.ABOVE][r.SUBJ]||0==T.bundle[r.ABOVE][r.CLIP]&&0==T.bundle[r.ABOVE][r.SUBJ])){var Y=O.outp[r.ABOVE],W=T.outp[r.ABOVE],z=q.point.x,j=q.point.y+E,Q=0!=O.bundle[r.ABOVE][r.CLIP]&&0==O.bside[r.CLIP]||0!=T.bundle[r.ABOVE][r.CLIP]&&0!=T.bside[r.CLIP]||0==O.bundle[r.ABOVE][r.CLIP]&&0==T.bundle[r.ABOVE][r.CLIP]&&0!=O.bside[r.CLIP]&&0!=T.bside[r.CLIP]?1:0,Z=0!=O.bundle[r.ABOVE][r.SUBJ]&&0==O.bside[r.SUBJ]||0!=T.bundle[r.ABOVE][r.SUBJ]&&0!=T.bside[r.SUBJ]||0==O.bundle[r.ABOVE][r.SUBJ]&&0==T.bundle[r.ABOVE][r.SUBJ]&&0!=O.bside[r.SUBJ]&&0!=T.bside[r.SUBJ]?1:0,H=0,X=0,M=0,k=0;t==o.geometry.OperationType.GPC_DIFF||t==o.geometry.OperationType.GPC_INT?(H=0!=Q&&0!=Z?1:0,X=0!=(Q^T.bundle[r.ABOVE][r.CLIP])&&0!=(Z^T.bundle[r.ABOVE][r.SUBJ])?1:0,M=0!=(Q^O.bundle[r.ABOVE][r.CLIP])&&0!=(Z^O.bundle[r.ABOVE][r.SUBJ])?1:0,k=0!=(Q^T.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP])&&0!=(Z^T.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])?1:0):t==o.geometry.OperationType.GPC_XOR?(H=Q^Z,X=Q^T.bundle[r.ABOVE][r.CLIP]^(Z^T.bundle[r.ABOVE][r.SUBJ]),M=Q^O.bundle[r.ABOVE][r.CLIP]^(Z^O.bundle[r.ABOVE][r.SUBJ]),k=Q^T.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP]^(Z^T.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])):t==o.geometry.OperationType.GPC_UNION&&(H=0!=Q||0!=Z?1:0,X=0!=(Q^T.bundle[r.ABOVE][r.CLIP])||0!=(Z^T.bundle[r.ABOVE][r.SUBJ])?1:0,M=0!=(Q^O.bundle[r.ABOVE][r.CLIP])||0!=(Z^O.bundle[r.ABOVE][r.SUBJ])?1:0,k=0!=(Q^T.bundle[r.ABOVE][r.CLIP]^O.bundle[r.ABOVE][r.CLIP])||0!=(Z^T.bundle[r.ABOVE][r.SUBJ]^O.bundle[r.ABOVE][r.SUBJ])?1:0);var R=d.getType(H,X,M,k);switch(R){case d.EMN:O.outp[r.ABOVE]=_.add_local_min(z,j),T.outp[r.ABOVE]=O.outp[r.ABOVE];break;case d.ERI:null!=Y&&(Y.add_right(z,j),T.outp[r.ABOVE]=Y,O.outp[r.ABOVE]=null);break;case d.ELI:null!=W&&(W.add_left(z,j),O.outp[r.ABOVE]=W,T.outp[r.ABOVE]=null);break;case d.EMX:null!=Y&&null!=W&&(Y.add_left(z,j),_.merge_right(Y,W),O.outp[r.ABOVE]=null,T.outp[r.ABOVE]=null);break;case d.IMN:O.outp[r.ABOVE]=_.add_local_min(z,j),T.outp[r.ABOVE]=O.outp[r.ABOVE];break;case d.ILI:null!=Y&&(Y.add_left(z,j),T.outp[r.ABOVE]=Y,O.outp[r.ABOVE]=null);break;case d.IRI:null!=W&&(W.add_right(z,j),O.outp[r.ABOVE]=W,T.outp[r.ABOVE]=null);break;case d.IMX:null!=Y&&null!=W&&(Y.add_right(z,j),_.merge_left(Y,W),O.outp[r.ABOVE]=null,T.outp[r.ABOVE]=null);break;case d.IMM:null!=Y&&null!=W&&(Y.add_right(z,j),_.merge_left(Y,W),O.outp[r.ABOVE]=_.add_local_min(z,j),T.outp[r.ABOVE]=O.outp[r.ABOVE]);break;case d.EMM:null!=Y&&null!=W&&(Y.add_left(z,j),_.merge_right(Y,W),O.outp[r.ABOVE]=_.add_local_min(z,j),T.outp[r.ABOVE]=O.outp[r.ABOVE])}}0!=O.bundle[r.ABOVE][r.CLIP]&&(T.bside[r.CLIP]=0==T.bside[r.CLIP]?1:0),0!=T.bundle[r.ABOVE][r.CLIP]&&(O.bside[r.CLIP]=0==O.bside[r.CLIP]?1:0),0!=O.bundle[r.ABOVE][r.SUBJ]&&(T.bside[r.SUBJ]=0==T.bside[r.SUBJ]?1:0),0!=T.bundle[r.ABOVE][r.SUBJ]&&(O.bside[r.SUBJ]=0==O.bside[r.SUBJ]?1:0);var F=O.prev,S=T.next;if(null!=S&&(S.prev=O),O.bstate[r.ABOVE]==s.BUNDLE_HEAD)for(var K=!0;K;)F=F.prev,null!=F?F.bstate[r.ABOVE]!=s.BUNDLE_TAIL&&(K=!1):K=!1;null==F?(b.top_node.prev=T,T.next=b.top_node,b.top_node=O.next):(F.next.prev=T,T.next=F.next,F.next=O.next),O.next.prev=F,T.next.prev=T,O.next=S,o.geometry.Clip.DEBUG&&_.print()}for(var I=b.top_node;null!=I;I=I.next){var S=I.next,$=I.succ;if(I.top.y==B&&null!=$){$.outp[r.BELOW]=I.outp[r.ABOVE],$.bstate[r.BELOW]=I.bstate[r.ABOVE],$.bundle[r.BELOW][r.CLIP]=I.bundle[r.ABOVE][r.CLIP],$.bundle[r.BELOW][r.SUBJ]=I.bundle[r.ABOVE][r.SUBJ];var F=I.prev;null!=F?F.next=$:b.top_node=$,null!=S&&(S.prev=$),$.prev=F,$.next=S}else I.outp[r.BELOW]=I.outp[r.ABOVE],I.bstate[r.BELOW]=I.bstate[r.ABOVE],I.bundle[r.BELOW][r.CLIP]=I.bundle[r.ABOVE][r.CLIP],I.bundle[r.BELOW][r.SUBJ]=I.bundle[r.ABOVE][r.SUBJ],I.xb=I.xt;I.outp[r.ABOVE]=null}}}return a=_.getResult(i)},v.EQ=function(t,e){return Math.abs(t-e)<=o.geometry.Clip.GPC_EPSILON},v.PREV_INDEX=function(t,e){return(t-1+e)%e},v.NEXT_INDEX=function(t,e){return(t+1)%e},v.OPTIMAL=function(t,e){return t.getY(o.geometry.Clip.PREV_INDEX(e,t.getNumPoints()))!=t.getY(e)||t.getY(o.geometry.Clip.NEXT_INDEX(e,t.getNumPoints()))!=t.getY(e)},v.create_contour_bboxes=function(t){for(var e=[],n=0;n<t.getNumInnerPoly();n++){var i=t.getInnerPoly(n);e[n]=i.getBounds()}return e},v.minimax_test=function(t,e,n){for(var i=o.geometry.Clip.create_contour_bboxes(t),r=o.geometry.Clip.create_contour_bboxes(e),s=t.getNumInnerPoly(),a=e.getNumInnerPoly(),l=_.create2DArray(s,a),h=0;s>h;h++)for(var u=0;a>u;u++)l[h][u]=!(i[h].getMaxX()<r[u].getMinX()||i[h].getMinX()>r[u].getMaxX()||i[h].getMaxY()<r[u].getMinY()||i[h].getMinY()>r[u].getMaxY());for(var u=0;a>u;u++){for(var p=!1,h=0;!p&&s>h;h++)p=l[h][u];p||e.setContributing(u,!1)}if(n==o.geometry.OperationType.GPC_INT)for(var h=0;s>h;h++){for(var p=!1,u=0;!p&&a>u;u++)p=l[h][u];p||t.setContributing(h,!1)}},v.bound_list=function(t,e){if(null==t.top_node)return t.top_node=new a(e),t.top_node;for(var n=null,i=t.top_node,o=!1;!o;)if(e<i.y){var r=i;i=new a(e),i.next=r,null==n?t.top_node=i:n.next=i,o=!0}else e>i.y?null==i.next?(i.next=new a(e),i=i.next,o=!0):(n=i,i=i.next):o=!0;return i},v.insert_bound=function(t,e){if(null==t.first_bound)t.first_bound=e;else for(var n=!1,i=null,o=t.first_bound;!n;)e.bot.x<o.bot.x?(null==i?t.first_bound=e:i.next_bound=e,e.next_bound=o,n=!0):e.bot.x==o.bot.x&&e.dx<o.dx?(null==i?t.first_bound=e:i.next_bound=e,e.next_bound=o,n=!0):null==o.next_bound?(o.next_bound=e,n=!0):(i=o,o=o.next_bound)},v.add_edge_to_aet=function(t,e){if(null==t.top_node)t.top_node=e,e.prev=null,e.next=null;else for(var n=t.top_node,i=null,o=!1;!o;)e.xb<n.xb?(e.prev=i,e.next=n,n.prev=e,null==i?t.top_node=e:i.next=e,o=!0):e.xb==n.xb&&e.dx<n.dx?(e.prev=i,e.next=n,n.prev=e,null==i?t.top_node=e:i.next=e,o=!0):(i=n,null==n.next?(n.next=e,e.prev=n,e.next=null,o=!0):n=n.next)},v.add_to_sbtree=function(t,e){if(null==t.sb_tree)return t.sb_tree=new o.geometry.ScanBeamTree(e),void t.sbt_entries++;for(var n=t.sb_tree,i=!1;!i;)n.y>e?null==n.less?(n.less=new o.geometry.ScanBeamTree(e),t.sbt_entries++,i=!0):n=n.less:n.y<e?null==n.more?(n.more=new o.geometry.ScanBeamTree(e),t.sbt_entries++,i=!0):n=n.more:i=!0},v.build_lmt=function(t,e,n,i,a){for(var l=new o.geometry.EdgeTable,h=0;h<n.getNumInnerPoly();h++){var u=n.getInnerPoly(h);if(u.isContributing(0)){var p=0,y=0;l=new o.geometry.EdgeTable;for(var d=0;d<u.getNumPoints();d++)if(o.geometry.Clip.OPTIMAL(u,d)){var f=u.getX(d),c=u.getY(d);l.addNode(f,c),o.geometry.Clip.add_to_sbtree(e,u.getY(d)),p++}for(var g=0;p>g;g++)if(l.FWD_MIN(g)){for(var m=1,v=o.geometry.Clip.NEXT_INDEX(g,p);l.NOT_FMAX(v);)m++,v=o.geometry.Clip.NEXT_INDEX(v,p);var x=g,_=l.getNode(y);_.bstate[o.geometry.Clip.BELOW]=o.geometry.BundleState.UNBUNDLED,_.bundle[o.geometry.Clip.BELOW][r.CLIP]=0,_.bundle[o.geometry.Clip.BELOW][r.SUBJ]=0;for(var d=0;m>d;d++){var b=l.getNode(y+d),P=l.getNode(x);b.xb=P.vertex.x,b.bot.x=P.vertex.x,b.bot.y=P.vertex.y,x=o.geometry.Clip.NEXT_INDEX(x,p),P=l.getNode(x),b.top.x=P.vertex.x,b.top.y=P.vertex.y,b.dx=(P.vertex.x-b.bot.x)/(b.top.y-b.bot.y),b.type=i,b.outp[o.geometry.Clip.ABOVE]=null,b.outp[o.geometry.Clip.BELOW]=null,b.next=null,b.prev=null,b.succ=m>1&&m-1>d?l.getNode(y+d+1):null,b.pred=m>1&&d>0?l.getNode(y+d-1):null,b.next_bound=null,b.bside[o.geometry.Clip.CLIP]=a==o.geometry.OperationType.GPC_DIFF?o.geometry.Clip.RIGHT:o.geometry.Clip.LEFT,b.bside[o.geometry.Clip.SUBJ]=o.geometry.Clip.LEFT}r.insert_bound(o.geometry.Clip.bound_list(t,l.getNode(g).vertex.y),_),o.geometry.Clip.DEBUG&&t.print(),y+=m}for(var g=0;p>g;g++)if(l.REV_MIN(g)){for(var m=1,v=o.geometry.Clip.PREV_INDEX(g,p);l.NOT_RMAX(v);)m++,v=o.geometry.Clip.PREV_INDEX(v,p);var x=g,_=l.getNode(y);_.bstate[o.geometry.Clip.BELOW]=s.UNBUNDLED,_.bundle[o.geometry.Clip.BELOW][o.geometry.Clip.CLIP]=0,_.bundle[o.geometry.Clip.BELOW][o.geometry.Clip.SUBJ]=0;for(var d=0;m>d;d++){var b=l.getNode(y+d),P=l.getNode(x);b.xb=P.vertex.x,b.bot.x=P.vertex.x,b.bot.y=P.vertex.y,x=o.geometry.Clip.PREV_INDEX(x,p),P=l.getNode(x),b.top.x=P.vertex.x,b.top.y=P.vertex.y,b.dx=(P.vertex.x-b.bot.x)/(b.top.y-b.bot.y),b.type=i,b.outp[o.geometry.Clip.ABOVE]=null,b.outp[o.geometry.Clip.BELOW]=null,b.next=null,b.prev=null,b.succ=m>1&&m-1>d?l.getNode(y+d+1):null,b.pred=m>1&&d>0?l.getNode(y+d-1):null,b.next_bound=null,b.bside[o.geometry.Clip.CLIP]=a==o.geometry.OperationType.GPC_DIFF?o.geometry.Clip.RIGHT:o.geometry.Clip.LEFT,b.bside[o.geometry.Clip.SUBJ]=o.geometry.Clip.LEFT}r.insert_bound(o.geometry.Clip.bound_list(t,l.getNode(g).vertex.y),_),o.geometry.Clip.DEBUG&&t.print(),y+=m}}else u.setContributing(0,!0)}return l},v.add_st_edge=function(t,e,n,i){if(null==t)t=new o.geometry.StNode(n,null);else{var r=t.xt-t.xb-(n.xt-n.xb);if(n.xt>=t.xt||n.dx==t.dx||Math.abs(r)<=o.geometry.Clip.GPC_EPSILON){var s=t;t=new g(n,s)}else{var a=(n.xb-t.xb)/r,l=t.xb+a*(t.xt-t.xb),h=a*i;e.top_node=o.geometry.Clip.add_intersection(e.top_node,t.edge,n,l,h),t.prev=o.geometry.Clip.add_st_edge(t.prev,e,n,i)}}return t},v.add_intersection=function(t,e,n,i,r){if(null==t)t=new o.geometry.ItNode(e,n,i,r,null);else if(t.point.y>r){var s=t;t=new o.geometry.ItNode(e,n,i,r,s)}else t.next=o.geometry.Clip.add_intersection(t.next,e,n,i,r);return t},o.geometry.AetTree=function(){this.top_node=null},u=o.geometry.AetTree,o.geometry.AetTree.prototype.print=function(){for(var t=this.top_node;null!=t;t=t.next);},o.geometry.BundleState=function(t){this.m_State=t},o.geometry.BundleState.UNBUNDLED=new o.geometry.BundleState("UNBUNDLED"),o.geometry.BundleState.BUNDLE_HEAD=new o.geometry.BundleState("BUNDLE_HEAD"),o.geometry.BundleState.BUNDLE_TAIL=new o.geometry.BundleState("BUNDLE_TAIL"),o.geometry.BundleState.prototype.toString=function(){return this.m_State},s=o.geometry.BundleState,o.geometry.EdgeNode=function(){this.vertex=new m,this.bot=new m,this.top=new m,this.xb,this.xt,this.dx,this.type,this.bundle=_.create2DArray(2,2),this.bside=[],this.bstate=[],this.outp=[],this.prev,this.next,this.pred,this.succ,this.next_bound},o.geometry.EdgeTable=function(){this.m_List=new o.util.ArrayList},o.geometry.EdgeTable.prototype.addNode=function(t,e){var n=new o.geometry.EdgeNode;n.vertex.x=t,n.vertex.y=e,this.m_List.add(n)},o.geometry.EdgeTable.prototype.getNode=function(t){return this.m_List.get(t)},o.geometry.EdgeTable.prototype.FWD_MIN=function(t){var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),i=e.get(r.NEXT_INDEX(t,e.size())),o=e.get(t);return n.vertex.y>=o.vertex.y&&i.vertex.y>o.vertex.y},o.geometry.EdgeTable.prototype.NOT_FMAX=function(t){var e=this.m_List,n=e.get(r.NEXT_INDEX(t,e.size())),i=e.get(t);return n.vertex.y>i.vertex.y},o.geometry.EdgeTable.prototype.REV_MIN=function(t){var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),i=e.get(r.NEXT_INDEX(t,e.size())),o=e.get(t);return n.vertex.y>o.vertex.y&&i.vertex.y>=o.vertex.y},o.geometry.EdgeTable.prototype.NOT_RMAX=function(t){var e=this.m_List,n=e.get(r.PREV_INDEX(t,e.size())),i=e.get(t);return n.vertex.y>i.vertex.y},o.geometry.HState=function(){},o.geometry.HState.NH=0,o.geometry.HState.BH=1,o.geometry.HState.TH=2,p=o.geometry.HState;var P=o.geometry.HState.NH,E=o.geometry.HState.BH,B=o.geometry.HState.TH;o.geometry.HState.next_h_state=[[E,B,B,E,P,P],[P,P,P,P,B,B],[P,P,P,P,E,E]],o.geometry.IntersectionPoint=function(t,e,n){this.polygonPoint1=t,this.polygonPoint2=e,this.intersectionPoint=n},o.geometry.IntersectionPoint.prototype.toString=function(){return"P1 :"+polygonPoint1.toString()+" P2:"+polygonPoint2.toString()+" IP:"+intersectionPoint.toString()},o.geometry.ItNode=function(t,e,n,i,o){this.ie=[],this.point=new m(n,i),this.next=o,this.ie[0]=t,this.ie[1]=e},o.geometry.ItNodeTable=function(){this.top_node},c=o.geometry.ItNodeTable,o.geometry.ItNodeTable.prototype.build_intersection_table=function(t,e){for(var n=null,i=t.top_node;null!=i;i=i.next)(i.bstate[r.ABOVE]==s.BUNDLE_HEAD||0!=i.bundle[r.ABOVE][r.CLIP]||0!=i.bundle[r.ABOVE][r.SUBJ])&&(n=o.geometry.Clip.add_st_edge(n,this,i,e))},o.geometry.Line=function(){this.start,this.end},o.geometry.LineHelper=function(){},o.geometry.LineHelper.equalPoint=function(t,e){return t[0]==e[0]&&t[1]==e[1]},o.geometry.LineHelper.equalVertex=function(t,e,n,i){return o.geometry.LineHelper.equalPoint(t,n)&&o.geometry.LineHelper.equalPoint(e,i)||o.geometry.LineHelper.equalPoint(t,i)&&o.geometry.LineHelper.equalPoint(e,n)},o.geometry.LineHelper.distancePoints=function(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))},o.geometry.LineHelper.clonePoint=function(t){return[t[0],t[1]]},o.geometry.LineHelper.cloneLine=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=[t[n][0],t[n][1]];return e},o.geometry.LineHelper.addLineToLine=function(t,e){for(var n=0;n<e.length;n++)t.push(clonePoint(e[n]))},o.geometry.LineHelper.roundPoint=function(t){t[0]=Math.round(t[0]),t[1]=Math.round(t[1])},o.geometry.LineHelper.lineIntersectLine=function(t,e,n,i,o){null==o&&(o=!0);var r,s,a,l,h,u,p;s=e.y-t.y,l=t.x-e.x,u=e.x*t.y-t.x*e.y,a=i.y-n.y,h=n.x-i.x,p=i.x*n.y-n.x*i.y;var y=s*h-a*l;if(0==y)return null;if(r=new m,r.x=(l*p-h*u)/y,r.y=(a*u-s*p)/y,o){if(Math.pow(r.x-e.x+(r.y-e.y),2)>Math.pow(t.x-e.x+(t.y-e.y),2))return null;if(Math.pow(r.x-t.x+(r.y-t.y),2)>Math.pow(t.x-e.x+(t.y-e.y),2))return null;if(Math.pow(r.x-i.x+(r.y-i.y),2)>Math.pow(n.x-i.x+(n.y-i.y),2))return null;if(Math.pow(r.x-n.x+(r.y-n.y),2)>Math.pow(n.x-i.x+(n.y-i.y),2))return null}return new m(Math.round(r.x),Math.round(r.y))},o.geometry.LineIntersection=function(){},o.geometry.LineIntersection.iteratePoints=function(t,e,n,o,r){var s=!0,a=t.length,l=t.indexOf(e),h=t.indexOf(n),u=l;h>l&&(s=!1);var p,y=[];if(s)for(var d=0;a>d&&(p=a>d+u?t[d+u]:t[d+u-a],y.push(p),!i(p,o)&&!i(p,r));d++);else for(var d=a;d>=0&&(p=a>d+u?t[d+u]:t[d+u-a],y.push(p),!i(p,o)&&!i(p,r));d--);return y},o.geometry.LineIntersection.intersectPoly=function(t,e){for(var n,r,s,a,l,h=t.getNumPoints(),u=null,p=null,y=-1,d=-1,f=!1,c=1;c<e.length;c++){r=e[c-1],s=e[c];for(var g=0,v=Number.MAX_VALUE,x=-1,_=0;h>_;_++)a=t.getPoint(0==_?h-1:_-1),l=t.getPoint(_),null!=(n=LineHelper.lineIntersectLine(r,s,a,l))&&(x=m.distance(n,s),x>g&&!f&&(g=x,u=new IntersectionPoint(a,l,n),y=c),v>x&&(v=x,p=new IntersectionPoint(a,l,n),d=c-1));f=null!=u}if(null!=u&&null!=p){var b=[];b[0]=u.intersectionPoint;for(var _=1,c=y;d>=c;c++)b[_++]=e[c];if(b[b.length-1]=p.intersectionPoint,i(u.polygonPoint1,p.polygonPoint1)&&i(u.polygonPoint2,p.polygonPoint2)||i(u.polygonPoint1,p.polygonPoint2)&&i(u.polygonPoint2,p.polygonPoint1)){
var P=new o.geometry.PolySimple;P.add(b);var E=t.intersection(P),B=t.xor(P);if(checkPoly(E)&&checkPoly(B))return[E,B]}else{var L=iteratePoints(t.getPoints(),u.polygonPoint1,u.polygonPoint2,p.polygonPoint1,p.polygonPoint2);L=L.concat(b.reverse());var I=iteratePoints(t.getPoints(),u.polygonPoint2,u.polygonPoint1,p.polygonPoint1,p.polygonPoint2);I=I.concat(b);var P=new o.geometry.PolySimple;P.add(L);var C=new o.geometry.PolySimple;C.add(I);var E=t.intersection(P),B=t.intersection(C);if(checkPoly(E)&&checkPoly(B))return[E,B]}}return null},o.geometry.LineIntersection.checkPoly=function(t){for(var e=0,n=0;n<t.getNumInnerPoly();n++){var i=t.getInnerPoly(n);if(i.isHole())return!1;if(e++,e>1)return!1}return!0},o.geometry.LmtNode=function(t){this.y=t,this.first_bound,this.next},a=o.geometry.LmtNode,o.geometry.LmtTable=function(){this.top_node},o.geometry.LmtTable.prototype.print=function(){for(var t=0,e=this.top_node;null!=e;){for(var n=e.first_bound;null!=n;n=n.next_bound);t++,e=e.next}},o.geometry.OperationType=function(t){this.m_Type=t},o.geometry.OperationType.GPC_DIFF=new o.geometry.OperationType("Difference"),o.geometry.OperationType.GPC_INT=new o.geometry.OperationType("Intersection"),o.geometry.OperationType.GPC_XOR=new o.geometry.OperationType("Exclusive or"),o.geometry.OperationType.GPC_UNION=new o.geometry.OperationType("Union"),o.geometry.PolyDefault=function(t){null==t&&(t=!1),this.m_IsHole=t,this.m_List=new o.util.ArrayList},o.geometry.PolyDefault.prototype.equals=function(t){if(!(t instanceof PolyDefault))return!1;var e=t;return this.m_IsHole!=e.m_IsHole?!1:i(this.m_List,e.m_List)?!0:!1},o.geometry.PolyDefault.prototype.hashCode=function(){var t=this.m_List,e=17;return e=37*e+t.hashCode()},o.geometry.PolyDefault.prototype.clear=function(){this.m_List.clear()},o.geometry.PolyDefault.prototype.add=function(t,e){var n=[];if(n[0]=t,e&&(n[1]=e),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof m)this.addPoint(n[0]);else if(n[0]instanceof o.geometry.PolySimple)this.addPoly(n[0]);else if(n[0]instanceof Array){var i=n[0];if(2==i.length&&i[0]instanceof Number&&i[1]instanceof Number)this.add(i[0],i[1]);else for(var r=0;r<n[0].length;r++)this.add(n[0][r])}},o.geometry.PolyDefault.prototype.addPointXY=function(t,e){this.addPoint(new m(t,e))},o.geometry.PolyDefault.prototype.addPoint=function(t){var e=this.m_List;0==e.size()&&e.add(new o.geometry.PolySimple),e.get(0).addPoint(t)},o.geometry.PolyDefault.prototype.addPoly=function(t){var e=this.m_IsHole,n=this.m_List;n.size()>0&&e&&alert("ERROR : Cannot add polys to something designated as a hole."),n.add(t)},o.geometry.PolyDefault.prototype.isEmpty=function(){return this.m_List.isEmpty()},o.geometry.PolyDefault.prototype.getBounds=function(){var t=this.m_List;if(0==t.size())return new Rectangle;if(1==t.size()){var e=this.getInnerPoly(0);return e.getBounds()}console.log("getBounds not supported on complex poly.")},o.geometry.PolyDefault.prototype.getInnerPoly=function(t){return this.m_List.get(t)},o.geometry.PolyDefault.prototype.getNumInnerPoly=function(){var t=this.m_List;return t.size()},o.geometry.PolyDefault.prototype.getNumPoints=function(){return this.m_List.get(0).getNumPoints()},o.geometry.PolyDefault.prototype.getX=function(t){return this.m_List.get(0).getX(t)},o.geometry.PolyDefault.prototype.getPoint=function(t){return this.m_List.get(0).getPoint(t)},o.geometry.PolyDefault.prototype.getPoints=function(){return this.m_List.get(0).getPoints()},o.geometry.PolyDefault.prototype.isPointInside=function(t){var e=this.m_List;if(!e.get(0).isPointInside(t))return!1;for(var n=0;n<e.size();n++){var i=e.get(n);if(i.isHole()&&i.isPointInside(t))return!1}return!0},o.geometry.PolyDefault.prototype.getY=function(t){var e=this.m_List;return e.get(0).getY(t)},o.geometry.PolyDefault.prototype.isHole=function(){var t=this.m_List,e=this.m_IsHole;return t.size()>1&&alert("Cannot call on a poly made up of more than one poly."),e},o.geometry.PolyDefault.prototype.setIsHole=function(t){var e=this.m_List;e.size()>1&&alert("Cannot call on a poly made up of more than one poly."),this.m_IsHole=t},o.geometry.PolyDefault.prototype.isContributing=function(t){var e=this.m_List;return e.get(t).isContributing(0)},o.geometry.PolyDefault.prototype.setContributing=function(t,e){var n=this.m_List;1!=n.size()&&alert("Only applies to polys of size 1"),n.get(t).setContributing(0,e)},o.geometry.PolyDefault.prototype.intersection=function(t){return o.geometry.Clip.intersection(t,this,"PolyDefault")},o.geometry.PolyDefault.prototype.union=function(t){return o.geometry.Clip.union(t,this,"PolyDefault")},o.geometry.PolyDefault.prototype.xor=function(t){return o.geometry.Clip.xor(t,this,"PolyDefault")},o.geometry.PolyDefault.prototype.difference=function(t){return o.geometry.Clip.difference(t,this,"PolyDefault")},o.geometry.PolyDefault.prototype.getArea=function(){for(var t=0,e=0;e<getNumInnerPoly();e++){var n=getInnerPoly(e),i=n.getArea()*(n.isHole()?-1:1);t+=i}return t},o.geometry.PolyDefault.prototype.toString=function(){for(var t="",e=this.m_List,n=0;n<e.size();n++){var i=this.getInnerPoly(n);t+="InnerPoly("+n+").hole="+i.isHole();for(var o=[],r=0;r<i.getNumPoints();r++)o.push(new m(i.getX(r),i.getY(r)));o=_.sortPointsClockwise(o);for(var s=0;s<o.length;s++)t+=o[s].toString()}return t},o.geometry.Polygon=function(){this.maxTop,this.maxBottom,this.maxLeft,this.maxRight,this.vertices},o.geometry.Polygon.prototype.fromArray=function(t){this.vertices=[];for(var e=0;e<t.length;e++){var n=t[e];this.vertices.push(new m(n[0],n[1]))}},o.geometry.Polygon.prototype.normalize=function(){for(var t,e=this.vertices,n=this.vertices,o=0;o<e.length;o++){var r=e[o];(null==maxTop||maxTop.y>r.y||maxTop.y==r.y&&r.x<maxTop.x)&&(maxTop=r),(null==maxBottom||maxBottom.y<r.y||maxBottom.y==r.y&&r.x>maxBottom.x)&&(maxBottom=r),(null==maxLeft||maxLeft.x>r.x||maxLeft.x==r.x&&r.y>maxLeft.y)&&(maxLeft=r,t=o),(null==maxRight||maxRight.x<r.x||maxRight.x==r.x&&r.y<maxRight.y)&&(maxRight=r)}if(t>0){n=[];for(var s=0,o=t;o<e.length;o++)n[s++]=this.vertices[o];for(var o=0;t>o;o++)n[s++]=this.vertices[o];e=n}for(var a=!1,l=0;l<this.vertices.length;l++){var r=this.vertices[l];if(i(r,maxBottom)){a=!0;break}if(i(r,maxTop))break}if(a){n=[],n[0]=e[0];for(var s=1,o=e.length-1;o>0;o--)n[s++]=this.vertices[o];e=n}},o.geometry.Polygon.prototype.getVertexIndex=function(t){for(var e=0;e<this.vertices.length;e++)if(i(vertices[e],t))return e;return-1},o.geometry.Polygon.prototype.insertVertex=function(t,e,n){var i=getVertexIndex(t),o=getVertexIndex(e);if(-1==i||-1==o)return!1;if(i>o){var r=i;i=o,o=r}if(o==i+1){for(var s=[],r=0;i>=r;r++)s[r]=this.vertices[r];s[o]=n;for(var r=o;r<this.vertices.length;r++)s[r+1]=this.vertices[r];this.vertices=s}else o==vertices.length-1&&0==i&&this.vertices.push(n);return!0},o.geometry.Polygon.prototype.clone=function(){var t=new o.geometry.Polygon;return t.vertices=vertices.slice(this.vertices.length-1),t},o.geometry.Polygon.prototype.toString=function(){for(var t=this.vertices,e="[",n=0;n<t.length;n++){var i=t[n];e+=(n>0?",":"")+"["+i.x+","+i.y+"]"}return e+="]"},o.geometry.PolygonNode=function(t,e,n){this.active,this.hole,this.v=[],this.next,this.proxy;var i=new f(e,n);this.v[r.LEFT]=i,this.v[r.RIGHT]=i,this.next=t,this.proxy=this,this.active=1},o.geometry.PolygonNode.prototype.add_right=function(t,e){var n=new f(t,e);this.proxy.v[r.RIGHT].next=n,this.proxy.v[r.RIGHT]=n},o.geometry.PolygonNode.prototype.add_left=function(t,e){var n=this.proxy,i=new f(t,e);i.next=n.v[r.LEFT],n.v[r.LEFT]=i},o.geometry.PolySimple=function(){this.m_List=new o.util.ArrayList,this.m_Contributes=!0},o.geometry.PolySimple.prototype.equals=function(t){if(!(t instanceof PolySimple))return!1;var e=t,n=this.m_List.size(),i=e.m_List.size();if(n!=i)return!1;if(n>0){for(var o=this.getX(0),r=this.getY(0),s=-1,a=0;-1==s&&i>a;a++){var l=e.getX(a),h=e.getY(a);o==l&&r==h&&(s=a)}if(-1==s)return!1;for(var a=s,u=0;n>u;u++){o=this.getX(u),r=this.getY(u);var l=e.getX(a),h=e.getY(a);if(o!=l||r!=h)return!1;a++,a>=i&&(a=0)}}return!0},o.geometry.PolySimple.prototype.hashCode=function(){var t=17;return t=37*t+this.m_List.hashCode()},o.geometry.PolySimple.prototype.toString=function(){return"PolySimple: num_points="+getNumPoints()},o.geometry.PolySimple.prototype.clear=function(){this.m_List.clear()},o.geometry.PolySimple.prototype.add=function(t,e){var n=[];if(n[0]=t,e&&(n[1]=e),2==n.length)this.addPointXY(n[0],n[1]);else if(1==n.length)if(n[0]instanceof m)this.addPoint(n[0]);else if(n[0]instanceof Poly)this.addPoly(n[0]);else if(n[0]instanceof Array)for(var i=0;i<n[0].length;i++){var o=n[0][i];this.add(o)}},o.geometry.PolySimple.prototype.addPointXY=function(t,e){this.addPoint(new m(t,e))},o.geometry.PolySimple.prototype.addPoint=function(t){this.m_List.add(t)},o.geometry.PolySimple.prototype.addPoly=function(t){alert("Cannot add poly to a simple poly.")},o.geometry.PolySimple.prototype.isEmpty=function(){return this.m_List.isEmpty()},o.geometry.PolySimple.prototype.getBounds=function(){for(var t=Number.MAX_VALUE,e=Number.MAX_VALUE,n=-Number.MAX_VALUE,i=-Number.MAX_VALUE,o=0;o<this.m_List.size();o++){var r=this.getX(o),s=this.getY(o);t>r&&(t=r),r>n&&(n=r),e>s&&(e=s),s>i&&(i=s)}return new Rectangle(t,e,n-t,i-e)},o.geometry.PolySimple.prototype.getInnerPoly=function(t){return 0!=t&&alert("PolySimple only has one poly"),this},o.geometry.PolySimple.prototype.getNumInnerPoly=function(){return 1},o.geometry.PolySimple.prototype.getNumPoints=function(){return this.m_List.size()},o.geometry.PolySimple.prototype.getX=function(t){return this.m_List.get(t).x},o.geometry.PolySimple.prototype.getY=function(t){return this.m_List.get(t).y},o.geometry.PolySimple.prototype.getPoint=function(t){return this.m_List.get(t)},o.geometry.PolySimple.prototype.getPoints=function(){return this.m_List.toArray()},o.geometry.PolySimple.prototype.isPointInside=function(t){for(var e=this.getPoints(),n=e.length-1,i=!1,o=0;o<e.length;o++)(e[o].y<t.y&&e[n].y>=t.y||e[n].y<t.y&&e[o].y>=t.y)&&e[o].x+(t.y-e[o].y)/(e[n].y-e[o].y)*(e[n].x-e[o].x)<t.x&&(i=!i),n=o;return i},o.geometry.PolySimple.prototype.isHole=function(){return!1},o.geometry.PolySimple.prototype.setIsHole=function(t){alert("PolySimple cannot be a hole")},o.geometry.PolySimple.prototype.isContributing=function(t){return 0!=t&&alert("PolySimple only has one poly"),this.m_Contributes},o.geometry.PolySimple.prototype.setContributing=function(t,e){0!=t&&alert("PolySimple only has one poly"),this.m_Contributes=e},o.geometry.PolySimple.prototype.intersection=function(t){return o.geometry.Clip.intersection(this,t,"PolySimple")},o.geometry.PolySimple.prototype.union=function(t){return o.geometry.Clip.union(this,t,"PolySimple")},o.geometry.PolySimple.prototype.xor=function(t){return o.geometry.Clip.xor(t,this,"PolySimple")},o.geometry.PolySimple.prototype.difference=function(t){return o.geometry.Clip.difference(t,this,"PolySimple")},o.geometry.PolySimple.prototype.getArea=function(){if(this.getNumPoints()<3)return 0;for(var t=this.getX(0),e=this.getY(0),n=0,i=1;i<this.getNumPoints()-1;i++){var o=this.getX(i),r=this.getY(i),s=this.getX(i+1),a=this.getY(i+1),l=(s-o)*(e-r)-(t-o)*(a-r);n+=l}return n=.5*Math.abs(n)},o.geometry.Rectangle=function(t,e,n,i){this.x=t,this.y=e,this.w=n,this.h=i},o.geometry.Rectangle.prototype.getMaxY=function(){return this.y+this.h},o.geometry.Rectangle.prototype.getMinY=function(){return this.y},o.geometry.Rectangle.prototype.getMaxX=function(){return this.x+this.w},o.geometry.Rectangle.prototype.getMinX=function(){return this.x},o.geometry.Rectangle.prototype.toString=function(){return"["+x.toString()+" "+y.toString()+" "+w.toString()+" "+h.toString()+"]"},o.geometry.ScanBeamTree=function(t){this.y=t,this.less,this.more},o.geometry.ScanBeamTreeEntries=function(){this.sbt_entries=0,this.sb_tree},o.geometry.ScanBeamTreeEntries.prototype.build_sbt=function(){var t=[],e=0;return e=this.inner_build_sbt(e,t,this.sb_tree),e!=this.sbt_entries,t},o.geometry.ScanBeamTreeEntries.prototype.inner_build_sbt=function(t,e,n){return null!=n.less&&(t=this.inner_build_sbt(t,e,n.less)),e[t]=n.y,t++,null!=n.more&&(t=this.inner_build_sbt(t,e,n.more)),t},g=o.geometry.StNode=function(t,e){this.edge,this.xb,this.xt,this.dx,this.prev,this.edge=t,this.xb=t.xb,this.xt=t.xt,this.dx=t.dx,this.prev=e},o.geometry.TopPolygonNode=function(){this.top_node},l=o.geometry.TopPolygonNode,o.geometry.TopPolygonNode.prototype.add_local_min=function(t,e){var n=this.top_node;return this.top_node=new o.geometry.PolygonNode(n,t,e),this.top_node},o.geometry.TopPolygonNode.prototype.merge_left=function(t,e){e.proxy.hole=!0;var n=this.top_node;if(t.proxy!=e.proxy){t.proxy.v[r.RIGHT].next=e.proxy.v[r.LEFT],e.proxy.v[r.LEFT]=t.proxy.v[r.LEFT];for(var i=t.proxy,o=n;null!=o;o=o.next)o.proxy==i&&(o.active=0,o.proxy=e.proxy)}},o.geometry.TopPolygonNode.prototype.merge_right=function(t,e){var n=this.top_node;if(e.proxy.hole=!1,t.proxy!=e.proxy){e.proxy.v[r.RIGHT].next=t.proxy.v[r.LEFT],e.proxy.v[r.RIGHT]=t.proxy.v[r.RIGHT];for(var i=t.proxy,o=n;null!=o;o=o.next)o.proxy==i&&(o.active=0,o.proxy=e.proxy)}},o.geometry.TopPolygonNode.prototype.count_contours=function(){for(var t=0,e=this.top_node;null!=e;e=e.next)if(0!=e.active){for(var n=0,i=e.proxy.v[r.LEFT];null!=i;i=i.next)n++;n>2?(e.active=n,t++):e.active=0}return t},o.geometry.TopPolygonNode.prototype.getResult=function(t){var e=this.top_node,n=o.geometry.Clip.createNewPoly(t),i=this.count_contours();if(i>0){for(var s=0,a=null,l=e;null!=l;l=a)if(a=l.next,0!=l.active){var h=n;i>1&&(h=o.geometry.Clip.createNewPoly(t)),l.proxy.hole&&h.setIsHole(l.proxy.hole);for(var u=l.proxy.v[r.LEFT];null!=u;u=u.next)h.add(u.x,u.y);i>1&&n.addPoly(h),s++}var p=n;n=o.geometry.Clip.createNewPoly(t);for(var y=0;y<p.getNumInnerPoly();y++){var d=p.getInnerPoly(y);d.isHole()||n.addPoly(d)}for(var y=0;y<p.getNumInnerPoly();y++){var d=p.getInnerPoly(y);d.isHole()&&n.addPoly(d)}}return n},o.geometry.TopPolygonNode.prototype.print=function(){for(var t=this.top_node,e=0,n=null,i=t;null!=i;i=n)if(n=i.next,0!=i.active){for(var o=i.proxy.v[r.LEFT];null!=o;o=o.next);e++}},o.geometry.VertexNode=function(t,e){this.x,this.y,this.next,this.x=t,this.y=e,this.next=null},f=o.geometry.VertexNode,o.geometry.VertexType=function(){},o.geometry.VertexType.NUL=0,o.geometry.VertexType.EMX=1,o.geometry.VertexType.ELI=2,o.geometry.VertexType.TED=3,o.geometry.VertexType.ERI=4,o.geometry.VertexType.RED=5,o.geometry.VertexType.IMM=6,o.geometry.VertexType.IMN=7,o.geometry.VertexType.EMN=8,o.geometry.VertexType.EMM=9,o.geometry.VertexType.LED=10,o.geometry.VertexType.ILI=11,o.geometry.VertexType.BED=12,o.geometry.VertexType.IRI=13,o.geometry.VertexType.IMX=14,o.geometry.VertexType.FUL=15,o.geometry.VertexType.getType=function(t,e,n,i){return t+(e<<1)+(n<<2)+(i<<3)},d=o.geometry.VertexType,o.geometry.WeilerAtherton=function(){},o.geometry.WeilerAtherton.prototype.merge=function(t,e){t=t.clone(),e=e.clone()}},{}],6:[function(t,e,n){"use strict";function i(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i,this.items=[]}var o=function(t,e,n,i,o,r,s,a){var l=(s-o)*(e-r)-(a-r)*(t-o),h=(n-t)*(e-r)-(i-e)*(t-o),u=(a-r)*(n-t)-(s-o)*(i-e);if(0!==u){var p=l/u,y=h/u;if(p>=0&&1>=p&&y>=0&&1>=y)return!0}return!1};i.prototype.insert=function(t){(t.fromX>=this.x&&t.fromY>=this.y&&t.toX<=this.x+this.width&&t.toY<=this.y+this.height||o(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y,this.x+this.width,this.y)||o(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y,this.x,this.y+this.height)||o(t.fromX,t.fromY,t.toX,t.toY,this.x+this.width,this.y,this.x+this.width,this.y+this.height)||o(t.fromX,t.fromY,t.toX,t.toY,this.x,this.y+this.height,this.x+this.width,this.y+this.height))&&this.items.push(t)},n=e.exports=i},{}],7:[function(t,e,n){"use strict";function i(t,e,n){this.bounds=t,this.rows=e,this.cols=n,this.cellX=this.bounds.width/this.cols,this.cellY=this.bounds.height/this.rows,this.cells=[],this.out=new r;for(var i=0;i<this.cols;i++){this.cells[i]=[];for(var s=0;s<this.rows;s++)this.cells[i][s]=new o(i*this.cellX,s*this.cellY,this.cellX,this.cellY)}}var o=t("./cell"),r=t("../../linkedlist/doublylinkedlist");i.prototype.insert=function(t){if(t instanceof Array)for(var e=0,n=t.length;n>e;)this.insert(t),e++;else for(var i=0;i<this.cols;i++)for(var o=0;o<this.rows;o++)this.cells[i][o].insert(t)},i.prototype.addOut=function(t){for(var e=0,n=t.length;n>e;)this.out.add(t[e]),e++},i.prototype.retrieve=function(t){var e=t.x%this.cellX+t.width>this.cellX?!0:!1,n=t.y%this.cellY+t.height>this.cellY?!0:!1,i=Math.floor(t.x/this.cellX),o=Math.floor(t.y/this.cellY);return this.out.clear(),this.addOut(this.cells[i][o].items),e&&this.addOut(this.cells[i+1][o].items),n&&this.addOut(this.cells[i][o+1].items),e&&n&&this.addOut(this.cells[i+1][o+1].items),this.out},n=e.exports=i},{"../../linkedlist/doublylinkedlist":24,"./cell":6}],8:[function(t,e,n){e.exports={Grid:t("./grid"),Cell:t("./cell")}},{"./cell":6,"./grid":7}],9:[function(t,e,n){e.exports={Vector2:t("./vector2"),LineSegment2:t("./linesegment2"),Triangle2:t("./triangle2"),Polygon2:t("./polygon2"),RegularPolygon2:t("./regularpolygon2"),gpc:t("./gpc"),VisibilityPolygon:t("./visibilitypolygon"),Grid:t("./grid"),QuadTree:t("./quadtree")}},{"./gpc":5,"./grid":8,"./linesegment2":10,"./polygon2":11,"./quadtree":13,"./regularpolygon2":16,"./triangle2":17,"./vector2":18,"./visibilitypolygon":19}],10:[function(t,e,n){"use strict";function i(t,e){if(!(this instanceof i)){var n=r.pop();return n?(n.start.free(),n.end.free(),n.set(t,e)):(n=new i(t,e),s++),n}this.start=t||o(),this.end=e||o()}var o=t("./vector2");n=e.exports=i;var r=[],s=0;i.getStats=function(){return[r.length,s]},i.prototype.set=function(t,e){return this.start=t||o(),this.end=e||o(),this},i.prototype.free=function(){r.push(this)},i.prototype.lengthSq=function(){return this.start.distanceSq(this.end)},i.prototype.length=function(){return this.start.distance(this.end)},i.prototype.closestPoint=function(t,e){var n=this.lengthSq();if(0===n)return this.start.clone();var i=((t.x-this.start.x)*(this.end.x-this.start.x)+(t.y-this.start.y)*(this.end.y-this.start.y))/n;if(!e){if(0>i)return this.start.clone();if(i>1)return this.end.clone()}return o(this.start.x+i*(this.end.x-this.start.x),this.start.y+i*(this.end.y-this.start.y))},i.prototype.distanceSq=function(t,e){var n=this.closestPoint(t,e),i=t.distanceSq(n);return n.free(),i},i.prototype.distance=function(t,e){return Math.sqrt(this.distanceSq(t,e))},i.prototype.intersect=function(t,e){var n=(t.end.y-t.start.y)*(this.end.x-this.start.x)-(t.end.x-t.start.x)*(this.end.y-this.start.y);if(0===n)return null;var i=(t.end.x-t.start.x)*(this.start.y-t.start.y)-(t.end.y-t.start.y)*(this.start.x-t.start.x),r=(this.end.x-this.start.x)*(this.start.y-t.start.y)-(this.end.y-this.start.y)*(this.start.x-t.start.x),s=i/n,a=r/n;return e||s>=0&&1>=s&&a>=0&&1>=a?o(this.start.x-s*(this.start.x-this.end.x),this.start.y-s*(this.start.y-this.end.y)):!1},i.prototype.intersectCircle=function(t,e,n){var i=e*e,o=this.closestPoint(t,n),r=t.clone().subtract(o),s=r.distanceSq();return r.free(),i>s?o:(o.free(),!1)},i.prototype.equals=function(t){return this.start===t.start&&this.end===t.end},i.prototype.inverse=function(){return i(this.end.clone(),this.start.clone())}},{"./vector2":18}],11:[function(t,e,n){"use strict";function i(t){if(!(this instanceof i)){var e=a.pop();return e?(e.freePoints(),e.set(t)):(e=new i(t),l++),e}this.points=t||[]}var o=t("./vector2"),r=t("./linesegment2"),s=1e-7;n=e.exports=i;var a=[],l=0;i.fromArray=function(t){for(var e=i(),n=0;n<t.length;n++)e.add(o.fromArray(t[n]));return e},i.getStats=function(){return[a.length,l]},i.prototype.free=function(){this.freePoints(),a.push(this)},i.prototype.freePoints=function(){for(var t=this.points.pop();t;)t.free(),t=this.points.pop();return this},i.prototype.set=function(t){return this.points=t||[],this},i.prototype.add=function(t){return this.points.push(t),this},i.prototype.translate=function(t){for(var e=0;e<this.points.length;e++)this.points[e].add(t);return this},i.prototype.rotate=function(t,e){for(var n=0;n<this.points.length;n++)this.points[n].rotate(t,e);return this},i.prototype.containsPoint=function(t){for(var e=!1,n=0,i=this.points.length-1;n<this.points.length;i=n++){var o=this.points[n].x,r=this.points[n].y,s=this.points[i].x,a=this.points[i].y,l=r>t.y!=a>t.y&&t.x<(s-o)*(t.y-r)/(a-r)+o;l&&(e=!e)}return e},i.prototype.intersectsLine=function(t,e){for(var n=r(),i=!1,o=0,a=this.points.length-1;o<this.points.length;a=o++){var l=this.points[o].x,h=this.points[o].y,u=this.points[a].x,p=this.points[a].y;n.start.set(l,h),n.end.set(u,p);var y=n.intersect(t);if(y){if(e&&(this.points[o].isEqualEpsilon(y)||this.points[a].isEqualEpsilon(y)||t.start.isEqualEpsilon(y)||t.end.isEqualEpsilon(y))){var d=this.points[o].clone().subtract(this.points[a]).normalize(),f=d.angle();d.copy(t.start).subtract(t.end).normalize();var c=d.angle();if(d.free(),y.free(),Math.abs(f-c)<s){i=!0;break}continue}y.free(),i=!0;break}}return n.free(),i},i.prototype.intersectsTriangle=function(t,e){var n=r();return n.start.copy(t.v0),n.end.copy(t.v1),this.intersectsLine(n,e)?(n.free(),!0):(n.start.copy(t.v1),n.end.copy(t.v2),this.intersectsLine(n,e)?(n.free(),!0):(n.start.copy(t.v2),n.end.copy(t.v0),this.intersectsLine(n,e)?(n.free(),!0):!1))},i.prototype.AABB=function(){for(var t=this.points[0].clone(),e=this.points[0].clone(),n=1;n<this.points.length;n++){var i=this.points[n];i.x<t.x?t.x=i.x:i.x>e.x&&(e.x=i.x),i.y<t.y?t.y=i.y:i.y>e.y&&(e.y=i.y)}return[t,e]},i.prototype.winding=function(){return this.area()>0},i.prototype.rewind=function(t){t=!!t;var e=this.winding();return e!==t&&this.points.reverse(),this},i.prototype.area=function(){for(var t=0,e=this.points[0],n=o(),i=o(),r=0,s=this.points.length-1;r<this.points.length;s=r++)n.copy(e).subtract(this.points[r]),i.copy(e).subtract(this.points[s]),t+=n.cross(i);return n.free(),i.free(),t/2},i.prototype.clean=function(t){for(var e=o(),n=[],i=0,r=this.points.length-1;i<this.points.length;r=i++){var s=e.copy(this.points[i]).subtract(this.points[r]).length();s>t?n.push(this.points[i]):this.points[i].free()}this.points=n},i.prototype.toArray=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].toArray());return t}},{"./linesegment2":10,"./vector2":18}],12:[function(t,e,n){"use strict";function i(t,e,n,i){o.call(this,t,e,n,i),this._stuckChildren=[]}var o=t("./pointnode");i.prototype=new o,i.prototype._classConstructor=i,i.prototype._stuckChildren=null,i.prototype._out=[],i.prototype.insert=function(t){if(this.nodes.length){var e=this._findIndex(t),n=this.nodes[e];return void(t.x>=n._bounds.x&&t.x+t.width<=n._bounds.x+n._bounds.width&&t.y>=n._bounds.y&&t.y+t.height<=n._bounds.y+n._bounds.height?this.nodes[e].insert(t):this._stuckChildren.push(t))}this.children.push(t);var i=this.children.length;if(this._depth<this._maxDepth&&i>this._maxChildren){this.subdivide();var o;for(o=0;i>o;o++)this.insert(this.children[o]);this.children.length=0}},i.prototype.getChildren=function(){return this.children.concat(this._stuckChildren)},i.prototype.retrieve=function(t){var e=this._out;if(e.length=0,this.nodes.length){var n=this._findIndex(t),i=this.nodes[n];t.x>=i._bounds.x&&t.x+t.width<=i._bounds.x+i._bounds.width&&t.y>=i._bounds.y&&t.y+t.height<=i._bounds.y+i._bounds.height?e.push.apply(e,this.nodes[n].retrieve(t)):(t.x<=this.nodes[o.TOP_RIGHT]._bounds.x&&(t.y<=this.nodes[o.BOTTOM_LEFT]._bounds.y&&e.push.apply(e,this.nodes[o.TOP_LEFT].retrieve(t)),t.y+t.height>this.nodes[o.BOTTOM_LEFT]._bounds.y&&e.push.apply(e,this.nodes[o.BOTTOM_LEFT].retrieve(t))),t.x+t.width>this.nodes[o.TOP_RIGHT]._bounds.x&&(t.y<=this.nodes[o.BOTTOM_RIGHT]._bounds.y&&e.push.apply(e,this.nodes[o.TOP_RIGHT].retrieve(t)),t.y+t.height>this.nodes[o.BOTTOM_RIGHT]._bounds.y&&e.push.apply(e,this.nodes[o.BOTTOM_RIGHT].retrieve(t))))}return e.push.apply(e,this._stuckChildren),e.push.apply(e,this.children),e},i.prototype.getAllContent=function(){var t=this._out;if(this.nodes.length){var e;for(e=0;e<this.nodes.length;e++)this.nodes[e].getAllContent()}return t.push.apply(t,this._stuckChildren),t.push.apply(t,this.children),t},i.prototype.clear=function(){this._stuckChildren.length=0,this.children.length=0;var t=this.nodes.length;if(t){var e;for(e=0;t>e;e++)this.nodes[e].clear();this.nodes.length=0}},n=e.exports=i},{"./pointnode":14}],13:[function(t,e,n){e.exports={QuadTree:t("./quadtree"),PointNode:t("./pointnode"),BoundsNode:t("./boundsnode")}},{"./boundsnode":12,"./pointnode":14,"./quadtree":15}],14:[function(t,e,n){"use strict";function i(t,e,n,i){this._bounds=t,this.children=[],this.nodes=[],i&&(this._maxChildren=i),n&&(this._maxDepth=n),e&&(this._depth=e)}i.prototype.nodes=null,i.prototype._classConstructor=i,i.prototype.children=null,i.prototype._bounds=null,i.prototype._depth=0,i.prototype._maxChildren=4,i.prototype._maxDepth=4,i.TOP_LEFT=0,i.TOP_RIGHT=1,i.BOTTOM_LEFT=2,i.BOTTOM_RIGHT=3,i.prototype.insert=function(t){if(this.nodes.length){var e=this._findIndex(t);return void this.nodes[e].insert(t)}this.children.push(t);var n=this.children.length;if(this._depth<this._maxDepth&&n>this._maxChildren){this.subdivide();var i;for(i=0;n>i;i++)this.insert(this.children[i]);this.children.length=0}},i.prototype.retrieve=function(t){if(this.nodes.length){var e=this._findIndex(t);return this.nodes[e].retrieve(t)}return this.children},i.prototype._findIndex=function(t){var e=this._bounds,n=t.x>e.x+e.width/2?!1:!0,o=t.y>e.y+e.height/2?!1:!0,r=i.TOP_LEFT;return n?o||(r=i.BOTTOM_LEFT):r=o?i.TOP_RIGHT:i.BOTTOM_RIGHT,r},i.prototype.subdivide=function(){var t=this._depth+1,e=this._bounds.x,n=this._bounds.y,o=this._bounds.width/2|0,r=this._bounds.height/2|0,s=e+o,a=n+r;this.nodes[i.TOP_LEFT]=new this._classConstructor({x:e,y:n,width:o,height:r},t,this._maxDepth,this._maxChildren),this.nodes[i.TOP_RIGHT]=new this._classConstructor({x:s,y:n,width:o,height:r},t,this._maxDepth,this._maxChildren),this.nodes[i.BOTTOM_LEFT]=new this._classConstructor({x:e,y:a,width:o,height:r},t,this._maxDepth,this._maxChildren),this.nodes[i.BOTTOM_RIGHT]=new this._classConstructor({x:s,y:a,width:o,height:r},t,this._maxDepth,this._maxChildren)},i.prototype.clear=function(){this.children.length=0;var t,e=this.nodes.length;for(t=0;e>t;t++)this.nodes[t].clear();this.nodes.length=0},n=e.exports=i},{}],15:[function(t,e,n){"use strict";function i(t,e,n,i){var s;s=e?new o(t,0,n,i):new r(t,0,n,i),this.root=s}var o=t("./pointnode"),r=t("./boundsnode");i.prototype.root=null,i.prototype.insert=function(t){if(t instanceof Array)for(var e=0,n=t.length;n>e;)this.root.insert(t[e]),e++;else this.root.insert(t)},i.prototype.clear=function(){this.root.clear()},i.prototype.retrieve=function(t){return this.root.retrieve(t)},n=e.exports=i},{"./boundsnode":12,"./pointnode":14}],16:[function(t,e,n){"use strict";function i(t,e,n){n=n||o(),(!e||2>e)&&(e=3),(!t||0>=t)&&(t=1);for(var i=r(),s=0;e>s;s++)i.add(o(n.x+t*Math.cos(2*s*Math.PI/e+.25*Math.PI),n.y+t*Math.sin(2*s*Math.PI/e+.25*Math.PI)));return i}var o=t("./vector2"),r=t("./polygon2");n=e.exports=i},{"./polygon2":11,"./vector2":18}],17:[function(t,e,n){"use strict";function i(t,e,n){if(!(this instanceof i)){var o=r.pop();return o?o.set(t,e,n):(o=new i(t,e,n),s++),o}this.v0=t,this.v1=e,this.v2=n}n=e.exports=i;var o=1e-7,r=[],s=0;i.getStats=function(){return[r.length,s]},i.prototype.free=function(){r.push(this)},i.prototype.set=function(t,e,n){return this.v0.free(),this.v1.free(),this.v2.free(),this.v0=t,this.v1=e,this.v2=n,this},i.prototype.translate=function(t){return this.v0.add(t),this.v1.add(t),this.v2.add(t),this},i.prototype.calcCircumcircle=function(){var t,e,n=this.v1.x-this.v0.x,i=this.v1.y-this.v0.y,r=this.v2.x-this.v0.x,s=this.v2.y-this.v0.y,a=n*(this.v0.x+this.v1.x)+i*(this.v0.y+this.v1.y),l=r*(this.v0.x+this.v2.x)+s*(this.v0.y+this.v2.y),h=2*(n*(this.v2.y-this.v1.y)-i*(this.v2.x-this.v1.x));if(Math.abs(h)<o){var u=Math.min(this.v0.x,this.v1.x,this.v2.x),p=Math.min(this.v0.y,this.v1.y,this.v2.y),y=Math.max(this.v0.x,this.v1.x,this.v2.x),d=Math.max(this.v0.y,this.v1.y,this.v2.y);this.center.set((u+y)/2,(p+d)/2),t=this.center.x-u,e=this.center.y-p}else{var f=(s*a-i*l)/h,c=(n*l-r*a)/h;this.center.set(f,c),t=this.center.x-this.v0.x,e=this.center.y-this.v0.y}this.radius_squared=t*t+e*e,this.radius=Math.sqrt(this.radius_squared)},i.prototype.inCircumcircle=function(t){var e=this.center.x-t.x,n=this.center.y-t.y,i=e*e+n*n;return i<=this.radius_squared}},{}],18:[function(t,e,n){"use strict";function i(t,e){if(!(this instanceof i)){var n=l.pop();return n?n.set(t,e):(n=new i(t||0,e||0),h++),n}this.x=t||0,this.y=e||0}function o(t){return t*a}function r(t){return t/a}n=e.exports=i;var s=1e-7,a=180/Math.PI,l=[],h=0;i.getStats=function(){return[l.length,h]},i.fromArray=function(t){return i(t[0]||0,t[1]||0)},i.fromObject=function(t){return i(t.x||0,t.y||0)},i.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},i.prototype.free=function(){l.push(this)},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},i.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},i.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},i.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},i.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=0,this.y=0):(this.x/=t,this.y/=t),this},i.prototype.clone=function(){return i(this.x,this.y)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.zero=function(){return this.x=this.y=0,this},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.cross=function(t){return this.x*t.y-this.y*t.x},i.prototype.projectOnto=function(t){var e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this},i.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},i.prototype.horizontalAngleDeg=function(){return o(this.horizontalAngle())},i.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},i.prototype.verticalAngleDeg=function(){return o(this.verticalAngle())},i.prototype.angle=i.prototype.horizontalAngle,i.prototype.angleDeg=i.prototype.horizontalAngleDeg,i.prototype.direction=i.prototype.horizontalAngle,i.prototype.rotate=function(t,e){var n=0,i=0;e&&(n=e.x||0,i=e.y||0);var o=n+this.x*Math.cos(t)-this.y*Math.sin(t),r=i+this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=o,this.y=r,this},i.prototype.rotateDeg=function(t){return t=r(t),this.rotate(t)},i.prototype.rotateBy=function(t){var e=this.angle()+t;return this.rotate(e)},i.prototype.rotateByDeg=function(t){return t=r(t),this.rotateBy(t)},i.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},i.prototype.distanceSq=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},i.prototype.length=function(){return Math.sqrt(this.lengthSq())},i.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},i.prototype.magnitude=i.prototype.length,i.prototype.isZero=function(){return 0===this.x&&0===this.y},i.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},i.prototype.isEqualEpsilon=function(t){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s},i.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},i.prototype.toArray=function(){return[this.x,this.y]},i.prototype.toObject=function(){return{x:this.x,y:this.y}}},{}],19:[function(t,e,n){"use strict";function i(t,e){return t[2]-e[2]}function o(t){this.polygon=r(),this.segments=t,this.heap=[],this.map=new Array(this.segments.length),this.points=new Array(2*this.segments.length),this.position=s()}var r=t("./polygon2"),s=t("./vector2"),a=t("./linesegment2"),l=Math.PI,h=2*l,u=-1*l,p=1e-7,y=["start","end"];o.prototype.angle=function(t,e){var n=e.clone().subtract(t),i=n.angle();return n.free(),
i},o.prototype.angle2=function(t,e,n){var i=this.angle(t,e),o=this.angle(e,n),r=i-o;return 0>r&&(r+=h),r>h&&(r-=h),r},o.prototype.compute=function(t){this.position.copy(t),this.reset(),this.sortPoints();var e=this.position.clone();e.x+=1;for(var n=0,i=this.segments.length;i>n;){var o=this.angle(this.segments[n].start,this.position),r=this.angle(this.segments[n].end,this.position);(o>u&&0>=o&&l>=r&&r>=0&&r-o>l||r>u&&0>=r&&l>=o&&o>=0&&o-r>l)&&this.insert(n,e),n+=1}for(n=0,i=2*this.segments.length;i>n;){var s=!1,h=!1,y=n,d=this.segments[this.points[n][0]][this.points[n][1]],f=this.heap[0];do if(-1!==this.map[this.points[n][0]]?(this.points[n][0]===f&&(s=!0,d=this.segments[this.points[n][0]][this.points[n][1]]),this.remove(this.map[this.points[n][0]],d)):(this.insert(this.points[n][0],d),this.heap[0]!==f&&(h=!0)),++n,n===i)break;while(this.points[n][2]<this.points[y][2]+p);var c=a(t.clone(),d.clone());if(s){this.polygon.add(d.clone());var g=this.segments[this.heap[0]].intersect(c,!0);g&&(g.isEqualEpsilon(d)?g.free():this.polygon.add(g))}else h&&(this.polygon.add(this.segments[f].intersect(c,!0)),this.polygon.add(this.segments[this.heap[0]].intersect(c,!0)))}return this.polygon},o.prototype.insert=function(t,e){var n=a(this.position.clone(),e.clone()),i=this.segments[t].intersect(n,!0);if(i===!1)return void n.free();i.free();var o=this.heap.length;for(this.heap.push(t),this.map[t]=o;o>0;){var r=this.parent(o);if(!this.lessThan(this.heap[o],this.heap[r],e))break;this.map[this.heap[r]]=o,this.map[this.heap[o]]=r;var s=this.heap[o];this.heap[o]=this.heap[r],this.heap[r]=s,o=r}},o.prototype.remove=function(t,e){if(this.map[this.heap[t]]=-1,t===this.heap.length-1)return void this.heap.pop();this.heap[t]=this.heap.pop(),this.map[this.heap[t]]=t;var n=t,i=this.parent(n);if(0!==n&&this.lessThan(this.heap[n],this.heap[i],e))for(;n>0&&(i=this.parent(n),this.lessThan(this.heap[n],this.heap[i],e));)this.swap(n,i),n=i;else for(;;){var o=this.child(n),r=o+1;if(o<this.heap.length&&this.lessThan(this.heap[o],this.heap[n],e)&&(r===this.heap.length||this.lessThan(this.heap[o],this.heap[r],e)))this.swap(n,o),n=o;else{if(!(r<this.heap.length&&this.lessThan(this.heap[r],this.heap[n],e)))break;this.swap(n,r),n=r}}},o.prototype.lessThan=function(t,e,n){var i=a(this.position.clone(),n.clone()),o=this.segments[t].intersect(i,!0),r=this.segments[e].intersect(i,!0);if(!o.isEqualEpsilon(r)){var s=o.distanceSq(this.position),h=r.distanceSq(this.position);return o.free(),r.free(),i.free(),h>s}var u=this.segments[t].start;o.isEqualEpsilon(this.segments[t].start)&&(u=this.segments[t].end);var p=this.segments[e].start;r.isEqualEpsiolon(this.segments[e].start)&&(p=this.segments[e].end);var y=this.angle2(u,o,this.position),d=this.angle2(p,r,this.position);return o.free(),r.free(),l>y?d>l?!0:y>d:d>y},o.prototype.parent=function(t){return Math.floor((t-1)/2)},o.prototype.child=function(t){return 2*t+1},o.prototype.swap=function(t,e){this.map[this.heap[e]]=t,this.map[this.heap[t]]=e;var n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n},o.prototype.sortPoints=function(){for(var t=0,e=this.segments.length,n=null,o=s();e>t;){for(var r=0;2>r;++r){n=0===r?this.segments[t][y[r]]:this.segments[t][y[r]],o.copy(this.position).subtract(n);var a=2*t+r;this.points[a]?(this.points[a][0]=t,this.points[a][1]=y[r],this.points[a][2]=o.angle()):this.points[a]=[t,y[r],o.angle()]}t+=1}o.free(),this.points=this.points.sort(i)},o.prototype.reset=function(){this.polygon.freePoints();for(var t=0,e=this.map.length;e>t;)this.map[t]=-1,t+=1;for(;this.heap.length>0;)this.heap.pop()}},{"./linesegment2":10,"./polygon2":11,"./vector2":18}],20:[function(t,e,n){(function(n){var i={};i.geometry=t("./geometry"),i.linkedlist=t("./linkedlist"),i.procedural=t("./procedural"),i.timer=t("./timer"),i.input=t("./input"),e.exports=i,n.ULTRON=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./geometry":9,"./input":21,"./linkedlist":25,"./procedural":28,"./timer":30}],21:[function(t,e,n){e.exports={Unified:t("./unified")}},{"./unified":23}],22:[function(t,e,n){function i(t,e,n,i){t[o](s+e,"wheel"===r?n:function(t){!t&&(t=window.event);var e={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"===t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"===r?(e.deltaY=-1/40*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-1/40*t.wheelDeltaX)):e.deltaY=t.detail,n(e)},i||!1)}var o,r,s="";window.addEventListener?o="addEventListener":(o="attachEvent",s="on"),r="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.exports=function(t,e,n){i(t,r,e,n),"DOMMouseScroll"===r&&i(t,"MozMousePixelScroll",e,n)}},{}],23:[function(t,e,n){"use strict";function i(t,e){this.element=t||document,e=e||{},this.preventDefaults=!!e.preventDefaults,this.stopPropagation=!!e.stopPropagation,this.down=new E,this.up=new E,this.gamepadconnected=new E,this.gamepaddisconnected=new E,this.state={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this._keybindmap={},this._keyStates={},this._bindPressCounts={},this._gamepads={},this._gamepadButtonStates={},this._gamepadRaf=!1,this.initEvents()}function o(t,e,n){h(n.keyCode,x[n.keyCode],e,t,n)}function r(t,e,n){var i=-1-n.button,o="<mouse "+(n.button+1)+">";return h(i,o,e,t,n),!1}function s(t){var e=t._keybindmap["<mouse 3>"];return e?!1:void 0}function a(t,e){var n=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;t.state["mouse-dx"]+=n,t.state["mouse-dy"]+=i}function l(t,e){var n=1;switch(e.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=t.element.clientHeight||window.innerHeight}return t.state["mouse-scrollx"]+=e.deltaX*n,t.state["mouse-scrolly"]+=e.deltaY*n,t.state["mouse-scrollz"]+=e.deltaZ*n||0,!1}function h(t,e,n,i,o){var r=i._keybindmap[e];if(r){i.preventDefaults&&o.preventDefault(),i.stopPropagation&&o.stopPropagation();var s=i._keyStates[t];if(v(s,n))for(var a=0;a<r.length;++a)u(r[a],n,i,o);i._keyStates[t]=n}}function u(t,e,n,i){var o=n._bindPressCounts[t]||0;o+=e?1:-1,0>o&&(o=0),n._bindPressCounts[t]=o;var r=n.state[t];if(v(r,o)){var s=e?n.down:n.up;s.emit(t,i)}n.state[t]=!!o}function p(t,e,n){var i=n._keybindmap[e];if(i){var o=1===t,r=!1;if("object"==typeof t)o=t.pressed,t=t.value,r=!0,n.state[e]=t;else{var s=n._buttonStates[e];if(v(s,t)){var a=0;for(a=0;a<i.length;++a)u(i[a],o,n,null)}}}}function y(t){var e=m(t);if(!e)return void(t._gamepadRaf&&(P(t._gamepadRaf),t._gamepadRaf=!1));var n="";for(var i in t._gamepads){for(var o=t._gamepads[i],r=0;r<o.buttons.length;r++)n="<gamepad-"+i+"-"+L[r]+">",p(o.buttons[r],n,t);for(r=0;r<o.axes.length;r++)n="<gamepad-"+i+"-"+I[r]+">",t.state[n]=o.axes[r]}t._gamepadRaf=b(y)}function d(t,e){c(t,e.gamepad)}function f(t,e){g(t,e.gamepad)}function c(t,e){t._gamepads[e.index]=e,t.gamepadconnected.emit(e),t._gamepadRaf||(t._gamepadRaf=b(y))}function g(t,e){delete t._gamepads[e.index],t.gamepaddisconnected.emit(e);for(var n in t._gamepads)if(t._gamepads.hasOwnProperty(n))return;t._gamepadRaf&&(P(t._gamepadRaf),t._gamepadRaf=!1)}function m(t){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],n=!1,i=0;i<e.length;i++)e[i]&&(n=!0,e[i].index in t._gamepads?t._gamepads[e[i].index]=e[i]:c(t,e[i]));return n}function v(t,e){return t?!e:e}var x=t("vkey"),_=t("request-frame"),b=_("request"),P=_("cancel"),E=t("eventemitter3"),B=t("./mousewheel-polyfill");e.exports=function(t,e){return new i(t,e)};var L=["a","b","x","y","left-shoulder","right-shoulder","left-trigger","right-trigger","select","start","left-stick","right-stick","dpad-up","dpad-down","dpad-left","dpad-right"],I=["left-stick-x","left-stick-y","right-stick-x","right-stick-y"],C="GamepadEvent"in window;i.prototype.initEvents=function(){window.addEventListener("keydown",o.bind(void 0,this,!0),!1),window.addEventListener("keyup",o.bind(void 0,this,!1),!1),this.element.addEventListener("mousedown",r.bind(void 0,this,!0),!1),this.element.addEventListener("mouseup",r.bind(void 0,this,!1),!1),this.element.oncontextmenu=s.bind(void 0,this),this.element.addEventListener("mousemove",a.bind(void 0,this),!1),B(this.element,l.bind(void 0,this),!1),C?(window.addEventListener("gamepadconnected",d.bind(void 0,this),!1),window.addEventListener("gamepaddisconnected",f.bind(void 0,this),!1)):window.setInterval(m.bind(void 0,this),500)},i.prototype.bind=function(t){for(var e=1;e<arguments.length;++e){var n=arguments[e],i=this._keybindmap[n]||[];-1===i.indexOf(t)&&i.push(t),this._keybindmap[n]=i}this.state[t]=!!this.state[t]},i.prototype.unbind=function(t){for(var e in this._keybindmap){var n=this._keybindmap[e],i=n.indexOf(t);i>-1&&n.splice(i,1)}},i.prototype.tick=function(){this.state["mouse-dx"]=this.state["mouse-dy"]=0,this.state["mouse-scrollx"]=this.state["mouse-scrolly"]=this.state["mouse-scrollz"]=0},i.prototype.getBoundKeys=function(){var t=[];for(var e in this._keybindmap)t.push(e);return t}},{"./mousewheel-polyfill":22,eventemitter3:2,"request-frame":3,vkey:4}],24:[function(t,e,n){"use strict";function i(){this._head=null,this._tail=null,this._length=0,this._nodeCache=[]}i.prototype={constructor:i,add:function(t){var e=this._allocate(t);0===this._length?(this._head=e,this._tail=e):(this._tail.next=e,e.prev=this._tail,this._tail=e),this._length++},set:function(t,e){if(t>-1&&t<this._length){var n,i;if(t>this._length/2)for(n=this._tail,i=this._length-1;i-->t;)n=n.prev;else for(n=this._head,i=0;i++<t;)n=n.next;n.data=e}},item:function(t){if(t>-1&&t<this._length){var e,n;if(t>this._length/2)for(e=this._tail,n=this._length-1;n-->t;)e=e.prev;else for(e=this._head,n=0;n++<t;)e=e.next;return e.data}return null},pop:function(){return this.remove(this._length-1)},remove:function(t){if(t>-1&&t<this._length){var e=this._head,n=0;if(0===t)this._head=e.next,this._head?this._head.prev=null:this._tail=null;else if(t===this._length-1)e=this._tail,this._tail=e.prev,this._tail.next=null;else{for(;n++<t;)e=e.next;e.prev.next=e.next}return this._length--,this._free(e),e.data}return null},clear:function(){for(;this._length>0;)this.remove(0)},size:function(){return this._length},toArray:function(){for(var t=[],e=this._head;e;)t.push(e.data),e=e.next;return t},toString:function(){return this.toArray().toString()},_free:function(t){this._nodeCache.push(t)},_allocate:function(t){var e=this._nodeCache.pop();return e||(e={}),e.data=t,e.prev=null,e.next=null,e}},n=e.exports=i},{}],25:[function(t,e,n){e.exports={DoublyLinkedList:t("./doublylinkedlist")}},{"./doublylinkedlist":24}],26:[function(t,e,n){"use strict";function i(t,e,n,i,l,d){var f,c;this.centers=[],e=e||1,l=l||6,4>l&&(l=4);var g={min:4,max:l},m={min:n,max:i},v=t.integer(g),x=o(t.floating(m),v),_=p(x.toArray());x.free();var b,P,E;this.centers.push(s());for(var B=1;e>B;B++)v=t.integer(g),x=o(t.floating(m),v),d||x.rotate(t.floating({min:0,max:2*Math.PI/v})),E=t.integer({min:0,max:_.getNumPoints()-1}),b=s(_.getX(E),_.getY(E)),this.centers.push(b),x.translate(b),P=p(x.toArray()),_=_.union(P),x.free();var L=y(_);x=r.fromArray(L),this.polygon=x;var I=Math.ceil(e/2);this.doors=[];var C,O={};for(B=0;I>B;B++){for(C=t.integer({min:0,max:this.polygon.points.length-1});O[C];)C=t.integer({min:0,max:this.polygon.points.length-1});O[C]=!0,f=C+1,f===this.polygon.points.length&&(f=0),c=a(this.polygon.points[C].clone(),this.polygon.points[f].clone());var T=c.end.clone(),S=c.start.clone(),A=c.length();T.subtract(c.start).normalize().multiplyScalar(A/2),S.add(T),this.doors.push(S),T.free(),c.free()}var w=[];for(B=0;B<this.centers.length;B++)w.push(this.centers[B].toArray());for(this.graph=new u,this.delaunay_used={},this.delaunay=h.triangulate(w),B=0;B<this.delaunay.length;B+=1)this.delaunay_used[this.delaunay[B]]||(this.graph.addNode(this.delaunay[B]),this.delaunay_used[this.delaunay[B]]=!0);for(this.delaunay_exists={},this.delaunay_triangles=[],this.delaunay_lines=[],B=0;B<this.delaunay.length;B+=3)this.addDelaunayLine(B,B+1),this.addDelaunayLine(B+1,B+2),this.addDelaunayLine(B+2,B);for(C=this.centers.length,B=0;B<this.doors.length;B++)this.connectDoor(this.doors[B],C);var N=this.graph.prim();for(this.mst_lines=[],B=0;B<N.length;B++){var D=N[B].source;f=N[B].sink,c=a(this.centers[D].clone(),this.centers[f].clone()),this.mst_lines.push(c)}this.outside=this.polygon.AABB(),this.outside[0].subtractScalar(50),this.outside[1].addScalar(50)}var o=t("../geometry/regularpolygon2"),r=t("../geometry/polygon2"),s=t("../geometry/vector2"),a=t("../geometry/linesegment2"),l=t("../geometry/gpc"),h=t("delaunay-fast"),u=t("./graph");n=e.exports=i;var p=function(t){for(var e=new l.geometry.PolyDefault,n=0;n<t.length;n++)e.addPoint(new l.geometry.Point(t[n][0],t[n][1]));return e},y=function(t){var e,n=[],i=t.getNumPoints();for(e=0;i>e;e++)n.push([t.getX(e),t.getY(e)]);return n};i.prototype.connectDoor=function(t,e){for(var n,i,o=9999999,r=!1,s=0;e>s;s++)n=a(this.centers[s].clone(),t.clone()),this.polygon.intersectsLine(n,!0)||(i=n.length(),o>i&&(o=i,r=s)),n.free();r!==!1?(this.centers.push(t.clone()),this.graph.addNode(this.centers.length-1),this.graph.addEdge(r,this.centers.length-1,o),this.delaunay_lines.push(a(this.centers[r].clone(),t.clone()))):n.free()},i.prototype.addDelaunayLine=function(t,e){var n=t+":"+e,i=e+":"+t;if(!this.delaunay_exists[n]&&!this.delaunay_exists[i]){this.delaunay_exists[n]=!0,this.delaunay_exists[i]=!0;var o=a(this.centers[this.delaunay[t]].clone(),this.centers[this.delaunay[e]].clone());this.polygon.intersectsLine(o)?o.free():(this.graph.addEdge(this.delaunay[t],this.delaunay[e],o.length()),this.delaunay_lines.push(o))}},i.prototype.translate=function(t){this.polygon.translate(t);for(var e=0;e<this.centers.length;e++)this.centers[e].add(t);for(e=0;e<this.delaunay_triangles.length;e++)this.delaunay_triangles[e].translate(t);return this}},{"../geometry/gpc":5,"../geometry/linesegment2":10,"../geometry/polygon2":11,"../geometry/regularpolygon2":16,"../geometry/vector2":18,"./graph":27,"delaunay-fast":1}],27:[function(t,e,n){"use strict";var i=function(t,e,n){this.source=t,this.sink=e,this.capacity=n},o=function(){this.edges={},this.nodes=[],this.nodeMap={},this.addNode=function(t){this.nodes.push(t),this.nodeMap[t]=this.nodes.length-1,this.edges[t]=[]},this.addEdge=function(t,e,n){this.edges[t].push(new i(t,e,n)),this.edges[e].push(new i(e,t,n))},this.edgeExists=function(t,e){if(void 0!==this.edges[t])for(var n=0;n<this.edges[t].length;n++)if(this.edges[t][n].sink===e)return this.edges[t][n];return null},this.prim=function(){function t(t){for(var n=[999999,null],o=0;o<e.length;o++)for(var r=0;r<t.edges[e[o]].length;r++)t.edges[e[o]][r].capacity<n[0]&&void 0===i[t.edges[e[o]][r].sink]&&(n=[t.edges[e[o]][r].capacity,t.edges[e[o]][r]]);return n}var e=[],n=[],i={},o=this.nodes[Math.round(Math.random()*(this.nodes.length-1))];e.push(o),i[o]=!0;for(var r=t(this);null!==r[1];)n.push(r[1]),e.push(r[1].sink),i[r[1].sink]=!0,r=t(this);return n}};e.exports=o},{}],28:[function(t,e,n){e.exports={Graph:t("./graph"),Building:t("./building")}},{"./building":26,"./graph":27}],29:[function(t,e,n){"use strict";function i(){this.simulationTimestep=1e3/60,this.frameDelta=0,this.lastFrameTimeMs=0,this.fps=60,this.lastFpsUpdate=0,this.framesThisSecond=0,this.numUpdateSteps=0,this.minFrameDelay=0,this.running=!1,this.started=!1,this.panic=!1,this.rafHandle=!1,this.boundAnimate=this.animate.bind(this)}var o=t("request-frame"),r=o("request"),s=o("cancel"),a=function(){};n=e.exports=i,i.prototype.begin=a,i.prototype.update=a,i.prototype.render=a,i.prototype.end=a,i.prototype.getSimulationTimestep=function(){return this.simulationTimestep},i.prototype.setSimulationTimestep=function(t){return this.simulationTimestep=t,this},i.prototype.getFPS=function(){return this.fps},i.prototype.getMaxAllowedFPS=function(){return 1e3/this.minFrameDelay},i.prototype.setMaxAllowedFPS=function(t){return"undefined"==typeof t&&(t=1/0),0===t?this.stop():this.minFrameDelay=1e3/t,this},i.prototype.resetFrameDelta=function(){var t=this.frameDelta;return this.frameDelta=0,t},i.prototype.setBegin=function(t){return this.begin=t||this.begin,this},i.prototype.setUpdate=function(t){return this.update=t||this.update,this},i.prototype.setRender=function(t){return this.render=t||this.render,this},i.prototype.setEnd=function(t){return this.end=t||this.end,this},i.prototype.start=function(){return this.started||(this.started=!0,this.rafHandle=r(function(t){this.render(1),this.running=!0,this.lastFrameTimeMs=t,this.lastFpsUpdate=t,this.framesThisSecond=0,this.rafHandle=r(this.animate.bind(this))})),this},i.prototype.stop=function(){return this.running=!1,this.started=!1,s(this.rafHandle),this},i.prototype.isRunning=function(){return this.running},i.prototype.animate=function(t){if(t<this.lastFrameTimeMs+this.minFrameDelay)return void(this.rafHandle=r(this.boundAnimate));for(this.frameDelta+=t-this.lastFrameTimeMs,this.lastFrameTimeMs=t,this.begin(t,this.frameDelta),t>this.lastFpsUpdate+1e3&&(this.fps=.25*this.framesThisSecond+.75*this.fps,this.lastFpsUpdate=t,this.framesThisSecond=0),this.framesThisSecond++,this.numUpdateSteps=0;this.frameDelta>=this.simulationTimestep;)if(this.update(this.simulationTimestep),this.frameDelta-=this.simulationTimestep,++this.numUpdateSteps>=240){this.panic=!0;break}this.render(this.frameDelta/this.simulationTimestep),this.end(this.fps,this.panic),this.panic=!1,this.rafHandle=r(this.boundAnimate)}},{"request-frame":3}],30:[function(t,e,n){e.exports={GameLoop:t("./gameloop")}},{"./gameloop":29}]},{},[20])(20)});